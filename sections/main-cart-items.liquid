
<style>
  :root {
    --cart-spacing-xs: 0.5rem;
    --cart-spacing-sm: 1rem;
    --cart-spacing-md: 1.5rem;
    --cart-spacing-lg: 2rem;
    --cart-spacing-xl: 3rem;
    --cart-border-width: 0.2rem;
    --cart-border-radius-sm: 0.375rem;
    --cart-border-radius-md: 0.75rem;
    --cart-font-xs: 0.875rem;
    --cart-font-sm: 1rem;
    --cart-font-md: 1.125rem;
    --cart-font-lg: 1.25rem;
    --cart-font-xl: 1.5rem;
    --cart-font-2xl: 2rem;
    --cart-font-3xl: 2.5rem;
    --cart-color-primary: #000;
    --cart-color-secondary: #222;
    --cart-color-accent: #e00;
    --cart-color-muted: #3e3e3e;
    --cart-color-bg: #fff;
    --cart-color-border: #d3d3d3;
  }

  .cart-main-layout {
    display: flex;
    width: 100%;
    min-height: 85vh;
    margin: 0;
    padding: var(--cart-spacing-xl);
    box-sizing: border-box;
    gap: 10rem;
    margin: 0 auto;
  }

  .cart-items-list {
    flex: 2;
    display: flex;
    flex-direction: column;
    gap: 0;
    padding: 0;
    margin: 0;
  }

  .cart-item-row {
    display: grid;
    grid-template-columns: 15rem 1fr;
    grid-template-rows: auto 1fr;
    gap: var(--cart-spacing-lg);
    align-items: start;
    background: var(--cart-color-bg);
    border-bottom: var(--cart-border-width) solid var(--cart-color-primary);
    padding:  0;
    position: relative;
  }

  .cart-item-img {
    width: 15rem;
    height: 19rem;
    background: var(--cart-color-border);
    object-fit: cover;
    flex-shrink: 0;
    grid-row: 1 / 3;
  }

  .cart-item-content {
    display: flex;
    flex-direction: column;
    gap: var(--cart-spacing-sm);
    min-width: 0;
  }

  .cart-item-price {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--cart-color-primary);
    margin-bottom: var(--cart-spacing-xs);
  }

  .cart-item-title {
      font-size: 1.5rem;
    font-weight: 700;
    text-transform: uppercase;
    color: var(--cart-color-primary);
    margin-bottom: var(--cart-spacing-lg);
    line-height: 1.2;
  }

  .cart-item-options {
    display: flex;
    flex-direction: column;
    gap: var(--cart-spacing-md);
    margin-bottom: var(--cart-spacing-lg);
    margin-top:10px;

  }

  .cart-item-option-row {
    display: flex;
    align-items: center;
    gap: var(--cart-spacing-sm);
  }

  .cart-item-option-label {
    font-weight: 700;
    font-size: 1.5rem;
    text-transform: uppercase;
    min-width: 5rem;
  }

  .cart-item-option-btn {
    border: var(--cart-border-width) solid var(--cart-color-primary);
    border-radius: 10px;
    background: var(--cart-color-bg);
    color: var(--cart-color-primary);
    font-size: 1.5rem;
    font-weight: 700;
    padding: 0.5rem 1rem;
    margin-right: var(--cart-spacing-xs);
    cursor: pointer;
    transition: all 0.2s ease;
    text-transform: uppercase;
  }

  .cart-item-option-btn.selected {
    background: var(--cart-color-primary);
    color: var(--cart-color-bg);
  }

  .cart-item-option-btn.unavailable {
    position: relative;
    color: var(--cart-color-muted);
    cursor: not-allowed;
  }

  .cart-item-option-btn.unavailable::before {
    content: '';
    position: absolute;
    top: 50%;
    left: -0.125rem;
    width: 110%;
    height: 0.125rem;
    background: var(--cart-color-muted);
    transform: rotate(-45deg);
  }

  .cart-item-controls {
    position: absolute;
    top: 2%;
    right: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .cart-item-qty {
    display: flex;
    align-items: center;
    border: var(--cart-border-width) solid var(--cart-color-primary);
    border-radius: 10px;
    overflow: hidden;
  }

  .cart-item-qty-btn {
    background: var(--cart-color-bg);
    border: none;
    font-size: 2.3rem;
    font-weight: 500;
    width: 4rem;
    height: 4rem;
    cursor: pointer;
    transition: background 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .cart-item-qty-btn:hover:not(:disabled) {
    background: #f5f5f5;
  }

  .cart-item-qty-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .cart-item-qty-input {
    width: 5rem;
    text-align: center;
    font-size: 2.3rem;
    font-weight: 500;
    border: none;
    border-left: var(--cart-border-width) solid var(--cart-color-primary);
    border-right: var(--cart-border-width) solid var(--cart-color-primary);
    outline: none;
    background: var(--cart-color-bg);
  }

  .cart-item-remove {
    position: absolute;
    bottom:14%;
    right: 0;
    color: var(--cart-color-primary);
    font-size: 1.4rem;
    font-weight: 600;
    text-decoration: none;
    letter-spacing: 0.063rem;
    cursor: pointer;
    background: none;
    border: none;
    transition: color 0.2s ease;
    text-transform: uppercase;
  }

  .cart-item-remove:hover {
    color: var(--cart-color-accent);
  }

  .cart-sidebar {
    flex: 1;

    display: flex;
    flex-direction: column;
    gap: var(--cart-spacing-lg);
    margin: 0;
    padding: 0;
  }

  .cart-sidebar-box {
    border: var(--cart-border-width) solid var(--cart-color-primary);
    border-radius: 20px;
    background: var(--cart-color-bg);
    padding:1.4rem ;
    display: flex;
    flex-direction: column;
  }

  .cart-sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    margin-bottom: var(--cart-spacing-sm);
  }

  .cart-sidebar-label {
    font-size: 1.7rem;
    max-width:300px;
    font-weight: 700;

    text-transform: uppercase;
    line-height: 1.3;
    flex: 1;
  }

  .cart-sidebar-arrow {
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    flex-4s cubic-bezier(0.4, 0, 0.2, 1);
    flex-shrink: 0;
  }

  .cart-sidebar-arrow.expanded {
    transform: rotate(-90deg);
  }

  .cart-sidebar-form {
    display: flex;
    align-items: center;
    gap: var(--cart-spacing-sm);
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.3s ease 0.1s,
                padding-top 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    padding-top: 0;
  }

  .cart-sidebar-form.expanded {
    max-height: 6rem;
    opacity: 1;
    padding-top: 0;
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.3s ease 0.2s,
                padding-top 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .cart-sidebar-form input {
    flex: 1;
    padding: var(--cart-spacing-sm);
    border: var(--cart-border-width) solid var(--cart-color-primary);
    border-radius: var(--cart-border-radius-sm);
    font-size: 2rem;
    outline: none;
    height: 3rem;
    box-sizing: border-box;
  }

  .cart-sidebar-form input:focus {
    border-color: var(--cart-color-accent);
  }

  .cart-sidebar-form .form-submit-button1 {
    border: var(--cart-border-width) solid var(--cart-color-primary);
    border-radius: var(--cart-border-radius-sm);
    background: var(--cart-color-bg);
    color: black;
    font-size:2rem;
    font-weight: 300;
    cursor: pointer;
    transition: background 0.2s ease;
    white-space: nowrap;
    text-transform: uppercase;
    height: 3rem;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  .cart-sidebar-form .form-submit-button2 {
      border:1px solid black;
      border-radius: var(--cart-border-radius-sm);
      background: black;
      color: white;
      font-size:2rem;
      font-weight: 300;
      cursor: pointer;
      transition: background 0.2s ease;
      white-space: nowrap;
      text-transform: uppercase;
      height: 3rem;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
  }
  .cart-sidebar-form .form-submit-button3 {
      border:1px solid black;
      border-radius: var(--cart-border-radius-sm);
      background: black;
      color: white;
      font-size:2rem;
      font-weight: 300;
      cursor: pointer;
      transition: background 0.2s ease;
      white-space: nowrap;
      text-transform: uppercase;
      height: 3rem;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
  }

  .cart-sidebar-form .form-submit-button1:hover {
    background: var(--cart-color-secondary);
    color: white;
    border:1px solid black;
    border-radius: var(--cart-border-radius-sm);
  }

  .cart-sidebar-form .form-submit-button2:hover {
    background: white;
    color: black;
  }
  .cart-sidebar-form .form-submit-button3:hover {
    background: white;
    color: black;
  }

  .cart-sidebar-total-container {
    margin-top: auto;
    display: flex;
    flex-direction: column;
    gap: var(--cart-spacing-md);
  }

  .cart-sidebar-total {
    font-size: 5rem;
    font-weight: 900;
    display: flex;
    justify-content: space-between;
    align-items: center;
    text-transform: uppercase;
  }

  .cart-sidebar-checkout {
    width: 100%;
    background: var(--cart-color-primary);
    color: var(--cart-color-bg);
    font-size: 5rem;
    font-weight: 900;
    border-radius: var(--cart-border-radius-sm);
    display: flex;
    flex-direction: row-reverse;
    padding:0 var(--cart-spacing-lg);
    align-items: center;
    justify-content: space-between;
    text-decoration: none;
    transition: background 0.2s;
    text-transform: uppercase;
    min-height: 4rem;
    border: none;
    cursor: pointer;
  }

  .cart-sidebar-checkout:hover {
    background: var(--cart-color-secondary);
  }

  .cart-sidebar-checkout svg {
    width: 3rem;
    height: 3rem;
    font-weight: 900;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .cart-main-layout {
      flex-direction: column;
      padding: var(--cart-spacing-sm);
      gap: 0;
      max-width: 100%;
    }

    .cart-item-row {
      grid-template-columns: 10rem 1fr;
      grid-template-rows: auto auto;
      gap: var(--cart-spacing-sm);
      padding: var(--cart-spacing-md) 0;
      border-bottom: var(--cart-border-width) solid var(--cart-color-primary);
    }

    .cart-item-img {
      width: 10rem;
      height: 13rem;
      grid-row: 1 / 3;
    }

    .cart-item-content {
      gap: var(--cart-spacing-xs);
    }

    .cart-item-controls {
      grid-column: 2;
      grid-row: 2;
      justify-self: end;
      align-self: start;
      margin-top: var(--cart-spacing-xs);
    }

    .cart-item-price {
      font-size: 1.25rem;
      margin-bottom: 0.25rem;
    }

    .cart-item-title {
      font-size: 0.875rem;
      margin-bottom: var(--cart-spacing-xs);
      line-height: 1.3;
      max-width: 16.5rem;
    }

    .cart-item-options {
      gap: var(--cart-spacing-xs);
      margin-bottom: var(--cart-spacing-sm);
    }

    .cart-item-option-row {
      gap: var(--cart-spacing-xs);
      align-items: baseline;
    }

    .cart-item-option-label {
      font-size: 0.75rem;
      min-width: auto;
      font-weight: 600;
    }

    .cart-item-option-btn {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      margin-right: 0.25rem;
      border-width: 1px;
    }

    .cart-item-controls {
      top: 0;
      transform:translateY(-15.8rem);
      right: 0;
      flex-direction: row;
      gap: 0.25rem;
    }

    .cart-item-qty {
      order: 1;
      border-radius:5px;

    }

    .cart-item-qty-btn {
      width: 2rem;
      height: 2rem;
      font-size: 1rem;
    }

    .cart-item-qty-input {
      width: 2.5rem;
      height: 2rem;
      font-size: 1rem;
    }

    .cart-item-remove {
      bottom: 20%;
      right: 0;
      font-size: 0.75rem;
    }

    .cart-sidebar {
      min-width: unset;
      max-width: unset;
      padding: 0rem 0.3rem;
      margin-top: auto;
     height: 100%;
      gap: 0;
    }

    .cart-sidebar-box {
    padding:0;
      border-radius: 0;
      border-left: none;
      border-right: none;
      border-top: var(--cart-border-width) solid var(--cart-color-primary);
      border-bottom:none ;
      background: transparent;
    }

    .cart-sidebar-header {
      padding: 0.5rem 0;
    }

    .cart-sidebar-label {
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .cart-sidebar-arrow {
      width: 1.5rem;
      height: 1.5rem;
    }

    .cart-sidebar-form {
      padding-left: 0;
      padding-right: 0;
    }

    .cart-sidebar-form.expanded {
      max-height: 4rem;
      padding-top: var(--cart-spacing-sm);
    }

    .cart-sidebar-form input {
      height: 2.5rem;
      font-size: 0.875rem;
      padding: var(--cart-spacing-xs);
    }

    .cart-sidebar-form button {
      height: 2.5rem;
      font-size: 0.75rem;
      min-width: 4rem;
      padding: var(--cart-spacing-xs);
    }

    .cart-sidebar-total-container {
      margin-top: 0rem;
      display: flex;
      flex-direction: row;
      gap: var(--cart-spacing-sm);
      padding: var(--cart-spacing-xs) 0;
      border-top: var(--cart-border-width) solid var(--cart-color-primary);

    }

    .cart-sidebar-total {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: start;
      font-size: 1.45rem;
      min-width: 10rem;

      font-weight: 700;
    }

    .cart-sidebar-checkout {
        font-size: 1.5rem;
      padding: var(--cart-spacing-sm) var(--cart-spacing-md);
      min-height: 3rem;
      width:17rem;
      font-weight: 700;
      margin-left:auto;
    }
    .cart-sidebar-checkout span {
      margin-left:20px;
    }

    .cart-sidebar-checkout svg {
      width: 2rem;
      height: 2rem;
      font-weight: 700;
      margin-left:5px;
    }
  }

  /* Tablet Responsive */
  @media (min-width: 769px) and (max-width: 1424px) {
    .cart-main-layout {
      padding: var(--cart-spacing-lg);
    }

    .cart-item-img {
      width: 15rem;
      height: 19rem;
    }

    .cart-item-price {
      font-size: 2rem;
    }
    .cart-item-title{
        max-width:200px
    }
    .cart-sidebar-label{
        max-width:250px
    }

    .cart-sidebar {
      min-width: 22rem;
    }

    .cart-sidebar-total {
      font-size: 3rem;
    }
    .cart-sidebar-checkout{
        font-size:4rem;
    }

    .cart-sidebar-form {
      flex-direction: column;
      align-items: stretch;
      gap: var(--cart-spacing-sm);
    }



    .cart-sidebar-form button {
      width: 100%;
      margin-left: 0;
    }

    .cart-sidebar-form.expanded {
      max-height: 8rem;
    }

  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* Focus styles */
  .cart-item-qty-btn:focus,
  .cart-item-remove:focus,
  .cart-sidebar-form input:focus,
  .cart-sidebar-form button:focus,
  .cart-sidebar-checkout:focus {
    outline: none;
    outline-offset: 2px;
  }

  .cart-sidebar-header:focus {
    outline: none;
  }

  .cart-sidebar-header {
    outline: none;
    border: none;
  }

  .cart-sidebar-arrow {
    outline: none;
    border: none;
  }

  /* Remove all outlines and borders from interactive sidebar elements */
  .cart-sidebar-header,
  .cart-sidebar-header *,
  .cart-sidebar-arrow,
  .cart-sidebar-arrow *,
  .js-sidebar-header,
  .js-sidebar-header *,
  .js-sidebar-arrow,
  .js-sidebar-arrow * {
    outline: none !important;
    border: none !important;
    box-shadow: none !important;
  }

  /* Remove default browser focus styles */
  .cart-sidebar-header:focus,
  .cart-sidebar-header:focus-visible,
  .cart-sidebar-arrow:focus,
  .cart-sidebar-arrow:focus-visible {
    outline: none !important;
    border: none !important;
    box-shadow: none !important;
  }

  /* Ensure no red debug borders */
  .cart-sidebar-box *,
  .cart-sidebar-form *,
  .js-sidebar-header *,
  .js-sidebar-arrow * {
    border-color: transparent !important;
  }
</style>

<div class="cart-main-layout">
  <div class="cart-items-list">
    {% for item in cart.items %}
      <div class="cart-item-row">
        <img
          class="cart-item-img"
          src="{{ item.image | image_url: width: 400, height: 300 }}"
          alt="{{ item.product.title | escape }}"
          loading="lazy"
          width="100"
          height="100"
        >

        <div class="cart-item-content">
          <div class="cart-item-price">
            {% if item.original_price != item.final_price %}
              {{ item.final_price | money }}
            {% else %}
              {{ item.original_price | money }}
            {% endif %}
          </div>

          <div class="cart-item-title">{{ item.product.title }}</div>

          <div class="cart-item-options">
            {% for option in item.options_with_values %}
              <div class="cart-item-option-row">
                <span class="cart-item-option-label">{{ option.name }}:</span>
                <div class="cart-item-option-buttons">
                  {% if option.name == 'Color' %}
                    <span class="cart-item-option-btn selected">{{ option.value }}</span>
                  {% elsif option.name == 'Size' %}
                    {% assign available_sizes = 'S,M,L,XL' | split: ',' %}
                    {% for size in available_sizes %}
                      {% if option.value == size %}
                        <span class="cart-item-option-btn selected">{{ size }}</span>
                      {% else %}
                        <span class="cart-item-option-btn unavailable">{{ size }}</span>
                      {% endif %}
                    {% endfor %}
                  {% else %}
                    <span class="cart-item-option-btn selected">{{ option.value }}</span>
                  {% endif %}
                </div>
              </div>
            {% endfor %}

            {% if item.properties.size > 0 %}
              {% for property in item.properties %}
                {% assign property_first_char = property.first | slice: 0 %}
                {% if property.last != blank and property_first_char != '_' %}
                  <div class="cart-item-option-row">
                    <span class="cart-item-option-label">{{ property.first }}:</span>
                    <span class="cart-item-option-btn selected">{{ property.last }}</span>
                  </div>
                {% endif %}
              {% endfor %}
            {% endif %}
          </div>

          <div class="cart-item-controls">
            <form method="post" action="/cart/change" style="display:inline;">
              <input type="hidden" name="id" value="{{ item.key }}">
              <div class="cart-item-qty">
                <button
                  class="cart-item-qty-btn"
                  type="submit"
                  name="quantity"
                  value="{{ item.quantity | minus: 1 }}"
                  {% if item.quantity <= 1 %}disabled{% endif %}
                  aria-label="Decrease quantity"
                >
                  −
                </button>
                <input
                  class="cart-item-qty-input"
                  type="text"
                  value="{{ item.quantity }}"
                  readonly
                  aria-label="Current quantity"
                >
                <button
                  class="cart-item-qty-btn"
                  type="submit"
                  name="quantity"
                  value="{{ item.quantity | plus: 1 }}"
                  aria-label="Increase quantity"
                >
                  +
                </button>
              </div>
            </form>

            <form method="post" action="/cart/change" style="display:inline;">
              <input type="hidden" name="id" value="{{ item.key }}">
              <input type="hidden" name="quantity" value="0">

            </form>
          </div>
            <button class="cart-item-remove" type="submit" aria-label="Remove item">
              [REMOVE]
            </button>
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="cart-sidebar">
    <div class="cart-sidebar-box">
      <div class="cart-sidebar-header js-sidebar-header" tabindex="0" role="button" aria-label="Toggle order note form" style="outline: none;">
        <div class="cart-sidebar-label">
          Add A Note To<br>
          Your Order:
        </div>
        <div class="cart-sidebar-arrow js-sidebar-arrow">
            <svg stroke-linecap="round" width="24" height="24" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261" stroke="black" stroke-width="1.5" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
      <form class="cart-sidebar-form js-sidebar-form">
        <input type="text" placeholder="Type..." aria-label="Order note">
        <button type="submit" class="form-submit-button1">[Send]</button>
      </form>
    </div>

    <div class="cart-sidebar-box">
      <div class="cart-sidebar-header js-sidebar-header" tabindex="0" role="button" aria-label="Toggle newsletter signup" style="outline: none;">
        <div class="cart-sidebar-label">
          Receive Special Offers And First Look At New Products.
        </div>
        <div class="cart-sidebar-arrow js-sidebar-arrow">
            <svg stroke-linecap="round" width="24" height="24" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261" stroke="black" stroke-width="1.5" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
      <form class="cart-sidebar-form js-sidebar-form">
        <input type="email" placeholder="Enter your email" aria-label="Email address" required>
        <button type="submit" class="form-submit-button2">
          Subscribe
          <svg width="16" height="16" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-left: 0.5rem;">
            <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
          </svg>
        </button>
      </form>
    </div>

    <div class="cart-sidebar-box">
      <div class="cart-sidebar-header js-sidebar-header" tabindex="0" role="button" aria-label="Toggle shipping calculator" style="outline: none;">
        <div class="cart-sidebar-label">
          Estimate Shipping Rates
        </div>
        <div class="cart-sidebar-arrow js-sidebar-arrow">
            <svg stroke-linecap="round" width="24" height="24" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261" stroke="black" stroke-width="1.5" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
      <form class="cart-sidebar-form js-sidebar-form">
        <input type="text" placeholder="Enter ZIP code" aria-label="ZIP code">
        <button type="submit" class="form-submit-button3">[Search]</button>
      </form>
    </div>

    <div class="cart-sidebar-total-container">
      <div class="cart-sidebar-total">
        <span>Total:</span>
        <span>{{ cart.total_price | money_with_currency }}</span>
      </div>

      <a href="{{ routes.checkout_url }}" class="cart-sidebar-checkout" aria-label="Proceed to checkout">
        <span>Checkout</span>
        <svg stroke-linecap="round" width="32" height="32" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3.16406 30.9824H30.9305M30.9305 30.9824V3.21602M30.9305 30.9824L3.16406 3.21602" stroke="white" stroke-width="4" stroke-linejoin="round"/>
        </svg>
      </a>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const headers = document.querySelectorAll('.js-sidebar-header');

    headers.forEach(function (header) {
      const arrow = header.querySelector('.js-sidebar-arrow');
      const form = header.nextElementSibling;

      function toggleForm(e) {
        e.preventDefault();

        const isCurrentlyExpanded = form.classList.contains('expanded');

        // Close all other forms first with a slight delay for better UX
        headers.forEach(function (otherHeader) {
          const otherArrow = otherHeader.querySelector('.js-sidebar-arrow');
          const otherForm = otherHeader.nextElementSibling;

          if (otherForm !== form && otherForm.classList.contains('expanded')) {
            otherForm.classList.remove('expanded');
            otherArrow.classList.remove('expanded');
          }
        });

        // Toggle current form with a slight delay if we're opening a new one
        if (!isCurrentlyExpanded) {
          setTimeout(function() {
            form.classList.add('expanded');
            arrow.classList.add('expanded');
          }, 100);
        } else {
          form.classList.remove('expanded');
          arrow.classList.remove('expanded');
        }
      }

      // Click event
      header.addEventListener('click', toggleForm);

      // Keyboard support
      header.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          toggleForm(e);
        }
      });

      // Prevent form submission from closing the accordion
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        // Handle form submission here if needed
      });
    });

    // Smooth scroll behavior for better UX
    document.addEventListener('click', function(e) {
      if (e.target.closest('.js-sidebar-header')) {
        setTimeout(function() {
          const expandedForm = document.querySelector('.cart-sidebar-form.expanded');
          if (expandedForm) {
            expandedForm.scrollIntoView({
              behavior: 'smooth',
              block: 'nearest'
            });
          }
        }, 200);
      }
    });
  });
</script>
