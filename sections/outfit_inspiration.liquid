<div class="outfit-inspiration-section color-{{ section.settings.color_scheme }} bg-color:var(--background) page-width p-8 md:py-16 px-0">
  <div class="mx-auto  p-8 md:p-0 relative bg-color:var(--background)">
    <div class="outfit-navigation-arrows desktop-arrows">
      <button
        class="outfit-navigation flex lg:flex absolute left-0 top-1/2 -translate-y-1/2 z-1 bg-color:var(--background) border-2  items-center justify-center transition-opacity duration-300"
        id="outfit-slider-prev"
        aria-label="Previous"
        type="button"
        style="display: flex;"
      >
        <svg class="w-[22px] h-[22px]" fill="none" stroke="currentcolor" stroke-width="1" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>
      <button
        class=" outfit-navigation flex lg:flex absolute right-0 top-1/2 -translate-y-1/2 z-1 bg-color:var(--background) border-2 items-center justify-center transition-opacity duration-300"
        id="outfit-slider-next"
        aria-label="Next"
        type="button"
        style="display: flex;"
      >
        <svg class="w-[22px] h-[22px]" fill="none" stroke="currentcolor" stroke-width="1" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
    </div>

    <div class="flex flex-row color-{{ section.settings.color_scheme }} lg:flex-row gap-4 items-start justify-center relative">
      <div class="outfit-contianer flex flex-col">
        <h2
          class="outfit-section-title"
          style="text-align: {{ section.settings.title_align | default: 'center' }}; color: var(--header_text, var(--color-foreground)); margin-bottom: 45px;"
        >
          {{ section.settings.title }}
        </h2>

        <div class="outfit-wrapper flex ">
          <!-- Main Product -->
          <div class="  max-w-[409px] mx-10 lg:mx-0 flex flex-col items-center">
            <div
              class="main-product-card border-2"
            >
              <div
                class="outfit-main-img flex items-center justify-center w-full"
                style="height: 512px; width: 400px; padding: 10px 0;"
              >
                <img
                  src="{{ product.featured_image | img_url: '409x512' }}"
                  alt="{{ product.title }}"
                  class="outfit-main-img object-cover"
                  height="212"
                  width="370"
                >
              </div>
              <div class="px-6" style="color: var(--header_text);">
                <h4
                  class="text-base md:text-lg mb-1 main-product-title line-clamp-2"
                  style="color: var(--header_text);"
                >
                  {{ product.title }}
                </h4>
                {% if product.compare_at_price > product.price %}
                  <span class="text-red-600 font-semibold" style="color: var(--accent, #dc2626);">
                    {{ product.price | money }}
                  </span>
                  <span class="line-through text-gray-500 ml-2" style="color: var(--disabled_text, #6b7280);">
                    {{ product.compare_at_price | money }}
                  </span>
                {% else %}
                  <span style="color: var(--header_text);">
                    {{ product.price | money }}
                  </span>
                {% endif %}
              </div>
            </div>
          </div>
          <!-- Paired Products Slider -->
          <div class="relative overflow-hidden" style="width: 390px; min-width: 390px; height: 580px;">
            <div class="flex flex-col justify-center overflow-hidden h-full">
              <div class="transition-transform duration-300 ease-in-out w-full h-full" id="outfit-slider-track">
                {% for block in section.blocks %}
                  {% assign product_count = 0 %}
                  {% for i in (1..3) %}
                    {% assign product_key = 'product_' | append: i %}
                    {% if block.settings[product_key] != blank %}
                      {% assign product_count = product_count | plus: 1 %}
                    {% endif %}
                  {% endfor %}

                  <div
                    class="paired-product-slide flex flex-col h-full {% if product_count < 3 %}justify-center{% else %}justify-start{% endif %} gap-4"
                    data-slide-index="{{ forloop.index0 }}"
                    data-products="{{ product_count }}"
                  >
                    {% for i in (1..3) %}
                      {% assign product_key = 'product_' | append: i %}
                      {% if block.settings[product_key] != blank %}
                        {% assign paired_product = all_products[block.settings[product_key]] %}

                        <!-- Original Compact Product Card -->
                        <div
                          class="paired-product-card flex items-center border-2  rounded-lg p-6 gap-6 transition-all duration-500 ease-in-out relative"
                          style="height: 180px; color: var(--header_text);"
                          data-product-id="{{ paired_product.id }}"
                          data-product-url="{{ paired_product.url }}"
                        >
                          <div class=" paired-product-img w-[140px] h-[150px] rounded-lg flex items-center justify-center overflow-hidden flex-shrink-0">
                            {% if paired_product.featured_image %}
                              <img
                                src="{{ paired_product.featured_image | img_url: '140x150' }}"
                                alt="{{ paired_product.title }}"
                                class="object-cover"
                                height="150"
                                width="140"
                              >
                            {% else %}
                              <div class="w-full h-full bg-gray-300 rounded-lg"></div>
                            {% endif %}
                          </div>
                          <div class="flex-1 min-w-0 flex flex-col justify-between h-full">
                            <div>
                              <h4
                                class="paired-product-title text-xs md:text-base leading-tight mb-1 line-clamp-2"
                                style="color: var(--header_text);"
                              >
                                {{ paired_product.title }}
                              </h4>
                              {% if paired_product.compare_at_price > paired_product.price %}
                                <span class="text-red-600 font-semibold" style="color: var(--accent, #dc2626);">
                                  {{ paired_product.price | money }}
                                </span>
                                <span
                                  class="line-through text-gray-500 ml-2"
                                  style="color: var(--disabled_text, #6b7280);"
                                >
                                  {{ paired_product.compare_at_price | money }}
                                </span>
                              {% else %}
                                <span style="color: var(--header_text);">
                                  {{ paired_product.price | money }}
                                </span>
                              {% endif %}
                            </div>
                            <div class="flex items-center justify-between gap-2 mt-auto">
                              <div>
                                {% if paired_product.available == false %}
                                  <span
                                    class="outfit-sold-out bg-gray-200 text-gray-700 rounded-lg p-0"
                                  >
                                    SOLD OUT
                                  </span>
                                {% endif %}
                              </div>
                              <button
                                class="expand-product-btn flex-shrink-0 p-0 transition-transform duration-300 hover:scale-110"
                                aria-label="View Product"
                                data-product-id="{{ paired_product.id }}"
                              >
                                <svg
                                  stroke-linecap="round"
                                  viewBox="0 0 9 9"
                                  fill="none"
                                  xmlns="http://www.w3.org/2000/svg"
                                >
                                  <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261" stroke="currentcolor" stroke-width="1.5" stroke-linejoin="round"></path>
                                </svg>
                              </button>
                            </div>
                          </div>
                        </div>

                        <div
                          class="expanded-product-card border-2 transition-all duration-500 ease-in-out overflow-hidden opacity-0 pointer-events-none"
                          data-product-id="{{ paired_product.id }}"
                          style="color: var(--header_text);"
                        >
                          <div class="expanded-content p-6 h-full">
                            <div class="gap-4">
                              <div class="h-1/2">
                                <div class=" flex items-center justify-center overflow-hidden mb-4">
                                  {% if paired_product.featured_image %}
                                    <img
                                      src="{{ paired_product.featured_image | img_url: '200x250' }}"
                                      alt="{{ paired_product.title }}"
                                      height="200"
                                      width="250"
                                      class="exapnded-product-img object-cover"
                                    >
                                  {% else %}
                                    <div class=" bg-gray-300"></div>
                                  {% endif %}
                                </div>
                              </div>

                              <div class="flex-1 flex flex-col">
                                <div class="flex justify-between items-center">
                                  <h4
                                    class="outfit-expanded-title text-lg  line-clamp-2"
                                    style="color: var(--header_text);"
                                  >
                                    {{ paired_product.title }}
                                  </h4>
                                  <button
                                    class="outfit-arrow close-expanded-btn transition-transform duration-300 hover:scale-110 ml-4"
                                    aria-label="Close"
                                    data-product-id="{{ paired_product.id }}"
                                  >
                                    <svg
                                      stroke-linecap="round"
                                      viewBox="0 0 9 9"
                                      fill="none"
                                      xmlns="http://www.w3.org/2000/svg"
                                    >
                                      <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261" stroke="currentcolor" stroke-width="1.5" stroke-linejoin="round"></path>
                                    </svg>
                                  </button>
                                </div>

                                <div class="mb-2">
                                  {% if paired_product.compare_at_price > paired_product.price %}
                                    <span class="text-red-600 font-semibold" style="color: var(--accent, #dc2626);">
                                      {{ paired_product.price | money }}
                                    </span>
                                    <span
                                      class="line-through text-gray-500 ml-2"
                                      style="color: var(--disabled_text, #6b7280);"
                                    >
                                      {{ paired_product.compare_at_price | money }}
                                    </span>
                                  {% else %}
                                    <span style="color: var(--header_text);">
                                      {{ paired_product.price | money }}
                                    </span>
                                  {% endif %}
                                </div>

                                <div class="flex justify-between items-center mb-6">
                                  {% assign size_option = null %}
                                  {% for option in paired_product.options_with_values %}
                                    {% if option.name == 'Size' or option.name == 'size' %}
                                      {% assign size_option = option %}
                                    {% endif %}
                                  {% endfor %}
                                  {% if size_option %}
                                    <div class="flex gap-2">
                                      {% for value in size_option.values %}
                                        {% assign variant_for_size = null %}
                                        {% for variant in paired_product.variants %}
                                          {% if variant.options contains value %}
                                            {% assign variant_for_size = variant %}
                                            {% break %}
                                          {% endif %}
                                        {% endfor %}
                                        <button
                                          class="outfit-size-option border-2 rounded-lg flex items-center justify-center transition-colors duration-300 {% if variant_for_size.available %}bg-white hover:bg-black hover:text-white{% else %}bg-gray-200 text-gray-400 cursor-not-allowed{% endif %}{% if forloop.first %} selected{% endif %}"
                                          {% unless variant_for_size.available %}
                                            disabled
                                          {% endunless %}
                                          data-variant-id="{{ variant_for_size.id }}"
                                          data-product-id="{{ paired_product.id }}"
                                          data-option-value="{{ value | escape }}"
                                          type="button"
                                        >
                                          {{ value }}
                                        </button>
                                      {% endfor %}
                                    </div>
                                  {% else %}
                                    <div></div>
                                  {% endif %}

                                  {% assign color_option = null %}
                                  {% for option in paired_product.options_with_values %}
                                    {% if option.name == 'Color'
                                      or option.name == 'Colour'
                                      or option.name == 'color'
                                      or option.name == 'colour'
                                    %}
                                      {% assign color_option = option %}
                                    {% endif %}
                                  {% endfor %}
                                  {% if color_option %}
                                    <div class="flex gap-2">
                                      {% for value in color_option.values %}
                                        {% assign variant_for_color = null %}
                                        {% for variant in paired_product.variants %}
                                          {% if variant.options contains value %}
                                            {% assign variant_for_color = variant %}
                                            {% break %}
                                          {% endif %}
                                        {% endfor %}
                                        <button
                                          class="color-swatch w-8 h-8 rounded-full border-2 {% if forloop.first %}selected{% endif %}"
                                          title="{{ value }}"
                                          style="background-color:{{ variant_for_color.metafields.custom.color | default: value | downcase }};"
                                          data-variant-id="{{ variant_for_color.id }}"
                                          data-product-id="{{ paired_product.id }}"
                                          data-option-value="{{ value | escape }}"
                                          type="button"
                                        ></button>
                                      {% endfor %}
                                    </div>
                                  {% else %}
                                    <div></div>
                                  {% endif %}
                                </div>

                                <div class="mt-auto">
                                  <form method="post" action="/cart/add" class="w-full">
                                    <input
                                      type="hidden"
                                      name="id"
                                      value="{{ paired_product.first_available_variant.id }}"
                                    >
                                    <input type="hidden" name="quantity" value="1">
                                    <button
                                      type="submit"
                                      class="outfit-add-to-cart-btn border-2 w-full py-4 px-6 mb-3 relative {% unless paired_product.available %}sold-out-btn{% endunless %}"
                                      {% unless paired_product.available %}
                                        disabled
                                      {% endunless %}
                                      data-product-id="{{ paired_product.id }}"
                                    >
                                      <span class="btn-text outfit-sold-out">
                                        {% if paired_product.available %}ADD TO CART{% else %}SOLD OUT{% endif %}
                                      </span>
                                      <span class="notify-in-stock absolute left-0 top-0 w-full h-full flex items-center justify-center text-white bg-black bg-opacity-90 transition-opacity duration-200 pointer-events-none opacity-0">
                                        NOTIFY ME WHEN IN STOCK
                                      </span>
                                      <span class="loading-spinner hidden">
                                        <svg
                                          class="animate-spin h-5 w-5"
                                          xmlns="http://www.w3.org/2000/svg"
                                          fill="none"
                                          viewBox="0 0 24 24"
                                        >
                                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                      </span>
                                    </button>
                                  </form>
                                  {% if section.settings.show_full_details_link %}
                                    <a
                                      href="{{ paired_product.url }}"
                                      class="outfit-details block text-center text-[14px] "
                                    >
                                      {{ section.settings.redirect_link }}
                                    </a>
                                  {% endif %}
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      {% endif %}
                    {% endfor %}
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>

        <div class="outfit-navigation-arrows mobile-arrows">
          <button
            class="outfit-navigation-mobile flex items-center justify-center bg-color:var(--background) border-2 transition-opacity duration-300"
            id="outfit-slider-prev-mobile"
            aria-label="Previous"
            type="button"
          >
            <svg class="w-[22px] h-[22px]" fill="none" stroke="currentcolor" stroke-width="1" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>
          <button
            class="outfit-navigation-mobile flex items-center justify-center bg-color:var(--background) border-2 transition-opacity duration-300"
            id="outfit-slider-next-mobile"
            aria-label="Next"
            type="button"
          >
            <svg class="w-[22px] h-[22px]" fill="none" stroke="currentcolor" stroke-width="1" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .outfit-wrapper{
    gap: 27px;
  }
  .outfit-section-title {
    font-size: 74px !important;
  }
  .btn-text {
    font-size: 31px !important;
    font-weight: 500 !important;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
  }
  .outfit-sold-out {
    font-size: 12px;
    font-weight: 700;
    padding: 6px;
  }
  .outfit-add-to-cart-btn {
    cursor: pointer;
    height: 60px;
    width: 360px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
  }
    .outfit-add-to-cart-btn:hover {
      background: black;
      color: white;
    }
  .expand-product-btn {
    height: 30px;
    width: 30px;
    cursor: pointer;
  }
  .exapnded-product-img {
    height: 316px !important;
    width: 360px !important;
    border-radius: 16px !important;
  }
  .outfit-navigation {
    border-radius: 28px !important;
    width: 78px !important;
    height: 75px !important;
    cursor: pointer;
  }
  .outfit-arrow {
    transform: rotateX(180deg);
    height: 30px;
    width: 30px;
    cursor: pointer;
  }
  .outfit-size-option.selected {
    background: #000 !important;
    color: #fff !important;
    border: none !important;
  }
  .outfit-size-option {
    transition: background 0.2s, color 0.2s;
    height: 50px !important;
    width: 50px !important;
    border-radius: 15px !important;
  }
  .main-product-card {
    border-radius: 24px !important;
  }
  .paired-product-card {
    border-radius: 24px !important;
  }
  .paired-product-img {
    width: 140px !important;
    height: 150px !important;
    border-radius: 12px !important;
  }
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .paired-product-card.hidden-for-expand {
    display: none !important;
  }

  .expanded-product-card {
    border-radius: 24px !important;
    position: absolute;
    left: 0;
    right: 0;
    margin-left: auto;
    margin-right: auto;
    transform-origin: top center;
    transform: scaleY(0);
    opacity: 0;
    pointer-events: none;
    overflow: hidden;
    transition: transform 0.75s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.65s cubic-bezier(0.4, 0, 0.2, 1);
    width: 100%;
    max-width: 440px;
    height: 563px !important;
    z-index: 2;
  }

  .expanded-product-card.active {
    opacity: 1 !important;
    pointer-events: auto;
    transform: scaleY(1);
    margin: 0 !important;
    top: 0;
    left: 0;
    right: 0;
  }
  .outfit-main-img {
    height: 510px;
    width: 400px !important;
    padding: 12px;
    border-radius: 24px !important;
  }

  .paired-product-slide {
    min-height: 100%;
  }

  .paired-product-slide[data-products='1'] {
    justify-content: center !important;
  }

  .paired-product-slide[data-products='2'] {
    justify-content: center !important;
  }

  .mobile-arrows {
    display: none;
    justify-content: center;
    gap: 16px;
    margin-top: 20px;
  }

  .outfit-navigation-mobile {
    border-radius: 16px !important;
    width: 50px !important;
    height: 50px !important;
    cursor: pointer;
  }

  .desktop-arrows {
    display: block;
  }
  .notify-in-stock {
    border-radius: 10px;
    font-size: 22px;
    font-weight: 500;
  }

  @media (max-width: 767px) {
     .outfit-wrapper{
    gap: 20px;
  }
    .outfit-section-title {
      font-size: 36px !important;
    }
    .outfit-sold-out {
      font-size: 5px !important;
      padding: 4px !important;
    }
    .desktop-arrows {
      display: none !important;
    }

    .mobile-arrows {
      display: flex !important;
    }

    .line-clamp-2 {
      -webkit-line-clamp: 1;
    }
    .outfit-details {
      font-size: 10px;
    }
    .outfit-add-to-cart-btn {
      height: 40px !important;
      width: 145px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      text-align: center !important;
    }
    .btn-text {
      font-size: 16px !important;
      width: 100%;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      text-align: center !important;
    }
    .exapnded-product-img {
      height: 100px !important;
    }
    .paired-product-title,
    .outfit-expanded-title {
      font-size: 12px !important;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal;
      max-height: 1.2em;
    }
    .main-product-card h4,
    .paired-product-title,
    .outfit-expanded-title {
      word-break: break-word;
    }
    .expand-product-btn,
    .outfit-arrow {
      height: 10px !important;
      width: 10px !important;
    }
    .outfit-inspiration-section {
      padding: 10px 0 !important;
    }
    .max-w-5xl {
      max-width: 100vw !important;
      padding: 0 !important;
    }
    .flex-row.lg\:flex-row {
      flex-direction: row !important;
      align-items: center !important;
      gap: 12px !important;
    }
    .main-product-card {
      width: 184px !important;
      min-width: 0 !important;
      border-radius: 16px !important;
    }
    .outfit-main-img {
      height: 200px !important;
      width: 180px !important;
    }
    .max-w-\[409px\] {
      max-width: 172px !important;
      margin-left: 8px !important;
      margin-right: 0 !important;
    }
    .paired-product-card,
    .expanded-product-card {
      max-width: 165px !important;
      border-radius: 12px !important;
    }
    .paired-product-card {
      height: 75px !important;
      width: 160px !important;
      padding: 8px !important;
      gap: 4px !important;
    }
    .paired-product-img {
      width: 60px !important;
      height: 60px !important;
      border-radius: 8px !important;
    }
    .expanded-product-card {
      max-width: 172px !important;
      height: 250px !important;
      left: 0;
      right: 0;
      margin-left: auto;
      margin-right: auto;
      transform-origin: top center;
      transform: scaleY(0);
      opacity: 0;
      pointer-events: none;
      overflow: hidden;
      transition: transform 0.75s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.65s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .w-\[140px\],
    .h-\[150px\] {
      width: 60px !important;
      height: 60px !important;
    }
    .w-\[200px\] {
      width: 80px !important;
    }
    .h-\[250px\] {
      height: 90px !important;
    }
    .p-6 {
      padding: 8px !important;
    }
    .mb-4 {
      margin-bottom: 6px !important;
    }
    .rounded-lg {
      height: 180px;
      font-size: 10px;
    }
    .relative.overflow-hidden[style] {
      width: 165px !important;
      min-width: 0 !important;
      height: 250px !important;
    }
  }
  .sold-out-btn:hover .btn-text {
    opacity: 0;
    transition: opacity 0.15s;
  }
  .sold-out-btn:hover .notify-in-stock {
    opacity: 1;
    pointer-events: auto;
    transition: opacity 0.2s;
  }
  .sold-out-btn .notify-in-stock {
    cursor: pointer;
  }
  .text-red-600 {
    color: #dc2626 !important;
  }
  .line-through {
    text-decoration: line-through !important;
  }
  .outfit-navigation,
  .outfit-navigation-mobile,
  .main-product-card,
  .paired-product-card,
  .expanded-product-card,
  .outfit-add-to-cart-btn,
  .outfit-size-option,
  .color-swatch {
    border-color: {{ section.settings.border_color | default: '#000' }} !important;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const track = document.getElementById('outfit-slider-track');
    const prev = document.getElementById('outfit-slider-prev');
    const next = document.getElementById('outfit-slider-next');
    const prevMobile = document.getElementById('outfit-slider-prev-mobile');
    const nextMobile = document.getElementById('outfit-slider-next-mobile');
    const slides = track ? Array.from(track.getElementsByClassName('paired-product-slide')) : [];
    let currentSlide = 0;
    let expandedProductId = null;

    function showSlide(index) {
      slides.forEach((slide, idx) => {
        if (idx === index) {
          slide.style.display = 'flex';
          slide.style.opacity = '1';
        } else {
          slide.style.display = 'none';
          slide.style.opacity = '0';
        }
      });
    }

    function updateArrows() {
      if (prev && next) {
        if (slides.length <= 1 || expandedProductId) {
          prev.style.opacity = '0.3';
          next.style.opacity = '0.3';
          prev.style.pointerEvents = 'none';
          next.style.pointerEvents = 'none';
        } else {
          prev.style.pointerEvents = 'auto';
          next.style.pointerEvents = 'auto';
          prev.style.opacity = currentSlide === 0 ? '0.3' : '1';
          next.style.opacity = currentSlide >= slides.length - 1 ? '0.3' : '1';
        }
      }
      if (prevMobile && nextMobile) {
        if (slides.length <= 1 || expandedProductId) {
          prevMobile.style.opacity = '0.3';
          nextMobile.style.opacity = '0.3';
          prevMobile.style.pointerEvents = 'none';
          nextMobile.style.pointerEvents = 'none';
        } else {
          prevMobile.style.pointerEvents = 'auto';
          nextMobile.style.pointerEvents = 'auto';
          prevMobile.style.opacity = currentSlide === 0 ? '0.3' : '1';
          nextMobile.style.opacity = currentSlide >= slides.length - 1 ? '0.3' : '1';
        }
      }
    }

    function updateSlider() {
      showSlide(currentSlide);
      updateArrows();
    }

    function expandProduct(productId) {
      const currentSlideElement = slides[currentSlide];
      const compactCard = currentSlideElement.querySelector(`[data-product-id="${productId}"].paired-product-card`);
      const expandedCard = currentSlideElement.querySelector(`[data-product-id="${productId}"].expanded-product-card`);

      if (compactCard && expandedCard) {
        currentSlideElement.querySelectorAll('.paired-product-card').forEach((card) => {
          card.classList.add('hidden-for-expand');
        });
        expandedCard.classList.add('active');

        expandedProductId = productId;
        updateArrows();
      }
    }

    function collapseProduct(productId) {
      const currentSlideElement = slides[currentSlide];
      const expandedCard = currentSlideElement.querySelector(`[data-product-id="${productId}"].expanded-product-card`);

      if (expandedCard) {
        expandedCard.classList.remove('active');

        currentSlideElement.querySelectorAll('.paired-product-card').forEach((card) => {
          card.classList.remove('hidden-for-expand');
        });

        expandedProductId = null;
        updateArrows();
      }
    }

    if (slides.length > 0) {
      showSlide(0);
      updateArrows();
      document.addEventListener('click', function (e) {
        if (e.target.closest('.expand-product-btn')) {
          e.preventDefault();
          const btn = e.target.closest('.expand-product-btn');
          const productId = btn.getAttribute('data-product-id');

          if (window.innerWidth <= 767) {
            const productCard = btn.closest('.paired-product-card');
            const productUrl = productCard.getAttribute('data-product-url');
            if (productUrl) {
              window.location.href = productUrl;
              return;
            }
          }

          expandProduct(productId);
        }

        if (e.target.closest('.close-expanded-btn')) {
          e.preventDefault();
          const btn = e.target.closest('.close-expanded-btn');
          const productId = btn.getAttribute('data-product-id');
          collapseProduct(productId);
        }
      });

      prev?.addEventListener('click', (e) => {
        e.preventDefault();
        if (currentSlide > 0 && !expandedProductId) {
          currentSlide--;
          updateSlider();
        }
      });

      next?.addEventListener('click', (e) => {
        e.preventDefault();
        if (currentSlide < slides.length - 1 && !expandedProductId) {
          currentSlide++;
          updateSlider();
        }
      });

      prevMobile?.addEventListener('click', (e) => {
        e.preventDefault();
        if (currentSlide > 0 && !expandedProductId) {
          currentSlide--;
          updateSlider();
        }
      });

      nextMobile?.addEventListener('click', (e) => {
        e.preventDefault();
        if (currentSlide < slides.length - 1 && !expandedProductId) {
          currentSlide++;
          updateSlider();
        }
      });
    } else {
      if (prev) prev.style.display = 'none';
      if (next) next.style.display = 'none';
      if (prevMobile) prevMobile.style.display = 'none';
      if (nextMobile) nextMobile.style.display = 'none';
    }

    console.log('Total slides found:', slides.length);
  });

  document.addEventListener('click', function (e) {
    if (e.target.classList.contains('outfit-size-option') && !e.target.disabled) {
      const selectedBtn = e.target;
      const expandedCard = selectedBtn.closest('.expanded-product-card');

      if (expandedCard) {
        expandedCard.querySelectorAll('.outfit-size-option').forEach((option) => {
          option.classList.remove('selected');
        });
        selectedBtn.classList.add('selected');
        const form = expandedCard.querySelector('form');
        if (form) {
          const variantId = selectedBtn.getAttribute('data-variant-id');
          form.querySelector('input[name="id"]').value = variantId;
        }
      }
    }
    if (e.target.classList.contains('color-swatch') && !e.target.disabled) {
      const selectedSwatch = e.target;
      const expandedCard = selectedSwatch.closest('.expanded-product-card');

      if (expandedCard) {
        expandedCard.querySelectorAll('.color-swatch').forEach((swatch) => {
          swatch.classList.remove('selected');
        });
        selectedSwatch.classList.add('selected');
        const form = expandedCard.querySelector('form');
        if (form) {
          const variantId = selectedSwatch.getAttribute('data-variant-id');
          form.querySelector('input[name="id"]').value = variantId;
        }
      }
    }
  });
  document.addEventListener('click', function (e) {
    if (!e.target.closest('.outfit-add-to-cart-btn')) return;

    e.preventDefault();
    const form = e.target.closest('form');
    const button = form.querySelector('.outfit-add-to-cart-btn');
    const btnText = button.querySelector('.btn-text');
    const spinner = button.querySelector('.loading-spinner');

    button.disabled = true;
    btnText.classList.add('hidden');
    spinner.classList.remove('hidden');

    fetch('/cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        items: [
          {
            id: form.querySelector('input[name="id"]').value,
            quantity: parseInt(form.querySelector('input[name="quantity"]').value),
          },
        ],
      }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.status) {
          throw new Error(data.description || 'Error adding product to cart');
        }

        btnText.textContent = 'ADDED!';
        setTimeout(() => {
          btnText.textContent = 'ADD TO CART';
        }, 2000);
      })
      .catch((error) => {
        console.error('Error:', error);
        btnText.textContent = 'NOT AVAILABLE';
      })
      .finally(() => {
        button.disabled = false;
        btnText.classList.remove('hidden');
        spinner.classList.add('hidden');
      });
  });
</script>

{% schema %}
{
  "name": "Outfit Inspiration",
  "tag": "section",
  "enabled_on": { "templates": ["product"] },
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Outfit Inspiration"
    },
    {
      "type": "select",
      "id": "title_align",
      "label": "Section Title Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "text",
      "id": "redirect_link",
      "label": "Redirect Link",
      "default": "Show Full Details"
    },
    {
      "type": "checkbox",
      "id": "show_full_details_link",
      "label": "Show 'Show full details' link below Add to Cart",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border Color",
      "default": "#000000"
    }
  ],
  "blocks": [
    {
      "type": "product_group",
      "name": "Paired Products",
      "settings": [
        {
          "type": "product",
          "id": "product_1",
          "label": "Product 1"
        },
        {
          "type": "product",
          "id": "product_2",
          "label": "Product 2"
        },
        {
          "type": "product",
          "id": "product_3",
          "label": "Product 3"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Outfit Inspiration"
    }
  ]
}
{% endschema %}
