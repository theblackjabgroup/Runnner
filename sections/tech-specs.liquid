{% if template == 'product' %}
  <section
    class="tech-specs-container color-{{ section.settings.color_scheme }} box-border overflow-x-hidden"
    style="padding: var(--sections-spacing-top) var(--gutter-sm) var(--sections-spacing-bottom);"
  >
    <div class="tech-specs-outer">
      <div class="tech-specs-main flex flex-col lg:flex-row relative items-start">
        <!-- LEFT COLUMN: TECH SPECS -->
        <div
          class="tech-left-box relative z-20 flex flex-col min-h-full w-full lg:w-[80%]"
        >
          <h2
            class="tech-left-box-heading !text-[32px] !font-medium tracking-wide uppercase text-left"
            style="margin-bottom: 24px;"
          >
            {{ section.settings.tech_specs_heading }}
          </h2>
          <div>
            {% for block in section.blocks %}
              {% case block.type %}
                {% when 'fit_pocketing' %}
                  <div {{ block.shopify_attributes }}>
                    <!-- Fit -->
                    <div class="tech-specs-data-border flex flex-row items-center border-b">
                      <span class="tech-specs-data text-[12px] font-normal">
                        {{ block.settings.fit_label }}
                      </span>
                      <span class="text-[12px] font-medium flex items-center  pl-6">
                        {{ product.metafields.tech_specs.fit.value | default: block.settings.fit_value }}
                      </span>
                    </div>
                    <!-- Pocketing -->
                    <div class="tech-specs-data-border flex flex-row items-center border-b">
                      <span class="tech-specs-data text-[13px] font-normal">
                        {{ block.settings.pocketing_label }}
                      </span>
                      <span class="text-[13px] font-medium pl-6">
                        {{- product.metafields.tech_specs.pocketing.value | default: block.settings.pocketing_value -}}
                      </span>
                    </div>
                  </div>

                {% when 'effort_temperature' %}
                  <div {{ block.shopify_attributes }}>
                    <div class="flex flex-col  border-b">
                      <!-- Effort -->
                      <div class="flex flex-col lg:flex-row border-b">
                        <!-- Text Column -->
                        <div class="tech-specs-data-border grid grid-cols-2 ">
                          <div class="tech-specs-data">
                            <div class="text-[13px] font-medium mb-1">
                              {{ block.settings.effort_label }}
                            </div>
                            <div class="text-[12px] font-normal mb-2">
                              {{ block.settings.effort_desc }}
                            </div>
                          </div>
                          <div class="tech-specs-bars flex flex-col items-center justify-center pl-6">
                            <!-- Effort Bar -->
                            <div class="flex justify-between w-full max-w-full" id="effort-bar">
                              {% for i in (1..90) %}
                                <div class="box">|</div>
                              {% endfor %}
                            </div>
                            <!-- Scale Labels -->
                            <div class="flex justify-between text-[13px] w-full mt-1">
                              <span>{{ block.settings.effort_scale_0 }}</span>
                              <span>{{ block.settings.effort_scale_25 }}</span>
                              <span>{{ block.settings.effort_scale_50 }}</span>
                              <span>{{ block.settings.effort_scale_75 }}</span>
                              <span>{{ block.settings.effort_scale_100 }}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- Temperature -->
                      <div class="tech-specs-data-border grid grid-cols-2">
                        <div class="tech-specs-data">
                          <div class="text-[13px] font-medium mb-1">
                            {{ block.settings.temperature_label }}
                          </div>
                          <div class="text-[12px] font-normal mb-2">
                            {{ block.settings.temperature_desc }}
                          </div>
                        </div>
                        <div class="tech-specs-bars flex flex-col items-center justify-center pl-6">
                          <!-- Temperature Bar -->
                          <div class="flex justify-between w-full max-w-full" id="temperature-bar">
                            {% for i in (1..90) %}
                              <div class="box">|</div>
                            {% endfor %}
                          </div>
                          <!-- Scale Labels -->
                          <div class="flex justify-between text-[14px] w-full mt-1">
                            <span>{{ block.settings.temp_scale_0 }}</span>
                            <span>{{ block.settings.temp_scale_32 }}</span>
                            <span>{{ block.settings.temp_scale_50 }}</span>
                            <span>{{ block.settings.temp_scale_70 }}</span>
                            <span>{{ block.settings.temp_scale_85 }}</span>
                            <span>{{ block.settings.temp_scale_95 }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
              {% endcase %}
            {% endfor %}

            <div class="flex flex-col lg:flex-row" style="margin-top: 24px;">
              {% for block in section.blocks %}
                {% if block.type == 'materials' or block.type == 'care' or block.type == 'additional_info' %}
                  {% case block.type %}
                    {% when 'materials' %}
                      <div {{ block.shopify_attributes }} class="w-full lg:w-1/3 mb-2 lg:mb-0">
                        <div class="font-medium text-[16px] mb-3 text-left">
                          {{ block.settings.materials_label }}
                        </div>
                        <div class="text-[13px] font-normal leading-relaxed text-left">
                          {{ product.metafields.tech_specs.materials.value | default: block.settings.materials_value }}
                        </div>
                      </div>
                    {% when 'care' %}
                      <div {{ block.shopify_attributes }} class="w-full lg:w-1/3 mb-2 lg:mb-0">
                        <div class="font-medium text-[16px] mb-3 text-left">
                          {{ block.settings.care_label }}
                        </div>
                        <div class="text-[13px] font-normal leading-relaxed text-left">
                          {% assign care_lines = product.metafields.tech_specs.care.value
                            | default: block.settings.care_value
                            | split: '\n'
                          %}
                          {% for line in care_lines %}
                            <div class="flex items-start gap-2 mb-2">
                              <span>{{ line }}</span>
                            </div>
                          {% endfor %}
                        </div>
                      </div>
                    {% when 'additional_info' %}
                      <div {{ block.shopify_attributes }} class="w-full lg:w-1/3">
                        <div class="text-[13px] font-normal leading-relaxed text-left">
                          {{ block.settings.additional_info }}
                        </div>
                      </div>
                  {% endcase %}
                {% endif %}
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- RIGHT COLUMN: FUNCTIONALITY -->
        {% for block in section.blocks %}
          {% if block.type == 'functionality' %}
            <div
              {{ block.shopify_attributes }}
              class="functionality-right-box relative flex flex-col lg:w-[20%]"
            >
              <h2
                class=" functionality-right-box-heading !text-[32px] !font-medium tracking-wide uppercase"
                style="margin-bottom: 24px;"
              >
                {{ block.settings.features_heading }}
              </h2>
              <div class="flex flex-col" style="gap: var(--gutter-md);">
                <!-- Feature 1 -->
                <div class="flex items-center" style="gap: var(--gutter-md); ">
                  <span
                    class="functionality-icons-background flex-shrink-0 rounded-full flex items-center justify-center"
                    style="background-color: var(--background); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); width:82px; height:83px;"
                  >
                    {% if block.settings.feature_icon_1 != blank %}
                      <img
                        srcset="
                          {%- if block.settings.feature_icon_1.width >= 34 -%}{{ block.settings.feature_icon_1 | image_url: width: 34 }} 34w,{%- endif -%}
                          {%- if block.settings.feature_icon_1.width >= 67 -%}{{ block.settings.feature_icon_1 | image_url: width: 67 }} 67w,{%- endif -%}
                          {%- if block.settings.feature_icon_1.width >= 134 -%}{{ block.settings.feature_icon_1 | image_url: width: 134 }} 134w,{%- endif -%}
                          {{ block.settings.feature_icon_1 | image_url }} {{ block.settings.feature_icon_1.width }}w
                        "
                        sizes="67px"
                        src="{{ block.settings.feature_icon_1 | image_url: width: 67 }}"
                        alt="{{ block.settings.feature_icon_1.alt | escape | default: 'Feature 1 Icon' }}"
                        class="feature-icon"
                        style="width:50px;height:50px;"
                        loading="lazy"
                        decode="async"
                        width="67"
                        height="67"
                      >
                    {% else %}
                      {%- comment -%} Custom Delivery Truck Icon {%- endcomment -%}
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="50"
                        height="50"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                      >
                        <path fill-rule="evenodd" d="M4 5.25a.75.75 0 0 1 .75-.75h6.991a2.75 2.75 0 0 1 2.645 1.995l.427 1.494a.25.25 0 0 0 .18.173l1.681.421a1.75 1.75 0 0 1 1.326 1.698v1.219a1.75 1.75 0 0 1-1.032 1.597 2.5 2.5 0 1 1-4.955.153h-3.025a2.5 2.5 0 1 1-4.78-.75h-.458a.75.75 0 0 1 0-1.5h2.5c.03 0 .06.002.088.005a2.493 2.493 0 0 1 1.947.745h4.43a2.493 2.493 0 0 1 1.785-.75c.698 0 1.33.286 1.783.748a.25.25 0 0 0 .217-.248v-1.22a.25.25 0 0 0-.19-.242l-1.682-.42a1.75 1.75 0 0 1-1.258-1.217l-.427-1.494a1.25 1.25 0 0 0-1.202-.907h-6.991a.75.75 0 0 1-.75-.75Zm2.5 9.25a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm8 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"/>
                        <path d="M3.25 8a.75.75 0 0 0 0 1.5h5a.75.75 0 0 0 0-1.5h-5Z"/>
                      </svg>
                    {% endif %}
                  </span>
                  <div class="functionality-feature-content">
                    <div class="font-medium uppercase text-[14px] mb-4 tracking-wide">
                      {{
                        block.settings.feature1_title
                        | default: product.metafields.functionality.feature_title1.value
                      }}
                    </div>
                    <div class="text-[14px] font-normal leading-relaxed">
                      {{
                        block.settings.feature1_desc
                        | default: product.metafields.functionality.feature_description1.value
                      }}
                    </div>
                  </div>
                </div>

                <!-- Feature 2 -->
                <div class="flex items-center" style="gap: var(--gutter-md); ">
                  <span
                    class="functionality-icons-background flex-shrink-0 rounded-full flex items-center justify-center"
                    style="background-color: var(--background); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); width:82px; height:83px;"
                  >
                    {% if block.settings.feature_icon_2 != blank %}
                      <img
                        srcset="
                          {%- if block.settings.feature_icon_2.width >= 34 -%}{{ block.settings.feature_icon_2 | image_url: width: 34 }} 34w,{%- endif -%}
                          {%- if block.settings.feature_icon_2.width >= 67 -%}{{ block.settings.feature_icon_2 | image_url: width: 67 }} 67w,{%- endif -%}
                          {%- if block.settings.feature_icon_2.width >= 134 -%}{{ block.settings.feature_icon_2 | image_url: width: 134 }} 134w,{%- endif -%}
                          {{ block.settings.feature_icon_2 | image_url }} {{ block.settings.feature_icon_2.width }}w
                        "
                        sizes="67px"
                        src="{{ block.settings.feature_icon_2 | image_url: width: 67 }}"
                        alt="{{ block.settings.feature_icon_2.alt | escape | default: 'Feature 2 Icon' }}"
                        class="feature-icon"
                        style="width:50px;height:50px;"
                        loading="lazy"
                        decode="async"
                        width="67"
                        height="67"
                      >
                    {% else %}
                      {%- comment -%} Custom Store Icon {%- endcomment -%}
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="50"
                        height="50"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                      >
                        <path fill-rule="evenodd" d="M13.257 3h-6.514a1.25 1.25 0 0 0-.983.478l-2.386 3.037a1.75 1.75 0 0 0-.374 1.08v.655a2.75 2.75 0 0 0 1.5 2.45v4.55c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 0 0 1.75-1.75v-4.55a2.75 2.75 0 0 0 1.5-2.45v-.481c0-.504-.17-.994-.48-1.39l-2.28-2.901a1.25 1.25 0 0 0-.983-.478Zm-.257 12.5h.75a.25.25 0 0 0 .25-.25v-4.25a2.742 2.742 0 0 1-2-.863 2.742 2.742 0 0 1-2 .863 2.742 2.742 0 0 1-2-.863 2.742 2.742 0 0 1-2 .863v4.25c0 .138.112.25.25.25h3.75v-2.5a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v2.5Zm-7-6h-.25c-.69 0-1.25-.56-1.25-1.25v-.654a.25.25 0 0 1 .053-.155l2.312-2.941h6.27l2.205 2.805a.75.75 0 0 1 .16.464v.481c0 .69-.56 1.25-1.25 1.25h-.25c-.69 0-1.25-.56-1.25-1.25v-.5a.75.75 0 0 0-1.5 0v.5a1.25 1.25 0 1 1-2.5 0v-.5a.75.75 0 0 0-1.5 0v.5c0 .69-.56 1.25-1.25 1.25Z"/>
                      </svg>
                    {% endif %}
                  </span>
                  <div class="functionality-feature-content">
                    <div class="font-medium uppercase text-[14px] mb-4 tracking-wide">
                      {{
                        block.settings.feature2_title
                        | default: product.metafields.functionality.feature_title2.value
                      }}
                    </div>
                    <div class="text-[14px] font-normal leading-relaxed">
                      {{
                        block.settings.feature2_desc
                        | default: product.metafields.functionality.feature_description2.value
                      }}
                    </div>
                  </div>
                </div>

                <!-- Feature 3 -->
                <div class="flex items-center" style="gap: var(--gutter-md);">
                  <span
                    class="functionality-icons-background flex-shrink-0 rounded-full flex items-center justify-center"
                    style="background-color: var(--background); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); width:82px; height:83px;"
                  >
                    {% if block.settings.feature_icon_3 != blank %}
                      <img
                        srcset="
                          {%- if block.settings.feature_icon_3.width >= 34 -%}{{ block.settings.feature_icon_3 | image_url: width: 34 }} 34w,{%- endif -%}
                          {%- if block.settings.feature_icon_3.width >= 67 -%}{{ block.settings.feature_icon_3 | image_url: width: 67 }} 67w,{%- endif -%}
                          {%- if block.settings.feature_icon_3.width >= 134 -%}{{ block.settings.feature_icon_3 | image_url: width: 134 }} 134w,{%- endif -%}
                          {{ block.settings.feature_icon_3 | image_url }} {{ block.settings.feature_icon_3.width }}w
                        "
                        sizes="67px"
                        src="{{ block.settings.feature_icon_3 | image_url: width: 67 }}"
                        alt="{{ block.settings.feature_icon_3.alt | escape | default: 'Feature 3 Icon' }}"
                        class="feature-icon"
                        style="width:50px;height:50px;"
                        loading="lazy"
                        decode="async"
                        width="67"
                        height="67"
                      >
                    {% else %}
                      {%- comment -%} Custom Package with Checkmark Icon {%- endcomment -%}
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="50"
                        height="50"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                      >
                        <path fill-rule="evenodd" d="M5 8v6.75c0 .138.112.25.25.25h4a.75.75 0 0 1 0 1.5h-4a1.75 1.75 0 0 1-1.75-1.75v-6.863c0-.57.177-1.125.506-1.59l1.309-1.848a2.25 2.25 0 0 1 1.836-.949h5.796a2.25 2.25 0 0 1 1.872 1.002l1.22 1.828c.3.452.461.983.461 1.526v3.644a.75.75 0 0 1-1.5 0v-3.5h-10Zm1.539-2.684a.75.75 0 0 1 .612-.316h2.099v1.5h-3.55l.839-1.184Zm7.81 1.184-.778-1.166a.75.75 0 0 0-.624-.334h-2.197v1.5h3.599Z"/>
                        <path fill-rule="evenodd" d="M6 10a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-3Zm1.5.5v2h3v-2h-3Z"/>
                        <path d="M17.78 13.22a.75.75 0 0 1 0 1.06l-3.5 3.5a.75.75 0 0 1-1.06 0l-1.75-1.75a.75.75 0 1 1 1.06-1.06l1.22 1.22 2.97-2.97a.75.75 0 0 1 1.06 0Z"/>
                      </svg>
                    {% endif %}
                  </span>
                  <div class="functionality-feature-content">
                    <div class="font-medium uppercase text-[14px] mb-4 tracking-wide">
                      {{
                        block.settings.feature3_title
                        | default: product.metafields.functionality.feature_title3.value
                      }}
                    </div>
                    <div class="text-[14px] font-normal leading-relaxed">
                      {{
                        block.settings.feature3_desc
                        | default: product.metafields.functionality.feature_description3.value
                      }}
                    </div>
                  </div>
                </div>

                <!-- Feature 4 -->
                <div class="flex items-center" style="gap: var(--gutter-md);">
                  <span
                    class="functionality-icons-background flex-shrink-0 rounded-full flex items-center justify-center"
                    style="background-color: var(--background); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); width:82px; height:83px;"
                  >
                    {% if block.settings.feature_icon_4 != blank %}
                      <img
                        srcset="
                          {%- if block.settings.feature_icon_4.width >= 34 -%}{{ block.settings.feature_icon_4 | image_url: width: 34 }} 34w,{%- endif -%}
                          {%- if block.settings.feature_icon_4.width >= 67 -%}{{ block.settings.feature_icon_4 | image_url: width: 67 }} 67w,{%- endif -%}
                          {%- if block.settings.feature_icon_4.width >= 134 -%}{{ block.settings.feature_icon_4 | image_url: width: 134 }} 134w,{%- endif -%}
                          {{ block.settings.feature_icon_4 | image_url }} {{ block.settings.feature_icon_4.width }}w
                        "
                        sizes="67px"
                        src="{{ block.settings.feature_icon_4 | image_url: width: 67 }}"
                        alt="{{ block.settings.feature_icon_4.alt | escape | default: 'Feature 4 Icon' }}"
                        class="feature-icon"
                        style="width:50px;height:50px;"
                        loading="lazy"
                        decode="async"
                        width="67"
                        height="67"
                      >
                    {% else %}
                      {%- comment -%} Custom Leaf/Nature Icon {%- endcomment -%}
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="50"
                        height="50"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                      >
                        <path fill-rule="evenodd" d="M4 3a1 1 0 0 0-1 1v4.25a6.75 6.75 0 0 0 6.75 6.75v1.25a.75.75 0 0 0 1.5 0v-1.293a6.501 6.501 0 0 0 5.75-6.457v-1.52a.98.98 0 0 0-.98-.98c-1.99 0-3.762.926-4.91 2.371a6.752 6.752 0 0 0-6.61-5.371h-.5Zm8.035 10.26a5.002 5.002 0 0 0 3.465-4.76v-.972a4.772 4.772 0 0 0-4.227 4.275l1.387-1.766a.75.75 0 1 1 1.18.926l-1.805 2.297Zm-5.905-4.338 3.104 4.553a5.25 5.25 0 0 1-4.734-5.225v-3.75c2.9 0 5.25 2.35 5.25 5.25v1.819l-2.38-3.492a.75.75 0 1 0-1.24.845Z"/>
                      </svg>
                    {% endif %}
                  </span>
                  <div class="functionality-feature-content">
                    <div class="font-medium uppercase text-[14px] mb-4 tracking-wide">
                      {{
                        block.settings.feature4_title
                        | default: product.metafields.functionality.feature_title4.value
                      }}
                    </div>
                    <div class="text-[14px] font-normal leading-relaxed">
                      {{
                        block.settings.feature4_desc
                        | default: product.metafields.functionality.feature_description4.value
                      }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </section>
{% endif %}

<style>
    /* Background image styling */
    .tech-specs-container {
      position: relative;
      {% if section.settings.desktop_background_image != blank %}
        background-image: url('{{ section.settings.desktop_background_image | image_url: width: 1920 }}') !important;
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
      {% else %}
        background-color: var(--background) !important;
      {% endif %}
    }

    /* Mobile background image with fallback */
    @media (max-width: 768px) {
      .tech-specs-container {
        {% if section.settings.mobile_background_image != blank %}
          background-image: url('{{ section.settings.mobile_background_image | image_url: width: 800 }}') !important;
          background-size: cover !important;
          background-position: center !important;
          background-repeat: no-repeat !important;
        {% elsif section.settings.desktop_background_image != blank %}
          background-image: url('{{ section.settings.desktop_background_image | image_url: width: 1920 }}') !important;
          background-size: cover !important;
          background-position: center !important;
          background-repeat: no-repeat !important;
        {% endif %}
      }
    }

    .tech-specs-data-border{
      border-color: var(--border);
      border-opacity: 0.1;
      gap: var(--space-5xl);
    }
    .tech-left-box, .functionality-right-box{
      color: var(--text);
    }

    .functionality-right-box-heading, .tech-left-box-heading{
      /* Margin set inline for consistency */
    }
    .tech-specs-main{
      gap: var(--space-3xl);
    }
    .tech-specs-data{
      padding: var(--space-3xl) 0;
    }

    .box {
      transition: color 0.3s ease;
      opacity: 0.3;
    }

    .box.filled {
      animation: fillBar 0.6s ease-in-out forwards;
    }

    @keyframes fillBar {
      0% {
        color: var(--text);
        opacity: 0.3;
      }
      100% {
        color: {{ section.settings.bar_color | default: 'red' }};
        opacity: 1;
      }
    }

    /* Hide excess bars on smaller screens */
    @media (max-width: 480px) {
      .box:nth-child(n+30) {
        display: none;
      }
      .tech-left-box{
        padding-right: 0;
      }
    }

    @media (min-width: 481px) and (max-width: 990px) {
      .box:nth-child(n+41) {
        display: none;
      }
    }

    @media (min-width: 991px) and (max-width: 1499px) {
      .box:nth-child(n+55) {
        display: none;
      }
    }

    @media (min-width: 1500px) and (max-width: 1599px) {
      .box:nth-child(n+55) {
        display: none;
      }
    }

    @media (min-width: 1600px) and (max-width: 1699px) {
      .box:nth-child(n+61) {
        display: none;
      }
    }

    @media (min-width: 1700px) and (max-width: 1799px) {
      .box:nth-child(n+71) {
        display: none;
      }
    }

    @media (min-width: 1800px) and (max-width: 1899px) {
      .box:nth-child(n+81) {
        display: none;
      }
    }

    .tech-left-box {
      border-right: 1px solid var(--border);
      padding-right: var(--space-4xl);
    }

    .tech-specs-data {
      width: 230px;
    }

     .functionality-feature-content {
       display: flex;
       flex-direction: column;
       justify-content: center;
       min-height: 83px;
     }
     @media (max-width: 1024px){
      .tech-left-box {
        border-right: none;
      }
      .functionality-right-box {
        padding-left: 0 !important;
      }
  }

    @media screen and (min-width: 750px) {


      #effort-bar, #temperature-bar {
        gap: var(--space-sm);
      }
    }


    @media screen and (max-width: 1445px) {
      .tech-specs-container {
        padding: var(--sections-spacing-top) var(--gutter-lg) var(--sections-spacing-bottom) !important;
      }
      .tech-specs-data-border{
        gap: var(--space-xl);
      }
      #effort-bar, #temperature-bar {
        gap: var(--space-md);
      }
    }
    @media (max-width: 400px){
      #effort-bar, #temperature-bar {
        gap: var(--space-xs);
      }
    }


    @media (max-width: 700px) {
      .tech-specs-container{
        padding: var(--sections-spacing-top) var(--gutter-sm-safe-right) var(--sections-spacing-bottom) var(--gutter-sm-safe-left) !important;
      }

      .tech-specs-bars {
        padding-left: 0;
        width: 100%;
      }
      .tech-specs-data {
        width: 170px;
      }
      .tech-width {
        width: auto;
      }
      .functionality-icons-background{
        height: 63px !important;
        width: 62px !important;
      }

      .functionality-icons {
        width: 50px;
        height: 51px;
      }
      .tech-specs-bars .box:nth-child(n + 30) {
        display: none;
      }
      .tech-left-box {
        border-right: none;
        padding-right: 0;
      }
    }
</style>

<script>
  function updateTechSpecBars(animate = true) {
    const effortValue = {{ product.metafields.tech_specs.effort.value | default: 0 }};
    const tempMin = {{ product.metafields.tech_specs.temp_min.value | default: 0 }};
    const tempMax = {{ product.metafields.tech_specs.temp_max.value | default: 0 }};

    const width = window.innerWidth;
    let totalBars;

    if (width <= 480) {
      totalBars = 29;
    } else if (width <= 990) {
      totalBars = 40;
    } else if (width < 1600) {
      totalBars = 54;
    } else if (width < 1700) {
      totalBars = 60;
    } else if (width < 1800) {
      totalBars = 70;
    } else if (width < 1900) {
      totalBars = 80;
    } else {
      totalBars = 90;
    }

    // Effort bars with loading animation
    const effortBar = document.getElementById('effort-bar');
    if (effortBar && effortValue > 0) {
      const effortBars = effortBar.querySelectorAll('.box');
      const effortFilled = Math.floor((effortValue * totalBars) / 100);

      effortBars.forEach((bar, i) => {
        if (i < effortFilled) {
          if (animate && !bar.classList.contains('filled')) {
            // Add staggered delay for loading animation effect
            setTimeout(() => {
              bar.classList.add('filled');
            }, i * 25); // 15ms delay between each bar
          } else if (!animate) {
            bar.classList.add('filled');
          }
        } else {
          bar.classList.remove('filled');
        }
      });
    }

    // Temperature bars with loading animation
    const temperatureBar = document.getElementById('temperature-bar');
    if (temperatureBar && tempMin >= 0 && tempMax > 0 && tempMax > tempMin) {
      const tempBars = temperatureBar.querySelectorAll('.box');
      const tempStartPos = Math.round((tempMin / 95) * (totalBars - 1));
      const tempEndPos = Math.round((tempMax / 95) * (totalBars - 1));
      let animationIndex = 0;

      tempBars.forEach((bar, i) => {
        if (i >= tempStartPos && i <= tempEndPos) {
          if (animate && !bar.classList.contains('filled')) {
            // Add staggered delay for loading animation effect
            setTimeout(() => {
              bar.classList.add('filled');
            }, animationIndex * 25); // 15ms delay between each bar
            animationIndex++;
          } else if (!animate) {
            bar.classList.add('filled');
          }
        } else {
          bar.classList.remove('filled');
        }
      });
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    const techSpecsSection = document.querySelector('.tech-specs-container');
    let hasAnimated = false;
    let lastWidth = window.innerWidth;

    if (techSpecsSection) {
      // Create an Intersection Observer to detect when section is visible
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          // Trigger animation when section is at least 20% visible
          if (entry.isIntersecting && entry.intersectionRatio >= 0.5 && !hasAnimated) {
            hasAnimated = true;
            updateTechSpecBars(true);
          }
        });
      }, {
        threshold: [0.5] // Trigger when 20% of section is visible
      });

      // Start observing the tech specs section
      observer.observe(techSpecsSection);
    }

    window.addEventListener('resize', function() {
      const width = window.innerWidth;

      // Check if we crossed a breakpoint
      const breakpoints = [481, 991, 1600, 1700, 1800, 1900];
      let crossedBreakpoint = false;

      for (let bp of breakpoints) {
        if ((lastWidth < bp && width >= bp) || (lastWidth >= bp && width < bp)) {
          crossedBreakpoint = true;
          break;
        }
      }

      if (crossedBreakpoint && hasAnimated) {
        lastWidth = width;
        updateTechSpecBars(false);
      }
    });
  });
</script>
{% schema %}
{
  "name": "Tech Specs",
  "tag": "section",
  "enabled_on": { "templates": ["product"] },
  "settings": [
    {
      "type": "text",
      "id": "tech_specs_heading",
      "label": "Tech Specs Heading",
      "default": "TECH SPECS"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-2"
    },
    {
      "type": "color",
      "id": "bar_color",
      "label": "Bar Fill Color",
      "default": "#ff0000"
    },
    {
      "type": "image_picker",
      "id": "desktop_background_image",
      "label": "Desktop Background Image",
      "info": "Recommended size: 1920x1080px. This image will be shown on desktop and tablet devices."
    },
    {
      "type": "image_picker",
      "id": "mobile_background_image",
      "label": "Mobile Background Image",
      "info": "Recommended size: 800x1200px. This image will be shown on mobile devices (768px and below). Falls back to desktop image if not set."
    }
  ],
  "blocks": [
    {
      "type": "fit_pocketing",
      "name": "Fit & Pocketing",
      "settings": [
        {
          "type": "text",
          "id": "fit_label",
          "label": "Fit Label",
          "default": "Fit"
        },
        {
          "type": "text",
          "id": "fit_value",
          "label": "Fit Value (default)",
          "default": "Fitted"
        },
        {
          "type": "text",
          "id": "pocketing_label",
          "label": "Pocketing Label",
          "default": "Pocketing"
        },
        {
          "type": "text",
          "id": "pocketing_value",
          "label": "Pocketing Value (default)",
          "default": "2 Gel, 1 Phone"
        }
      ]
    },
    {
      "type": "functionality",
      "name": "Functionality",
      "settings": [
        {
          "type": "text",
          "id": "features_heading",
          "label": "Features Heading",
          "default": "FUNCTIONALITY"
        },
        {
          "type": "text",
          "id": "feature1_title",
          "label": "Feature 1 Title",
          "default": "FEATURE 1"
        },
        {
          "type": "textarea",
          "id": "feature1_desc",
          "label": "Feature 1 Description",
          "default": "Briefly describe the first feature here. Highlight the main benefit and explain how it improves the product experience for the customer."
        },
        {
          "type": "image_picker",
          "id": "feature_icon_1",
          "label": "Feature 1 Icon"
        },
        {
          "type": "text",
          "id": "feature2_title",
          "label": "Feature 2 Title",
          "default": "FEATURE 2"
        },
        {
          "type": "textarea",
          "id": "feature2_desc",
          "label": "Feature 2 Description",
          "default": "Use this space to describe the second feature in detail. Explain its purpose, why it matters, and how it enhances usability, comfort, or performance for users."
        },
        {
          "type": "image_picker",
          "id": "feature_icon_2",
          "label": "Feature 2 Icon"
        },
        {
          "type": "text",
          "id": "feature3_title",
          "label": "Feature 3 Title",
          "default": "FEATURE 3"
        },
        {
          "type": "textarea",
          "id": "feature3_desc",
          "label": "Feature 3 Description",
          "default": "Describe the third feature clearly. Focus on its unique quality, the value it adds, and how it benefits users during everyday use."
        },
        {
          "type": "image_picker",
          "id": "feature_icon_3",
          "label": "Feature 3 Icon"
        },
        {
          "type": "text",
          "id": "feature4_title",
          "label": "Feature 4 Title",
          "default": "FEATURE 4"
        },
        {
          "type": "textarea",
          "id": "feature4_desc",
          "label": "Feature 4 Description",
          "default": "Provide details about the fourth feature here. Explain the function, the advantage it gives, and why this feature sets the product apart from alternatives."
        },
        {
          "type": "image_picker",
          "id": "feature_icon_4",
          "label": "Feature 4 Icon"
        }
      ]
    },
    {
      "type": "effort_temperature",
      "name": "Effort & Temperature",
      "settings": [
        {
          "type": "text",
          "id": "effort_label",
          "label": "Effort Label",
          "default": "Effort"
        },
        {
          "type": "text",
          "id": "effort_desc",
          "label": "Effort Description",
          "default": "This product was designed for any and every run."
        },
        {
          "type": "text",
          "id": "temperature_label",
          "label": "Temperature Label",
          "default": "Temperature"
        },
        {
          "type": "text",
          "id": "temperature_desc",
          "label": "Temperature Description",
          "default": "Designed for cool to hot temperatures."
        },
        {
          "type": "text",
          "id": "effort_scale_0",
          "label": "Effort Scale: 1",
          "default": "0%"
        },
        {
          "type": "text",
          "id": "effort_scale_25",
          "label": "Effort Scale: 2",
          "default": "25%"
        },
        {
          "type": "text",
          "id": "effort_scale_50",
          "label": "Effort Scale: 3",
          "default": "50%"
        },
        {
          "type": "text",
          "id": "effort_scale_75",
          "label": "Effort Scale: 4",
          "default": "75%"
        },
        {
          "type": "text",
          "id": "effort_scale_100",
          "label": "Effort Scale: 5",
          "default": "100%"
        },
        {
          "type": "text",
          "id": "temp_scale_0",
          "label": "Temperature Scale: 1",
          "default": "0°"
        },
        {
          "type": "text",
          "id": "temp_scale_32",
          "label": "Temperature Scale: 2",
          "default": "32°"
        },
        {
          "type": "text",
          "id": "temp_scale_50",
          "label": "Temperature Scale: 3",
          "default": "50°"
        },
        {
          "type": "text",
          "id": "temp_scale_70",
          "label": "Temperature Scale: 4",
          "default": "70°"
        },
        {
          "type": "text",
          "id": "temp_scale_85",
          "label": "Temperature Scale: 5",
          "default": "85°"
        },
        {
          "type": "text",
          "id": "temp_scale_95",
          "label": "Temperature Scale: 6",
          "default": "95°"
        }
      ]
    },
    {
      "type": "materials",
      "name": "Materials",
      "settings": [
        {
          "type": "text",
          "id": "materials_label",
          "label": "Materials Label",
          "default": "Materials"
        },
        {
          "type": "text",
          "id": "materials_value",
          "label": "Materials Value (default)",
          "default": "83% M.Poly FD, 17% Spandex"
        }
      ]
    },
    {
      "type": "care",
      "name": "Care Instructions",
      "settings": [
        {
          "type": "text",
          "id": "care_label",
          "label": "Care Label",
          "default": "Care"
        },
        {
          "type": "textarea",
          "id": "care_value",
          "label": "Care Value (default, use \\n for new lines)",
          "default": "Machine Wash Cold\\nWash with Like Colors\\nDo Not Bleach\\nLay Flat to Dry\\nDo Not Iron\\nDo Not Dry Clean"
        }
      ]
    },
    {
      "type": "additional_info",
      "name": "Additional Info",
      "settings": [
        {
          "type": "textarea",
          "id": "additional_info",
          "label": "Additional Info (HTML allowed)",
          "default": "For best outcome, wash exclusively with active apparel.<br>Garment made in China"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Tech Specs",
      "blocks": [
        {
          "type": "fit_pocketing"
        },
        {
          "type": "functionality"
        },
        {
          "type": "effort_temperature"
        },
        {
          "type": "materials"
        },
        {
          "type": "care"
        },
        {
          "type": "additional_info"
        }
      ]
    }
  ]
}
{% endschema %}
