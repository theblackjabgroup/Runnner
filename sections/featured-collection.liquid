{% if section.settings.enabled %}
  {% assign section_classes_fc = '' %}
  {% if section.settings.color_scheme %}
    {% assign section_classes_fc = section_classes_fc | append: ' color-' | append: section.settings.color_scheme %}
  {% endif %}
  <div
    class="featured-collection-page-width overflow-hidden {{section_classes_fc}}"
    role="region"
    aria-labelledby="featured-collection-heading"
    aria-describedby="featured-collection-description"
  >
    {% if section.settings.heading != blank %}
      <div
        style="font-weight: 700; color: var(--text); font-family: 'Poppins', sans-serif; font-style: var(--font-heading-style); font-size: var(--t-h-1-size); line-height: var(--t-h-1-line-height); letter-spacing: -0.05em; text-transform: uppercase;"
        class="featured-collection-main-heading mb-[-10px]{% if section.settings.enable_letter_animation %} fc-letter-animation{% endif %}"
      >
        {{ section.settings.heading }}
      </div>
    {% endif %}

    <div
      class="flex justify-between items-start w-full featured-collection-subheading"
      style="padding: var(--space-lg); color: var(--text); font-weight:var(--font-subheading-weight); font-family: var(--font-subheading-family); font-style: var(--font-subheading-style);"
    >
      <div class="flex-grow md:text-[24px] text-[16px] md:mt-[-20px]" style="line-height: 1;">
        {% if section.settings.description != blank %}
          {{ section.settings.description }}
        {% endif %}
      </div>
      <div class="flex-shrink-0 fc-shop-all-wrapper">
        {% if section.settings.show_shop_all and section.settings.main_collection %}
          {% render 'primary-button',
            button_text: section.settings.button_text,
            button_url: section.settings.main_collection.url,
            button_font_size: 'var(--t-b-1-size)',
            font_weight: 'var(--t-b-1-weight)',
            button_line_height: 'var(--t-b-1-line-height)',
            mobile_font_size: 'var(--tm-b-2-size)',
            mobile_font_weight: 'var(--t-b-2-weight)',
            mobile_line_height: 'var(--tm-b-2-line-height)'
          %}
          {% comment %}
            <a
              href="{{ section.settings.main_collection.url }}"
              class="featured-collection-custom-button"
              aria-label="{{ section.settings.button_text }} for {{ section.settings.main_collection.title }}"
            >
              <div class="featured-collection-button-text-container">
                <div class="featured-collection-button-text">
                  {{ section.settings.button_text }}
                  <span class="featured-collection-button-arrow">
                    <svg
                      width="18"
                      height="16"
                      viewBox="4.5 1.5 8.5 13"
                      fill="currentColor"
                      xmlns="http://www.w3.org/2000/svg"
                      style="width: 16px; height: 16px;"
                      class="featured-collection-arrow-svg object-contain transition-transform duration-200 ease-in-out mx-1"
                      stroke="currentColor"
                    >
                      <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                    </svg>
                  </span>
                </div>
                <div class="featured-collection-button-text-hover">
                  {{ section.settings.button_text }}
                  <span class="featured-collection-button-arrow">
                    <svg
                      width="18"
                      height="16"
                      viewBox="4.5 1.5 8.5 13"
                      fill="currentColor"
                      xmlns="http://www.w3.org/2000/svg"
                      style="width: 16px; height: 16px;"
                      class="featured-collection-arrow-svg object-contain transition-transform duration-200 ease-in-out mx-1"
                      stroke="currentColor"
                    >
                      <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                    </svg>
                  </span>
                </div>
              </div>
            </a>
          {% endcomment %}
        {% endif %}
      </div>
    </div>

    <hr class="border-(--text) my-6" aria-hidden="true">

    <div class="featured_collection_filters flex flex-col md:flex-row mt-10" style="gap:20px; margin-top:20px;">
      <nav
        class="collections-container text-[24px] w-full md:w-[400px] min-w-[350px] order-1 md:order-none md:mb-0"
        aria-label="Collection filters"
      >
        <div class="collection-filters flex flex-row md:flex-col flex-wrap" role="tablist" aria-label="Collections">
          {% for block in section.blocks %}
            {% if block.settings.collection == blank %}
              {% assign button_collection_id = 'blank-' | append: block.id %}
            {% else %}
              {% assign button_collection_id = block.settings.collection.id %}
            {% endif %}

            <button
              class="collection-btn {% if forloop.first %}active{% endif %} w-auto md:w-full h-[54px] flex items-center justify-between"
              role="tab"
              aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
              tabindex="{% if forloop.first %}0{% else %}-1{% endif %}"
              type="button"
              data-collection="{{ button_collection_id }}"
            >
              <span class="label-text">
                {{ block.settings.label }}
                {% if block.settings.collection %}
                  <!-- Desktop version with superscript -->
                  <sup class="product-count-desktop">[{{ block.settings.collection.products_count }}]</sup>
                  <!-- Mobile version with normal text -->
                  <span class="product-count-mobile"> [{{ block.settings.collection.products_count }}]</span>
                {% endif %}
              </span>
              {% comment %}
                <svg class="svg-arrow-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 37 36" width="18" height="18">
                  <path fill="currentColor" d="M26.79,9.21A35.06,35.06,0,0,0,37,16.2v3.66a35.34,35.34,0,0,0-10.21,7A12.84,12.84,0,0,0,23.21,36H17.56q0-6.22,3-10a15.4,15.4,0,0,1,8.06-5.2V20.6H0V15.43H28.63v-.3A15.16,15.16,0,0,1,20.57,10q-3-3.77-3-10h5.65a13,13,0,0,0,.87,5A12.79,12.79,0,0,0,26.79,9.21Z"/>
                </svg>
              {% endcomment %}
              {% comment %}
                <img
                  src="{{ "arrow-down.png" | asset_url }}"
                  alt="Dropdown Icon"
                  class="w-12 h-6 object-contain transition-transform duration-300 group-hover:-rotate-90 collection-arrow-img"
                  width="100%"
                  height="auto"
                  aria-hidden="true"
                >
              {% endcomment %}
              <div
                class="object-contain transition-transform duration-300 fc-arrow-img relative"
                alt="Dropdown Icon"
              >
                {% comment %}
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="featured-collection-arrow-svg object-contain transition-transform duration-300 ease-in-out group-hover:-rotate-90 mx-1"
                    fill="none"
                    style="width: 18px; height: 16px;"
                    viewBox="0 0 9 9"
                    stroke-width="1.5"
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    aria-hidden="true"
                  >
                    <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261"/>
                  </svg>
                {% endcomment %}
                {% render 'icon-playback',
                  width: 18,
                  height: 16,
                  fill: 'none',
                  viewBox: '4.5 1.5 8.5 13',
                  class: 'featured-collection-arrow-svg object-contain transition-transform duration-300 ease-in-out mx-1 featured-collection-play',
                  stroke: 'currentColor',
                  style: 'width: 18px; height: 16px;'
                %}
                {% comment %}
                  <svg
                    class="featured-collection-arrow-svg transition-transform duration-200 ease-in-out"
                    xmlns="http://www.w3.org/2000/svg"
                    width="25px"
                    height="25px"
                    stroke-width="10"
                    viewBox="0 0 20 20"
                  >
                    <g transform="rotate(270 12 12)">
                      <path fill="currentColor" d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261"></path>
                    </g>
                  </svg>
                {% endcomment %}
              </div>
            </button>
          {% endfor %}
        </div>
      </nav>

      <main class="products-container w-full md:flex-1 order-2 md:order-none">
        {% comment %} Create array of unique collection IDs to prevent duplicates {% endcomment %}
        {% assign unique_collections = '' %}
        {% assign processed_collection_ids = '' %}

        {% for block in section.blocks %}
          {% if block.settings.collection == blank %}
            {% assign collection_id = 'blank-' | append: block.id %}
          {% else %}
            {% assign collection_id = block.settings.collection.id | append: '' %}
          {% endif %}

          {% unless processed_collection_ids contains collection_id %}
            {% assign unique_collections = unique_collections | append: block.id | append: ',' %}
            {% assign processed_collection_ids = processed_collection_ids | append: collection_id | append: ',' %}
          {% endunless %}
        {% endfor %}

        {% assign unique_collections_array = unique_collections | split: ',' %}

        {% for block in section.blocks %}
          {% assign block_id_string = block.id | append: '' %}
          {% if unique_collections_array contains block_id_string %}
            {% if block.settings.collection == blank %}
              {% assign container_collection_id = 'blank-' | append: block.id %}
            {% else %}
              {% assign container_collection_id = block.settings.collection.id %}
            {% endif %}

            <div
              class="collection-products-container {% unless forloop.first %}hidden{% endunless %}"
              data-collection-id="{{ container_collection_id }}"
              role="tabpanel"
              aria-labelledby="tab-{{ container_collection_id }}"
              tabindex="0"
            >
              <div class="slider-container relative">
                <div
                  id="featured-collection-product-slider-{{ container_collection_id }}"
                  class="featured-collection-product-slider flex gap-2 md:gap-4 featured-collection-cursor-grab overflow-x-auto custom-scrollbar scroll-fade-stagger"
                  aria-label="Products in {{ block.settings.label }}"
                >
                  {% if block.settings.collection == blank or block.settings.collection.products.size == 0 %}
                    {% for i in (1..5) %}
                      <article
                        class="new-product-card flex-none scroll-fade-trigger scroll-fade-up"
                        aria-label="No products found"
                      >
                        <div
                          class="new-product-image-wrapper relative group"
                          aria-hidden="true"
                          style="width: min(441px, calc(255px + 0.1835 * (100vw - 425px))); height: min(530px, calc(306px + 0.2207 * (100vw - 425px)));"
                        >
                          <div class="new-product-images-container" style="width: 100%; height: 100%;">
                            {{ 'collection-1' | placeholder_svg_tag: 'new-product-image active placeholder-image' }}
                          </div>
                        </div>
                        <div class="featured-collection-product-details">
                          <h3
                            class="uppercase font-medium leading-tight"
                            style="color: var(--text); font-size: var(--tm-h-5-size); font-weight: var(--font-body-weight); font-family: var(--font-body-family); font-style: var(--font-body-style);"
                          >
                            No products found
                          </h3>
                          <div class="flex gap-2 items-baseline fc-price" style="margin-top: -6px;">
                            <span class="!text-[1.6rem] uppercase font-medium">â€”</span>
                          </div>
                        </div>
                      </article>
                    {% endfor %}
                  {% else %}
                    {% for product in block.settings.collection.products %}
                      {% render 'new-product-card', product: product, collection: block.settings.collection %}
                    {% endfor %}
                  {% endif %}
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </main>
    </div>
  </div>
{% endif %}

{{ 'featured-collection.css' | asset_url | stylesheet_tag }}

<style>
  .featured-collection-page-width {
    padding: {{ settings.sections_spacing }}px {{ settings.side_space}}px;
  }

  .collection-filters .collection-btn {
    border-bottom: {{ settings.buttons_border_thickness }}px solid var(--hovered_button_label);
    font-size: var(--t-h-5-size);
    line-height: var( --t-h-5-line-height)
  }

  .collection-filters .collection-btn:hover,
  .collection-filters .collection-btn.active {
    border-bottom: {{ settings.buttons_border_thickness }}px solid rgb(var(--color-background));
  }

  {% if section.settings.uppercase_text %}
    .featured-collection-main-heading {
      text-transform: uppercase !important;
    }
  {% endif %}

  .featured-collection-custom-button {
    border-radius: {{ settings.buttons_radius |  minus: 1 }}px;
    border: var(--button_label) {{ settings.buttons_border_thickness }}px solid;
  }

  .shop-all-button {
    border-radius: {{ settings.buttons_radius |  minus: 1 }}px;
  }

  @media (max-width: 768px) {
    .collection-btn {
      border-radius: {{ settings.buttons_radius |  minus: 1 }}px; !important;
    }

    .featured-collection-main-heading {
      padding-top: {{ section.settings.padding_top }}px;
    }
  }
</style>
{{ 'scroll-animations.css' | asset_url | stylesheet_tag }}
<script src="{{ 'scroll-animations.js' | asset_url }}" defer></script>
<script src="{{ 'featured-collection.js' | asset_url }}" defer></script>
<script src="{{ 'new-product-card.js' | asset_url }}" defer></script>

{% comment %} Horizontal scrollbar styling and functionality {% endcomment %}
{% render 'horizontal-scrollbar' %}

{% schema %}
{
  "name": "Featured Collection",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "checkbox",
      "id": "enabled",
      "label": "Enable section",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Collections"
    },
    {
      "type": "checkbox",
      "id": "enable_letter_animation",
      "label": "Enable letter-by-letter animation for heading",
      "default": false,
      "info": "If enabled, the heading will animate letter by letter when it comes into view."
    },
    {
      "type": "text",
      "id": "description",
      "label": "Description",
      "default": "<p>Browse our featured products</p>"
    },
    {
      "type": "checkbox",
      "id": "show_shop_all",
      "label": "Show 'Shop All' button",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "uppercase_text",
      "label": "Make heading uppercase",
      "default": false,
      "info": "If enabled, heading will be displayed in uppercase."
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "SHOP ALL",
      "info": "Text for the 'Shop All' button"
    },
    {
      "type": "collection",
      "id": "main_collection",
      "label": "Main collection for 'Shop All'",
      "info": "Collection to link when 'Shop All' is clicked"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top Padding",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 15
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "limit": 10,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Collection Name",
          "default": "Collection"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection",
          "info": "Select a collection to display"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Collection",
      "blocks": [
        {
          "type": "collection"
        },
        {
          "type": "collection"
        },
        {
          "type": "collection"
        }
      ]
    }
  ]
}
{% endschema %}
