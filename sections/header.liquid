<header
  class="header-main will-change-transform p-2 lg:px-3 bg-[var(--header_background)] transform-gpu {% unless section.settings.enable_sticky %}sticky-disabled{% endunless %}"
  data-header-sticky
  style="z-index: 999; "
>
  <div class="relative w-full flex items-center justify-between ">
    <!-- Left: Logo -->
    <div class="flex items-center justify-center mx-4  ">
      <a href="/">
        {% if section.settings.logo != blank %}
          <img
            src="{{ section.settings.logo | image_url }}"
            width="auto"
            height="auto"
            alt="Logo"
            class=" !max-w-full !max-h-16  mx-auto"
          >
        {% else %}
          <span
            class="block font-semibold text-center pl-2 pr-24 "
            style="font-size: 44px; line-height: 1; color: var(--header_text);"
          >
            {{- shop.name -}}
          </span>
        {% endif %}
      </a>
    </div>
    <!-- Right: Menu & Actions -->
    <div class=" flex flex-wrap items-center justify-end w-full tracking-tight">
      <!-- Desktop Menu -->
      <nav
        class="relative flex justify-end lg:justify-between items-center w-full text-[var(--header_text)]"
      >
        <!-- Left: Menu Items -->
        <div class="menu-items hidden lg:!flex  flex-wrap w-2/3 ">
          <ul class="flex-1 flex flex-wrap space-x-1">
            {%- for link in section.settings.menu.links -%}
              <li class="group dropdown-group flex items-center justify-center mr-2">
                {% if link.links.size > 0 %}
                  <a
                    href="{{ link.url }}"
                    class="cursor-pointer text-[16px] flex items-center group"
                    aria-expanded="false"
                    aria-controls="mega-menu-{{ forloop.index }}"
                    aria-haspopup="true"
                  >
                    {{ link.title }}
                    {% if section.settings.dropdown_icon != blank %}
                      <img
                        src="{{ section.settings.dropdown_icon | image_url }}"
                        alt="Dropdown Icon"
                        class="w-12 h-6 object-contain transition-transform duration-300 group-hover:-rotate-90"
                        width="100%"
                        height="auto"
                        aria-hidden="true"
                      >
                    {% else %}
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="w-5 h-5 object-contain transition-transform duration-300 group-hover:-rotate-90 mx-1"
                        fill="none"
                        viewBox="0 0 9 9"
                        stroke-width="1.5"
                        stroke="currentColor"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        aria-hidden="true"
                      >
                        <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261"/>
                      </svg>
                    {% endif %}
                  </a>

                  <!-- sub-menu dropdown -->
                  <div
                    id="mega-menu-{{ forloop.index }}"
                    role="region"
                    aria-label="{{ link.title }} submenu"
                    class="
                      fixed left-0 right-0 w-full
                      opacity-0 pointer-events-none
                    "
                    style="
                      background: var(--header_background);
                      top: 80%;
                      will-change: transform, opacity;
                      transform: translateY(-300px);
                      transition-property: opacity, transform;
                      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                      transition-duration: 800ms;
                      z-index: -1;
                    "
                  >
                    <div class="mx-auto p-2  flex">
                      <ul class="flex justify-start gap-8 m-2 w-1/2">
                        {% for childlink in link.links %}
                          <li class="min-w-[100px] relative">
                            <a
                              href="{{ childlink.url }}"
                              class="block text-gray-500 hover:text-[var(--hover)] font-medium text-[14px] mb-4"
                            >
                              {{ childlink.title }}
                            </a>
                            {% if childlink.links.size > 0 %}
                              <ul class=" space-y-0">
                                {% for grandchildlink in childlink.links %}
                                  <li>
                                    <a
                                      href="{{ grandchildlink.url }}"
                                      class="block text-[16px] hover:text-[var(--hover)] font-normal text-[var(--header_text)]"
                                    >
                                      {{ grandchildlink.title }}
                                    </a>
                                  </li>
                                {% endfor %}
                              </ul>
                            {% endif %}

                            <a href="#" class="underline-link"> SHOP ALL {{ childlink.title }} </a>
                          </li>
                        {% endfor %}
                      </ul>
                      <!-- Mega Menu Images -->
                      <div class="mega-menu-img flex items-center justify-end w-1/2 gap-8 px-4">
                        {% for block in section.blocks %}
                          {% if block.type == 'mega_menu_images' and block.settings.menu_item_name == link.title %}
                            <!-- First Image -->
                            {% if block.settings.image_1 != blank %}
                              <div class="group/card w-[300px] cursor-pointer">
                                <a href="{{ block.settings.button_link_1 }}">
                                  <div class="relative block overflow-hidden">
                                    <div class="aspect-[4/3] overflow-hidden bg-gray-100">
                                      <img
                                        src="{{ block.settings.image_1 | image_url }}"
                                        alt="Shop now image 1"
                                        class="w-full h-full object-cover group-hover/card:scale-110 transition-transform duration-700"
                                        loading="lazy"
                                        width="100%"
                                        height="auto"
                                      >
                                      <div
                                        class="absolute inset-0 bg-black/60 flex items-center justify-center translate-y-full group-hover/card:translate-y-0 transition-transform duration-300"
                                      >
                                        <span class="text-white text-2xl font-bold tracking-tight">SHOP NOW</span>
                                      </div>
                                    </div>
                                  </div>
                                </a>
                                {% if block.settings.button_text_1 != blank %}
                                  <a
                                    href="{{ block.settings.button_link_1 }}"
                                    class="block transition-all duration-300 ease-out"
                                    style="transition-delay: 0ms"
                                  >
                                    <div class="mt-4 flex items-center justify-between group-hover/card:hover:text-[var(--hover)] group-hover/card:font-bold">
                                      <p class="text-2xl font-medium uppercase">{{ block.settings.button_text_1 }}</p>
                                      <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                                      </svg>
                                    </div>
                                  </a>
                                {% endif %}
                              </div>
                            {% endif %}

                            <!-- Second Image -->
                            {% if block.settings.image_2 != blank %}
                              <div class="group/card w-[300px] cursor-pointer">
                                <a href="{{ block.settings.button_link_2 }}">
                                  <div class="relative block overflow-hidden">
                                    <div class="aspect-[4/3] overflow-hidden bg-gray-100">
                                      <img
                                        src="{{ block.settings.image_2 | image_url }}"
                                        alt="Shop now image 2"
                                        class="w-full h-full object-cover group-hover/card:scale-110 transition-transform duration-700"
                                        loading="lazy"
                                        width="100%"
                                        height="auto"
                                      >
                                      <div
                                        class="absolute inset-0 bg-black/60 flex items-center justify-center translate-y-full group-hover/card:translate-y-0 transition-transform duration-300"
                                      >
                                        <span class="text-white text-2xl font-bold tracking-tight">SHOP NOW</span>
                                      </div>
                                    </div>
                                  </div>
                                </a>
                                {% if block.settings.button_text_2 != blank %}
                                  <a
                                    href="{{ block.settings.button_link_2 }}"
                                    class="block group-hover/card:hover:text-[var(--hover)] group-hover/card:font-bold group-hover/card:translate-1 transition-all duration-300"
                                  >
                                    <div class="mt-4 flex items-center justify-between">
                                      <p class="text-2xl font-medium uppercase">{{ block.settings.button_text_2 }}</p>
                                      <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                                      </svg>
                                    </div>
                                  </a>
                                {% endif %}
                              </div>
                            {% endif %}
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>

                    <div class="horizontal-text-container">
                      <div class="horizontal-text">
                        {{ section.settings.scrolling_text }}
                      </div>
                      <div class="horizontal-text">
                        {{ section.settings.scrolling_text }}
                      </div>
                      <div class="horizontal-text">
                        {{ section.settings.scrolling_text }}
                      </div>
                      <div class="horizontal-text">
                        {{ section.settings.scrolling_text }}
                      </div>
                    </div>
                  </div>
                {% else %}
                  <a href="{{ link.url }}" class="py-2 px-2 block">
                    {{ link.title }}
                  </a>
                {% endif %}
              </li>
            {%- endfor -%}
          </ul>
        </div>

        <!-- Right: Actions -->
        <div class="flex lg:!w-1/3 gap-2 items-center justify-end ">
          <!-- Top Row: Action Utilities -->

          <!-- Search -->
          <div class="relative ">
            <button
              id="search-toggle"
              class="flex items-center justify-center text-[var(--header_text)] hover:text-[var(--hover)]"
              aria-label="Toggle search"
              aria-expanded="false"
            >
              <svg
                class="w-8 h-8"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                stroke-width="3"
                style="transition: transform 0.2s ease;"
                onmouseover="this.style.transform='scale(1.25)'"
                onmouseout="this.style.transform='none'"
                style="color: var(--header_text);"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
              </svg>
            </button>

            <!-- Search Container -->
            <div
              id="search-container"
              class="fixed left-0 right-0 z-[1000] hidden opacity-0  shadow-lg py-8"
              style="background: var(--header_background); top: var(--header-height);"
              aria-hidden="true"
            >
              <div class="searchbox-container mx-auto w-full px-4 py-4">
                <form
                  action="/search"
                  method="get"
                  class="flex items-center gap-4 w-full mx-2 "
                  role="search"
                >
                  <div class="relative flex-1">
                    <input
                      type="search"
                      name="q"
                      placeholder="Search"
                      class="w-full px-2 py-3 text-2xl lg:text-4xl focus:outline-none bg-transparent placeholder-black"
                    >
                  </div>
                  <button
                    type="submit"
                    class="text-white bg-black text-2xl lg:text-4xl px-2 py-1 hover:text-black hover:bg-white hover:border-1 rounded-md transition-colors duration-200"
                  >
                    SEARCH
                  </button>
                  <button
                    id="close-search"
                    class=" hover:text-gray-700 transition-colors duration-200"
                    style="color: var(--header_text);"
                    aria-label="Close search"
                  >
                    <svg class="size-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </form>

                <div
                  class="
                    block
                    search-bottom-bar
                    w-full h-[2px]
                    mx-1
                  "
                  style="background: var(--header_text); "
                >
                  &nbsp
                </div>

                <!-- Quick Links -->
                <div class=" flex flex-col lg:flex-row items-center mt-8  mx-auto">
                  <span
                    class="inline-block lg:!block text-2xl lg:text-4xl uppercase m-4"
                    style="color:var(--header_text);"
                    >Top Searches</span
                  >
                  <div class="flex flex-wrap gap-4">
                    <a
                      href="/search?q=new"
                      class="px-1 bg-gray-400 hover:bg-gray-200 transition-colors duration-200 rounded-md text-xl lg:text-3xl font-medium"
                      >New Arrivals</a
                    >
                    <a
                      href="/search?q=sale"
                      class="px-1 bg-gray-400 hover:bg-gray-200 transition-colors duration-200 rounded-md text-xl lg:text-3xl font-medium"
                      >Sale</a
                    >
                    <a
                      href="/search?q=bestsellers"
                      class="px-1 bg-gray-400 hover:bg-gray-200 transition-colors duration-200 rounded-md text-xl lg:text-3xl font-medium"
                      >Bestsellers</a
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- Search Overlay -->
            <div
              id="search-overlay"
              class="fixed left-0 right-0 w-full z-[990] bg-black opacity-0 pointer-events-none"
              style="height: 100vh; transition: opacity 0.2s ease-in-out; top: 100%"
            >
              &nbsp;
            </div>
          </div>

          <!-- Country Selector -->

          <div class="group relative hidden lg:!inline-block " style="background: var(--header_background);">
            <!-- Trigger: Current country -->
            <div class="inline-flex items-center cursor-pointer gap-0.5 ">
              {% assign current_country = localization.country %}
              <span>
                {{ current_country.name }}
              </span>

              {% if section.settings.dropdown_icon != blank %}
                <img
                  src="{{ section.settings.dropdown_icon | image_url }}"
                  alt="Dropdown Icon"
                  class="w-12 h-6 object-contain transition-transform duration-300 group-hover:-rotate-90"
                  width="100%"
                  height="auto"
                  aria-hidden="true"
                >
              {% else %}
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-5 h-5 object-contain transition-transform duration-300 group-hover:-rotate-90 mx-1"
                  fill="none"
                  viewBox="0 0 9 9"
                  stroke-width="1.5"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  style="color: var(--header_text);"
                  aria-hidden="true"
                  style="color: var(--header_text);"
                >
                  <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261"/>
                </svg>
              {% endif %}
            </div>

            <!-- Dropdown -->
            <div
              class="absolute w-100 bg-[var(--header_background)] border border-gray-200 rounded-md shadow-lg opacity-0 group-hover:opacity-100 invisible group-hover:visible transition-all duration-300"
              style="background: var(--header_background); top: 110%; right: -100%;"
            >
              <ul class=" overflow-y-auto divide-y divide-gray-100" style="max-height: 500px; max-width: 400px;">
                {% assign current_country = localization.country %}
                {% for country in localization.available_countries %}
                  <li>
                    <a
                      href="{{ country.url }}"
                      class="w-full flex items-center justify-between px-4 py-2 text-3xl hover:bg-gray-300"
                      style="color: var(--header_text);"
                    >
                      <span class="mx-2">{{ country.name }}</span>
                      <span class=" font-medium">
                        {{ country.currency.iso_code }}
                        {{ country.currency.symbol }}
                      </span>
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </div>
          </div>

          <!-- Login -->
          <a
            href="/account/login"
            class="hidden lg:!inline-flex items-center gap-2 rounded-xl px-2  text-[16px] text-[var(--header_text)] hover:text-gray-700 "
            aria-label="Login"
          >
            LOGIN
          </a>

          <!-- Cart -->
          <a
            href="{{ routes.cart_url }}"
            class="  focus-inset !flex items-center justify-center "
            id="cart-icon-bubble"
            aria-label="Cart"
          >
            <span class="flex text-[var(--header_text)] text-[16px] hover:text-gray-700">CART</span>
            <span
              class="m-2 p-1 bg-transparent text-[var(--header_text)] text-md w-7 h-6 flex items-center justify-center ring-1 rounded-full"
              aria-label="{{ cart.item_count }} items in cart"
            >
              {{ cart.item_count }}
            </span>
          </a>

          <!-- Hamburger -->
          <button
            id="hamburger-menu"
            class="lg:hidden text-[var(--header_text)] hover:text-gray-700"
            style="color: var(--header_text);"
            aria-label="Menu"
            aria-expanded="false"
            aria-controls="mobile-menu"
          >
            <svg class="size-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
            </svg>
          </button>
        </div>
      </nav>
      <div
        class="hidden lg:!block bottom-bar bg-transparent w-full relative overflow-visible"
      >
        <span
          id="bottom-bar-indicator"
          class=" absolute bottom-0 left-0 transition-all duration-300 ease-out"
          style="width: 0; height: 1px; background: var(--header_text);"
        ></span>
      </div>
    </div>
  </div>
  <div
    class="
          mobile-bottom-bar
      lg:hidden
      w-full bg-black
    "
    style="height: 1px;"
  >
    &nbsp
  </div>
</header>

<!-- Sub Menu Overlay -->
<div
  id="mega-menu-overlay"
  class="fixed top-1/5 w-full z-[999] bg-black opacity-0 pointer-events-none"
  style="height: 100vh; transition: opacity 0.2s ease-in-out;"
>
  &nbsp;
</div>

<!-- Mobile Menu Overlay -->
<div
  id="menu-overlay"
  class="fixed inset-0 bg-black opacity-0 pointer-events-none transition-opacity duration-300"
  style="z-index: 999; "
>
  &nbsp;
</div>

<!-- Mobile Menu -->
<div
  id="mobile-menu"
  class="hidden lg:hidden w-[90vw] h-[100vh] fixed top-0 right-0  bg-[var(--header_background)] flex"
  style="transform: translateX(100%); transition: transform 0.3s ease-in-out; background: var(--header_background); z-index: 1000"
>
  <!-- Vertical Scrolling Text -->
  <div
    class="h-[100vh] flex items-center justify-center overflow-hidden relative "
    style="border-right: 1px solid var(--header_text); border-left: 1px solid var(--header_text);"
  >
    <div class="h-vertical-text-container">
      <div class="h-vertical-text text-[var(--header_text)] ">
        {{ section.settings.scrolling_text }}
      </div>
      <div class="h-vertical-text text-[var(--header_text)] ">
        {{ section.settings.scrolling_text }}
      </div>
      <div class="h-vertical-text text-[var(--header_text)] ">
        {{ section.settings.scrolling_text }}
      </div>
      <div class="h-vertical-text text-[var(--header_text)] ">
        {{ section.settings.scrolling_text }}
      </div>
    </div>
  </div>

  <div class="  flex flex-1 flex-col justify-between overflow-y-auto" style="padding-left: 10px; padding-right: 12px;">
    <nav
      class="flex flex-col space-y-4 pt-10 w-full justify-between"
      style="padding-top: 22px;"
    >
      <div class="upper-section">
        <div class="flex items-center justify-end">
          <button
            type="button"
            class="text-[14px] pb-2 leading-none tracking-tight uppercase"
            style="color: var(--header_text)"
            aria-label="Close Menu"
          >
            Close
          </button>
        </div>
        {% if section.settings.menu.links != blank %}
          {% for link in section.settings.menu.links %}
            <div class="mobile-menu-item">
              <div class="horizontal-line w-full h-0.5 my-2" style="background: var(--header_text)">&nbsp;</div>
              <div class="!flex items-center justify-between">
                <a href="{{ link.url }}" class="block text-[24px] text-[var(--header_text)] font-medium py-2">
                  {{ link.title }}
                </a>
                {% if link.links.size > 0 %}
                  <button
                    type="button"
                    class="toggle-submenu focus:outline-none flex-1 flex justify-end mr-2"
                    aria-expanded="false"
                    aria-controls="mobile-submenu-{{ forloop.index }}"
                    aria-label="Toggle {{ link.title }} submenu"
                  >
                    {% if section.settings.dropdown_icon != blank %}
                      <img
                        src="{{ section.settings.dropdown_icon | image_url }}"
                        alt="Dropdown Icon"
                        width="100%"
                        height="auto"
                        class="w-8 h-8 object-contain transition-transform duration-300"
                        aria-hidden="true"
                      >
                    {% else %}
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="w-5 h-5 object-contain transition-transform duration-300 group-hover:-rotate-90 mx-1"
                        style="color: var(--header_text);"
                        fill="none"
                        viewBox="0 0 9 9"
                        stroke-width="1.5"
                        stroke="currentColor"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        aria-hidden="true"
                      >
                        <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261"/>
                      </svg>
                    {% endif %}
                  </button>
                {% endif %}
              </div>
              {% if link.links.size > 0 %}
                <div
                  id="mobile-submenu-{{ forloop.index }}"
                  role="region"
                  aria-label="{{ link.title }} submenu"
                  class="ml-1 hidden space-y-2 submenu max-h-[0] overflow-y-auto overscroll-contain styled-scrollbar transition-all duration-300"
                >
                  <div class="pr-4">
                    {% for childlink in link.links %}
                      <a
                        href="{{ childlink.url }}"
                        class="block text-[12px] text-gray-700 mt-5 mb-2 tracking-tight"
                      >
                        {{ childlink.title }}
                      </a>
                      {% if childlink.links.size > 0 %}
                        <ul class="space-y-0">
                          {% for grandchildlink in childlink.links %}
                            <li>
                              <a
                                href="{{ grandchildlink.url }}"
                                class="block text-[12px] text-[var(--header_text)] tracking-tight"
                              >
                                {{ grandchildlink.title }}
                              </a>
                            </li>
                          {% endfor %}
                          <a
                            href="{{childlink.url}}"
                            class="text-[12px] text-gray-500 underline tracking-tight  leading-none "
                          >
                            SHOP ALL {{ childlink.title -}}
                          </a>
                        </ul>
                      {% endif %}
                    {% endfor %}

                    <!-- Mobile Mega Menu Images -->
                    {% for block in section.blocks %}
                      {% if block.type == 'mega_menu_images' and block.settings.menu_item_name == link.title %}
                        <div class="flex flex-col gap-4 mt-4">
                          {% if block.settings.image_1 != blank %}
                            <div class="flex flex-col">
                              <a href="{{ block.settings.button_link_1 }}">
                                <div class="relative block overflow-hidden">
                                  <img
                                    src="{{ block.settings.image_1 | image_url }}"
                                    alt="Shop now image 1"
                                    class="w-full h-full object-cover"
                                    loading="lazy"
                                    width="100%"
                                    height="auto"
                                  >
                                </div>
                              </a>
                              <a
                                href="{{ block.settings.button_link_1 }}"
                                class="block mt-4 transition-all duration-300"
                              >
                                <div class="flex items-center justify-between">
                                  <p class="text-[12px] uppercase font-medium">{{ block.settings.button_text_1 }}</p>
                                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                                  </svg>
                                </div>
                              </a>
                            </div>
                          {% endif %}

                          {% if block.settings.image_2 != blank %}
                            <div class="group/card cursor-pointer mt-4">
                              <a href="{{ block.settings.button_link_2 }}">
                                <div class="relative block overflow-hidden">
                                  <div class="aspect-[4/3] overflow-hidden bg-gray-100">
                                    <img
                                      src="{{ block.settings.image_2 | image_url }}"
                                      alt="Shop now image 2"
                                      class="w-full h-full object-cover group-hover/card:scale-110 transition-transform duration-700"
                                      loading="lazy"
                                      width="100%"
                                      height="auto"
                                    >
                                    <div class="absolute inset-0 bg-black/60 flex items-center justify-center translate-y-full group-hover/card:translate-y-0 transition-transform duration-300">
                                      <span class="text-white text-xl font-bold tracking-tight">SHOP NOW</span>
                                    </div>
                                  </div>
                                </div>
                              </a>
                              <a
                                href="{{ block.settings.button_link_2 }}"
                                class="block mt-4 transition-all duration-300"
                              >
                                <div class="flex items-center justify-between group-hover/card:text-pink-500 group-hover/card:font-bold">
                                  <p class="text-lg font-medium">{{ block.settings.button_text_2 }}</p>
                                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                                  </svg>
                                </div>
                              </a>
                            </div>
                          {% endif %}
                        </div>
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
            </div>
          {% endfor %}
        {% endif %}
      </div>
      <div class="horizontal-line w-full h-0.5  my-2 -mt-1" style="background: var(--header_text)">&nbsp;</div>
    </nav>

    <div class="flex flex-col w-full">
      <div class="flex flex-col gap-1 mb-4 font-semibold ">
        <div class="country-selector relative inline-block">
          <!-- Trigger: Current country -->
          <button
            type="button"
            class="country-selector-button inline-flex items-center cursor-pointer px-1 gap-2 hover:bg-gray-100"
            aria-expanded="false"
          >
            {% assign current_country = localization.country %}
            <span class="" style="color: var(--header_text);">
              {{ current_country.name }}
            </span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 object-contain transition-transform duration-300 group-hover:-rotate-90 mx-1"
              style="color: var(--header_text);"
              fill="none"
              viewBox="0 0 9 9"
              stroke-width="1.5"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
            >
              <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261"/>
            </svg>
          </button>

          <!-- Dropdown -->
          <div
            class="country-selector-dropdown absolute bottom-16 w-100 bg-[var(--header_background)] border border-gray-200 rounded-md shadow-lg opacity-0 invisible transition-all duration-300 z-[9999]"
            style="background: var(--header_background); "
          >
            <ul class="max-h-100 overflow-y-auto divide-y divide-gray-100 text-xl">
              {% for country in localization.available_countries %}
                <li>
                  <a
                    href="{{ country.url }}"
                    class="w-full flex items-center justify-between px-4 py-2 text-2xl  hover:bg-gray-100"
                    style="color: var(--header_text);"
                  >
                    <span class="mx-2">{{ country.name }}</span>
                    <span class=" font-medium">
                      {{ country.currency.iso_code }}
                      {{ country.currency.symbol }}
                    </span>
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>

        <a
          href="/account/login"
          class="inline-flex items-center rounded-xl px-2 "
          style="width: min-content;  background: var(--header_text); color: var(--header_background);"
          aria-label="Login"
        >
          LOGIN
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-5 h-5 object-contain transition-transform duration-300 mx-1"
            fill="none"
            viewBox="0 0 9 9"
            stroke-width="1.5"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261"/>
          </svg>
        </a>
      </div>
      <div class="horizontal-line w-full h-0.5" style="background: var(--header_text)">&nbsp;</div>
      <div id="social-link-container" class="flex flex-wrap items-center justify-between gap-4 m-4">
        {% if settings.social_facebook_link != blank %}
          <a href="{{ settings.social_facebook_link }}" aria-label="Facebook" target="_blank" rel="noopener">
            {{
              'icon-facebook.svg'
              | inline_asset_content
              | replace: '<svg', '<svg role="img" aria-hidden="true" style="height: 30px; fill: '
              | append: settings.social_icon_color
              | remove: '_'
            }}
          </a>
        {% endif %}

        {% if settings.social_instagram_link != blank %}
          <a href="{{ settings.social_instagram_link }}" aria-label="Instagram" target="_blank" rel="noopener">
            {{
              'icon-instagram.svg'
              | inline_asset_content
              | replace: '<svg', '<svg role="img" aria-hidden="true" style="height: 30px; fill: '
              | append: settings.social_icon_color
              | remove: '_'
            }}
          </a>
        {% endif %}

        {% if settings.social_youtube_link != blank %}
          <a href="{{ settings.social_youtube_link }}" aria-label="YouTube" target="_blank" rel="noopener">
            {{
              'icon-youtube.svg'
              | inline_asset_content
              | replace: '<svg', '<svg role="img" aria-hidden="true" style="height: 25px; fill: '
              | append: settings.social_icon_color
              | remove: '_'
            }}
          </a>
        {% endif %}
        {% if settings.social_twitter_link != blank %}
          <a href="{{ settings.social_twitter_link }}" aria-label="Twitter" target="_blank" rel="noopener">
            {{
              'icon-twitter.svg'
              | inline_asset_content
              | replace: '<svg', '<svg role="img" aria-hidden="true" style="height: 25px; fill: '
              | append: settings.social_icon_color
              | remove: "'"
            }}
          </a>
        {% endif %}
        {% if settings.social_snapchat_link != blank %}
          <a href="{{ settings.social_snapchat_link }}" aria-label="Snapchat" target="_blank" rel="noopener">
            {{
              'icon-snapchat.svg'
              | inline_asset_content
              | replace: '<svg', '<svg role="img" aria-hidden="true" style="height: 25px; fill: '
              | append: settings.social_icon_color
              | remove: "'"
            }}
          </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="header-offset" data-header-offset></div>

<style>
  {% comment %} test {% endcomment %}

  .underline-link {
    position: relative;
    display: inline-block;
    color: gray;
    margin-top: 0.5rem;
    transition: color 0.3s ease;
  }

  .underline-link::before {
    content: '';
    position: absolute;
    bottom: 4px;
    left: 0;
    width: 100%;
    height: 1px;
    background-color: gray;
    transform: scaleX(1);
    transform-origin: left;
    transition: transform 0.5s ease;
  }

  .underline-link:hover {
    color: var(--hover);
  }

  .underline-link:hover::before {
    transform: scaleX(0);
    transform-origin: right;
  }

    {% comment %} test end {% endcomment %}
    .header-main {
      position: relative;
      width: 100%;
      transform: translateY(-100%);
      animation: slideDown 0.5s ease forwards;
      background: var(--header_background);
    }

    @keyframes slideDown {
      from {
        transform: translateY(-100%);
      }
      to {
        transform: translateY(0);
      }
    }

    .header-main.is-sticky {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      transform: translateY(0);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .header-main.is-sticky.is-hidden {
      transform: translateY(-100%);
    }

    .header-offset {
      height: 0;
      transition: height 0.3s ease;
    }

    .header-offset.is-active {
      height: var(--header-height, 0px);
    }

    .sticky-disabled {
      position: relative !important;
      transform: none !important;
    }

    .sticky-disabled + .header-offset {
      display: none !important;
    }

    /* Mobile submenu scrollbar styling */
    .submenu.styled-scrollbar {
      scrollbar-width: thin;
      scrollbar-color: rgba(0, 0, 0, 0.3) transparent;
    }

    .submenu.styled-scrollbar::-webkit-scrollbar {
      width: 4px;
    }

    .submenu.styled-scrollbar::-webkit-scrollbar-track {
      background: transparent;
    }

    .submenu.styled-scrollbar::-webkit-scrollbar-thumb {
      background-color: rgba(0, 0, 0, 0.3);
      border-radius: 20px;
    }

    /* Mobile submenu animations */
    .submenu {
      transition: all 400ms cubic-bezier(0.4, 0, 0.2, 1);
      will-change: opacity, height;
      height: auto;
      max-height: 0;
    }

    .submenu.show {
      opacity: 1;
      max-height: 30vh;
    }

    .submenu:not(.show) {
      opacity: 0;
      max-height: 0;
    }

    .submenu.hidden {
      display: none;
    }

    .submenu:not(.hidden) {
      display: block;
    }

    /* Add overlay transition */
    #menu-overlay {
      transition: opacity 0.3s ease;
      will-change: opacity;
    }

    /* Mobile menu transitions */
    #mobile-menu {
      will-change: transform;
      backface-visibility: hidden;
    }

    #mobile-menu.active {
      transform: translateX(0) !important;
    }

    .h-vertical-text-container {
      width: 26px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .h-vertical-text {
      writing-mode: vertical-rl;
      text-orientation: mixed;
      transform: rotate(180deg);
      animation: scrollText 50s linear infinite;
      font-size: 16px;
      white-space: nowrap;
      padding: 0;
    }

    .vertical-text:nth-child(n) {
      animation: scrollText2 50s linear infinite;
    }

    @keyframes scrollText {
      0% {
        transform: translateY(0) rotate(180deg);
      }
      100% {
        transform: translateY(-100%) rotate(180deg);
      }
    }

    @keyframes scrollText2 {
      0% {
        transform: translateY(100%) rotate(180deg);
      }
      100% {
        transform: translateY(0) rotate(180deg);
      }
    }

    .horizontal-text-container {
      position: fixed;
      top: 100%;
      left: 0;
      width: 100%;
      height: 33px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      border-top: 1px solid var(--header_text);
      border-bottom: 1px solid var(--header_text);
      background: var(--header_background);
      z-index: 999;
    }

    .horizontal-text {
      white-space: nowrap;
      font-size: 24px;
      display: inline-block;
      animation: scrollRight 80s linear infinite;
      height: 100%;
      line-height: 32px;
      font-weight: 500;
    }

    .horizontal-text:nth-child(n) {
      animation: scrollRight2 80s linear infinite;
    }

    @keyframes scrollRight {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(100%);
      }
    }

    @keyframes scrollRight2 {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(100%);
      }
    }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const hamburgerMenu = document.getElementById('hamburger-menu');
    const mobileMenu = document.getElementById('mobile-menu');
    const closeButton = mobileMenu ? mobileMenu.querySelector('button[aria-label="Close Menu"]') : null;
    const overlay = document.getElementById('menu-overlay');

    function toggleMobileMenu() {
      if (!mobileMenu || !overlay) return;

      const isOpening = mobileMenu.classList.contains('hidden');

      if (isOpening) {
        mobileMenu.classList.remove('hidden');
        document.body.classList.add('overflow-hidden');

        // Trigger layout recalc before animations
        mobileMenu.offsetHeight;

        requestAnimationFrame(() => {
          overlay.classList.remove('pointer-events-none');
          overlay.style.opacity = '0.5';
          mobileMenu.classList.add('active');
        });
      } else {
        overlay.classList.add('pointer-events-none');
        overlay.style.opacity = '0';
        mobileMenu.classList.remove('active');

        mobileMenu.addEventListener(
          'transitionend',
          () => {
            if (!mobileMenu.classList.contains('active')) {
              mobileMenu.classList.add('hidden');
              document.body.classList.remove('overflow-hidden');
            }
          },
          { once: true }
        );
      }
    }

    if (hamburgerMenu) {
      hamburgerMenu.addEventListener('click', toggleMobileMenu);
    }

    if (closeButton) {
      closeButton.addEventListener('click', toggleMobileMenu);
    }

    if (overlay) {
      overlay.addEventListener('click', toggleMobileMenu);
    }

    // Submenu Toggle for Mobile
    const submenuToggles = mobileMenu.querySelectorAll('.toggle-submenu');
    let activeSubmenu = null;
    let isAnimating = false;

    const closeSubmenu = (submenu, icon) => {
      return new Promise((resolve) => {
        submenu.classList.remove('show');
        icon.style.transform = 'rotate(0)';

        const handleTransitionEnd = () => {
          submenu.classList.add('hidden');
          submenu.removeEventListener('transitionend', handleTransitionEnd);
          resolve();
        };

        submenu.addEventListener('transitionend', handleTransitionEnd);
      });
    };

    const openSubmenu = (submenu, icon) => {
      return new Promise((resolve) => {
        submenu.classList.remove('hidden');
        submenu.offsetHeight;

        requestAnimationFrame(() => {
          submenu.classList.add('show');
          icon.style.transform = 'rotate(-90deg)';

          submenu.addEventListener(
            'transitionend',
            () => {
              resolve();
            },
            { once: true }
          );
        });
      });
    };

    submenuToggles.forEach((toggle) => {
      toggle.addEventListener('click', async function () {
        if (isAnimating) return;
        isAnimating = true;

        const submenu = this.closest('.mobile-menu-item').querySelector('.submenu');
        const icon = this.querySelector('img, svg');

        try {
          if (activeSubmenu === submenu) {
            await closeSubmenu(submenu, icon);
            activeSubmenu = null;
          } else {
            const closePromise = activeSubmenu
              ? closeSubmenu(
                  activeSubmenu,
                  activeSubmenu.closest('.mobile-menu-item').querySelector('.toggle-submenu img, .toggle-submenu svg')
                )
              : Promise.resolve();

            await closePromise;
            await openSubmenu(submenu, icon);
            activeSubmenu = submenu;
          }
        } finally {
          isAnimating = false;
        }
      });
    });

    // Sticky Header
    const header = document.querySelector('[data-header-sticky]');
    const headerOffset = document.querySelector('[data-header-offset]');

    if (!header || !headerOffset || header.classList.contains('sticky-disabled')) return;

    let lastScroll = 0;
    let initialHeaderTop = header.offsetTop;
    let isFixed = false;
    let stickyEnabled = !header.classList.contains('sticky-disabled');

    const setHeaderHeight = () => {
      const height = header.offsetHeight;
      document.documentElement.style.setProperty('--header-height', `${height}px`);
      initialHeaderTop = header.offsetTop;
    };

    const handleScroll = () => {
      if (!stickyEnabled) return;

      const currentScroll = window.pageYOffset;

      if (currentScroll <= initialHeaderTop) {
        header.classList.remove('is-sticky', 'is-hidden');
        headerOffset.classList.remove('is-active');
        isFixed = false;
        return;
      }

      if (!isFixed && currentScroll > initialHeaderTop) {
        header.classList.add('is-sticky');
        headerOffset.classList.add('is-active');
        isFixed = true;
      }

      // if (isFixed) {
      //   if (currentScroll > lastScroll + 10) {
      //     header.classList.add('is-hidden');
      //   } else if (currentScroll < lastScroll - 10) {
      //     header.classList.remove('is-hidden');
      //   }
      // }

      lastScroll = currentScroll;
    };

    setHeaderHeight();
    window.addEventListener('resize', setHeaderHeight, { passive: true });
    window.addEventListener('scroll', () => requestAnimationFrame(handleScroll), { passive: true });

    // Country Selector for Mobile
    const countrySelector = document.querySelector('.country-selector');
    const countrySelectorBtn = document.querySelector('.country-selector-button');
    const countrySelectorDropdown = document.querySelector('.country-selector-dropdown');

    if (countrySelector && countrySelectorBtn && countrySelectorDropdown) {
      countrySelectorBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const isExpanded = countrySelectorBtn.getAttribute('aria-expanded') === 'true';

        countrySelectorBtn.setAttribute('aria-expanded', !isExpanded);
        const icon = countrySelectorBtn.querySelector('img, svg');
        if (icon) {
          icon.style.transform = isExpanded ? 'rotate(0)' : 'rotate(-90deg)';
        }
        countrySelectorDropdown.classList.toggle('opacity-0');
        countrySelectorDropdown.classList.toggle('invisible');
      });

      document.addEventListener('click', (e) => {
        if (!countrySelector.contains(e.target)) {
          countrySelectorBtn.setAttribute('aria-expanded', 'false');
          const icon2 = countrySelectorBtn.querySelector('img, svg');
          if (icon2) {
            icon2.style.transform = 'rotate(0)';
          }
          countrySelectorDropdown.classList.add('opacity-0', 'invisible');
        }
      });
    }

    // Search bar

    const searchToggle = document.getElementById('search-toggle');
    const searchContainer = document.getElementById('search-container');
    const searchOverlay = document.getElementById('search-overlay');
    const closeSearch = document.getElementById('close-search');
    const searchInput = searchContainer.querySelector('input[type="search"]');

    let isSearchOpen = false;

    searchContainer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
    searchOverlay.style.transition = 'opacity 0.3s ease';

    searchContainer.style.transform = 'translateY(0px)';

    searchOverlay.classList.add('pointer-events-none');

    function toggleSearch(show) {
      if (show === isSearchOpen) return;

      isSearchOpen = show;

      searchToggle.setAttribute('aria-expanded', show);

      const header = document.querySelector('[data-header-sticky]');
      if (header) {
        const headerHeight = header.offsetHeight;
        searchContainer.style.top = `${headerHeight}px`;
      }

      if (show) {
        searchContainer.classList.remove('hidden');
        searchOverlay.style.opacity = '0.5';
        searchOverlay.classList.remove('pointer-events-none');

        requestAnimationFrame(() => {
          searchContainer.style.opacity = '1';
          searchContainer.style.transform = 'translateY(0)';

          setTimeout(() => searchInput.focus(), 400);
        });
      } else {
        searchContainer.style.opacity = '0';
        searchContainer.style.transform = 'translateY(-20px)';

        searchOverlay.style.opacity = '0';
        searchOverlay.classList.add('pointer-events-none');

        searchContainer.addEventListener('transitionend', function handler(e) {
          if (e.propertyName === 'opacity' && !isSearchOpen) {
            searchContainer.classList.add('hidden');
            searchContainer.removeEventListener('transitionend', handler);
          }
        });
      }
    }

    searchToggle.addEventListener('click', () => toggleSearch(!isSearchOpen));

    closeSearch.addEventListener('click', () => toggleSearch(false));
    searchOverlay.addEventListener('click', () => toggleSearch(false));

    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape' && isSearchOpen) {
        toggleSearch(false);
      }
    });

    // Bottom bar
    const bottomBarIndicator = document.getElementById('bottom-bar-indicator');

    if (bottomBarIndicator) {
      bottomBarIndicator.style.width = '100%';
      bottomBarIndicator.style.transform = 'translateX(0)';
    }

    const menuItems = document.querySelectorAll('.menu-items ul > li.dropdown-group');

    menuItems.forEach((item) => {
      const link = item.querySelector('a');

      item.addEventListener('mouseenter', () => {
        const rect = link.getBoundingClientRect();
        const containerRect = item.closest('.menu-items').getBoundingClientRect();
        const left = rect.left - containerRect.left;
        const width = rect.width;

        bottomBarIndicator.style.transform = `translateX(${left}px) translateY(-6px)`;
        bottomBarIndicator.style.width = `${width}px`;
      });

      item.addEventListener('mouseleave', () => {
        // Reset only when leaving the whole dropdown group
        bottomBarIndicator.style.width = `100%`;
        bottomBarIndicator.style.transform = `translateX(0) translateY(0px)`;
      });
    });

    const dropdownGroups = document.querySelectorAll('.dropdown-group');
    const megaMenuOverlay = document.getElementById('mega-menu-overlay');

    let hoverCount = 0;

    dropdownGroups.forEach((group) => {
      const megaMenu = group.querySelector('[id^="mega-menu-"]');

      if (megaMenu) {
        group.addEventListener('mouseenter', () => {
          hoverCount++;

          group.classList.add('active-submenu');

          megaMenuOverlay.classList.remove('opacity-0', 'pointer-events-none');
          megaMenuOverlay.classList.add('opacity-50');

          requestAnimationFrame(() => {
            megaMenu.style.opacity = '1';
            megaMenu.style.transform = 'translateY(0)';
            megaMenu.style.pointerEvents = 'auto';
          });
        });

        group.addEventListener('mouseleave', () => {
          group.classList.remove('active-submenu');
          hoverCount--;

          megaMenu.style.opacity = '0';
          megaMenu.style.transform = 'translateY(-300px)';
          megaMenu.style.pointerEvents = 'none';

          if (hoverCount <= 0) {
            megaMenuOverlay.classList.add('opacity-0', 'pointer-events-none');
            megaMenuOverlay.classList.remove('opacity-50');
          }
        });
      }
    });
  });
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Main Menu"
    },
    {
      "type": "image_picker",
      "id": "dropdown_icon",
      "label": "Dropdown Icon"
    },
    {
      "type": "text",
      "id": "scrolling_text",
      "label": "Scrolling Text",
      "default": "STAY TRUE → KEEP GOING → FIND THE BALANCE → STAY TRUE → KEEP GOING → FIND THE BALANCE → STAY TRUE → KEEP GOING → FIND THE BALANCE → STAY TRUE → KEEP GOING → FIND THE BALANCE →"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky",
      "label": "Enable sticky header",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "mega_menu_images",
      "name": "Mega Menu Images",
      "settings": [
        {
          "type": "text",
          "id": "menu_item_name",
          "label": "Menu Item Name",
          "info": "Enter the exact name of the menu item"
        },
        {
          "type": "image_picker",
          "id": "image_1",
          "label": "First Image"
        },
        {
          "type": "url",
          "id": "button_link_1",
          "label": "First Button Link"
        },
        {
          "type": "text",
          "id": "button_text_1",
          "label": "First Button Text",
          "default": "Shop Now"
        },
        {
          "type": "image_picker",
          "id": "image_2",
          "label": "Second Image"
        },
        {
          "type": "url",
          "id": "button_link_2",
          "label": "Second Button Link"
        },
        {
          "type": "text",
          "id": "button_text_2",
          "label": "Second Button Text",
          "default": "Learn More"
        }
      ]
    }
  ]
}
{% endschema %}
