<style>
   .featured-blog-section {
     padding: {{ settings.sections_spacing }}px {{ settings.side_space}}px;
     margin: 0;
     background-color: rgb(var(--color-background)) !important;
     color: var(--text) !important;
     border-top: 1px solid var(--text);
     /* margin-right: 0; */
   }

   @media (max-width: 749px) {
     .featured-blog-section {
       padding-top: 20px;
     }
   }

   .featured-blog-section ::selection {
     /* background: none; */
     color: var(--cr-yellow-2) !important;
   }
   .featured-blog-section-title {
     font-size: 32px;
     font-weight: 400;
     margin: 0;
     padding: 0;
   }

   .featured-blog-section-header {
     display: flex;
     justify-content: space-between;
     align-items: center;
     margin: 0;
   }
   .view-toggle {
     position: relative;
     display: inline-flex;
     border: 1px solid var(--text);
     border-radius: 5px;
     overflow: hidden;
     /* min-width: 13.5rem; */
   }
   .view-toggle .toggle-slider {
     position: absolute;
     top: 0;
     left: 0;
     width: 0;
     height: 100%;
     background: var(--text);
     border-radius: 5px;
     transition: left 0.3s ease, width 0.3s ease;
     z-index: 0;
   }
   .view-toggle button {
     position: relative;
     padding: 0.3rem 0.45rem;
     border: none;
     background: transparent;
     color: var(--text);
     cursor: pointer;
     font-size: 24px;
     z-index: 1;
     transition: color 0.3s ease;
     line-height: 20px;
     text-transform: uppercase;
   }
   .view-toggle button.active {
     color: rgb(var(--color-background));
     background-color: var(--text);
   }

   .featured-blog-grid {
     margin: 0 0 2rem auto;
     transition: opacity 0.3s ease;
     opacity: 1;
     overflow: visible;
   }

   .featured-blog-grid.grid-view {
     margin-top: 50px;
   }

   .featured-blog-grid.list-view {
     margin-top: 20px;
   }

   .featured-blog-grid.list-view {
     /* border-bottom: 1px solid var(--text); */
     width: 80%;
     display: block;
   }

   .featured-blog-grid.list-view .fb-arrow-svg-wrapper {
     padding-right: 5px;
   }

   .featured-blog-grid.list-view .fb-arrow-svg {
     width: 20px;
     height: 20px;
     transition: all 0.3s ease;
   }

   @media (max-width: 749px) {
     .featured-blog-grid {
       width: 100% !important;
       margin: 0 0 2rem;
     }
   }
   .featured-blog-grid.grid-view {
     display: grid;
     grid-template-columns: repeat(3, 1fr);
     gap: 40px 20px;
   }

   @media (min-width: 700px) {
     .featured-blog-grid.list-view .featured-blog-card-date {
       min-width: 300px;
     }
   }

   @media (min-width: 900px) {
     .featured-blog-grid.list-view .featured-blog-card-date {
       min-width: 450px;
     }
   }

   @media (max-width: 1025px) {
     .featured-blog-grid.grid-view {
       grid-template-columns: repeat(2, 1fr);
     }
     .featured-blog-grid {
       width: 100% !important;
     }

     .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-image-wrapper {
       left: 5px !important;
       width: 200px !important;
       transform: translate(0, -50%) !important;
     }

     .featured-blog-grid.list-view .featured-blog-card-title {
       font-size: 20px;
     }

     .view-toggle button {
       font-size: 20px;
     }
   }
   @media (max-width: 749px) {
     .featured-blog-grid.grid-view {
       grid-template-columns: 1fr;
     }
   }

   .featured-blog-card {
     position: relative;
     display: flex;
     flex-direction: column;
     background: rgb(var(--color-background));
     text-decoration: none;
     overflow: visible;
     transition: background 0.3s ease, color 0.3s ease;
   }
   .featured-blog-card-image-wrapper {
     width: 100%;
     overflow: hidden;
   }
   .featured-blog-card-image {
     display: block;
     width: 100%;
     height: auto;
     object-fit: cover;
     transform-origin: center center;
     transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
   }
   .featured-blog-card:hover .featured-blog-card-image {
     transform: scale(1.08);
   }
   .featured-blog-card-content {
     display: flex;
     flex-direction: column;
     flex: 1 1 auto;
   }
   .featured-blog-card-date {
     position: relative;
     line-height: 1;
     padding: 25px 0 25px 0;
     color: var(--text);
     white-space: nowrap;
     font-size: 16px;
     margin: 0;
   }

   .featured-blog-card-title {
     line-height: 1;
   }

   /* Show/Hide title spans based on view */
   .featured-blog-grid.grid-view .list-view-title {
     display: none;
   }

   .featured-blog-grid.list-view .grid-view-title {
     display: none;
   }

   /* .featured-blog-card-title {
    font-size: 32px;
    line-height: 1.1;
    margin: 0 0 1rem;
    font-weight: 500;
    color: var(--text);
    letter-spacing: -1px;
    line-height: 85%;
  } */
   .featured-blog-card-desc {
     font-size: 2rem;
     margin: 0;
     color: var(--text);
     flex-grow: 1;
   }

   /* List view separators */
   .featured-blog-grid.list-view .list-separator {
     display: block;
     height: 1px;
     background-color: var(--text);
     width: 100%;
     margin: 0;
   }

   .featured-blog-grid.grid-view .list-separator {
     display: none;
   }

   /* List view overrides */
   .featured-blog-grid.list-view .featured-blog-card {
     flex-direction: row;
     align-items: center;
     padding: 10px 0;
     border-top: none;
   }
   .featured-blog-grid.list-view .featured-blog-card:hover {
     background: var(--text);
     color: rgb(var(--color-background));
   }
   .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-title,
   .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-date {
     color: rgb(var(--color-background));
   }

   .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-date {
     z-index: 1002;
   }

   .featured-blog-grid.list-view .featured-blog-card:hover .fb-arrow-svg {
     filter: invert(1);
   }

   /* Hide description and image wrapper by default in list view */
   .featured-blog-grid.list-view .featured-blog-card-desc,
   .featured-blog-grid.list-view .featured-blog-card-image-wrapper {
     display: none;
   }

   /* Side-by-side date and title with ellipsis */
   .featured-blog-grid.list-view .featured-blog-card-content {
     flex-direction: row;
     align-items: center;
     padding: 0;
     gap: 1rem;
   }

   /* Preview image on hover in list view */
   .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-image-wrapper {
     display: block;
     position: absolute;
     top: 50%;
     left: -50px;
     width: 300px;
     transform: translate(-50%, -50%);
     z-index: 1000;
     overflow: visible;
   }
   .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-title-arrow {
     filter: invert(1) brightness(2);
   }
   .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-date {
     color: rgb(var(--color-background));
   }
   .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-image {
     width: 100%;
     height: auto;
   }
   /* .featured-blog-grid.list-view .featured-blog-card-content,
  .featured-blog-grid.list-view .featured-blog-card-title,
  .featured-blog-grid.list-view .featured-blog-card-date {
    min-width: 0;
  } */

   .featured-blog-grid.list-view .featured-blog-card-content {
     white-space: nowrap; /* Prevent text wrapping */
     text-overflow: ellipsis; /* Add ellipsis for overflowed text */
     max-width: 100%;
   }

   .featured-blog-grid.grid-view .fb-arrow-svg {
     width: 20px;
     height: 20px;
   }

   .featured-blog-grid.list-view .featured-blog-card-title {
     flex-shrink: 1;
     min-width: 0;
     width: 100%;
     white-space: nowrap; /* Prevent text wrapping */
     overflow: hidden; /* Hide overflowing text */
     text-overflow: ellipsis; /* Add ellipsis for overflowed text */
     max-width: 100%;
     /* Ensure the title stays within its container */
     margin: 0;
     line-height: normal;
     display: flex;
     align-items: center;
     color: var(--text);
     font-weight: normal;
   }

   .featured-blog-grid.list-view .featured-blog-card-date {
     padding: 0;
   }

   .load-more-btn-fb-container {
     margin-top: 50px;
     display: flex;
     justify-content: end;
   }

   .load-more-btn-fb {
     background-color: var(--text);
     color: rgb(var(--color-background));
     padding: 4px 10px;
     border: 1px solid var(--text);
     border-radius: 5px;
     cursor: pointer;
     font-size: 20px;
     line-height: 1;
     transition: background-color 0.3s;
   }
   .load-more-btn-fb:hover {
     background-color: rgb(var(--color-background)); /* adjust if needed */
     color: var(--text);
     border: 1px solid var(--text);
   }

   /* Removed fade-in animation and transitions */
   /* @keyframes fadeInAnimation { ... } */

   .blog-article-fb {
     opacity: 1;
     transition: none;
   }

   .blog-article-fb.visible {
     opacity: 1;
     transform: none;
     animation: none;
   }

   .blog-article-fb:not(.visible) {
     transform: none;
   }

   @media (max-width: 1025px) {
     .featured-blog-grid.list-view .featured-blog-card-date {
       font-size: 14px !important;
     }
   }

   @media (max-width: 600px) {
     .view-toggle button {
       padding: 0px 4.5px;
     }

     .featured-blog-grid.grid-view {
       margin-top: 20px;
     }

     .featured-blog-card-content {
       padding: 0;
     }

     .featured-blog-card-date {
       padding: 10px 0 20px 0;
     }

     .featured-blog-card-title {
       font-size: 20px;
     }

     .featured-blog-grid.grid-view .fb-arrow-svg {
       width: 15px;
       height: 15px;
     }

     .featured-blog-grid.list-view .featured-blog-card-content {
       flex-direction: column;
       padding: 1rem 0;
       gap: 0.5rem;
       align-items: flex-start;
     }

     .featured-blog-grid.list-view .featured-blog-card-title {
       max-width: calc(100vw - 32px);
       padding-left: 30px;
     }
     .view-toggle button {
       font-size: 16px;
     }
     .featured-blog-section-title {
       font-size: 24px;
     }

     .featured-blog-grid.list-view .featured-blog-card-title {
       font-size: 16px;
     }

     .featured-blog-grid.list-view .fb-arrow-svg {
       width: 15px;
       height: 15px;
     }

     .featured-blog-card-date {
       font-size: 14px;
     }

     .load-more-btn-fb {
       font-size: 16px;
       line-height: 1;
       padding: 1px 6px;
     }
   }

   @media (min-width: 1025px) {
     .featured-blog-grid.list-view .featured-blog-card-date {
       font-size: 20px;
     }

     .featured-blog-grid.list-view .featured-blog-card-title {
       font-size: 24px;
     }

     .load-more-btn-fb {
       font-size: 24px;
       line-height: 1;
     }
   }

   /* Ensure the container doesn’t clip anything */
   .featured-blog-grid.list-view {
     overflow: visible !important;
   }

   /* Base stacking context for each card/article */
   .featured-blog-grid.list-view .blog-article-fb {
     position: relative;
     z-index: 1;
   }

   /* On hover, lift the whole card and its preview */
   .featured-blog-grid.list-view .blog-article-fb:hover {
     z-index: 1000; /* high enough to clear siblings */
   }

   /* And make sure the preview wrapper itself is on top */
   .featured-blog-grid.list-view .blog-article-fb:hover .featured-blog-card-image-wrapper {
     z-index: 1001; /* even higher */
   }
</style>

{% if section.settings.enabled %}
  <section
    class="featured-blog-section color-{{ section.settings.color_scheme }}"
    aria-labelledby="featured-blog-section-title"
  >
    <header class="featured-blog-section-header">
      <h2 class="featured-blog-section-title" id="featured-blog-section-title">{{ section.settings.heading }}</h2>
      <div class="view-toggle" role="radiogroup" aria-label="Blog view options">
        <div class="toggle-slider"></div>
        <button
          id="gridViewBtn"
          class="active"
          role="radio"
          aria-checked="true"
          type="button"
          style="border-radius: 0px 5px 5px 0px;"
        >
          Grid
        </button>
        <button
          id="listViewBtn"
          role="radio"
          aria-checked="false"
          type="button"
          style=" border-radius: 5px 0px 0px 5px !important; padding-left: 10px"
        >
          List
        </button>
      </div>
    </header>

    {% if section.settings.description != blank %}
      <div class="sr-only" id="featured-blog-section-desc">
        {{ section.settings.description }}
      </div>
    {% endif %}

    <div
      class="featured-blog-grid grid-view"
      id="archiveContainer"
      aria-live="polite"
      aria-label="Blog articles"
      data-post-limit="{{ section.settings.post_limit }}"
      data-total-posts="{% if blog_handle != blank %}{{ blogs[blog_handle].articles.size }}{% else %}0{% endif %}"
    >
      <!-- Separator before container (only visible in list view) -->
      <div class="list-separator"></div>

      {% assign blog_handle = section.settings.blog %}
      {% assign post_limit = section.settings.post_limit %}
      {% if blog_handle != blank and blogs[blog_handle].articles.size > 0 %}
        {% for article in blogs[blog_handle].articles %}
          <article
            aria-labelledby="article-title-{{ forloop.index0 }}"
            class="blog-article-fb"
            {% if forloop.index > post_limit %}
              style="display: none;"
            {% endif %}
          >
            <a
              href="{{ article.url }}"
              class="featured-blog-card"
              aria-describedby="article-date-{{ forloop.index0 }}"
            >
              <div class="featured-blog-card-image-wrapper">
                {% if article.image %}
                  <img
                    class="featured-blog-card-image"
                    srcset="
                      {%- if article.image.width >= 165 -%}{{ article.image | image_url: width: 165 }} 165w,{%- endif -%}
                      {%- if article.image.width >= 360 -%}{{ article.image | image_url: width: 360 }} 360w,{%- endif -%}
                      {%- if article.image.width >= 535 -%}{{ article.image | image_url: width: 535 }} 535w,{%- endif -%}
                      {%- if article.image.width >= 750 -%}{{ article.image | image_url: width: 750 }} 750w,{%- endif -%}
                      {%- if article.image.width >= 1070 -%}{{ article.image | image_url: width: 1070 }} 1070w,{%- endif -%}
                      {%- if article.image.width >= 1500 -%}{{ article.image | image_url: width: 1500 }} 1500w,{%- endif -%}
                      {{ article.image | image_url }} {{ article.image.width }}w
                    "
                    src="{{ article.image | image_url: width: 750 }}"
                    alt="{{ article.title }}"
                    width="auto"
                    height="auto"
                    loading="lazy"
                  >
                {% else %}
                  {% comment %}
                    <div style="width:100%; background:#f3f3f3; display:flex; align-items:center; justify-content:center; padding:4rem 0;">
                      <span style="color:#bbb;" aria-hidden="true">No image</span>
                    </div>
                  {% endcomment %}
                {% endif %}
              </div>
              <div class="featured-blog-card-content">
                <time
                  class="featured-blog-card-date"
                  id="article-date-{{ forloop.index0 }}"
                  datetime="{{ article.published_at | date: '%Y-%m-%d' }}"
                >
                  {{ article.published_at | date: '%m.%d.%y' }}
                </time>
                <h3 class="featured-blog-card-title" id="article-title-{{ forloop.index0 }}">
                  <div
                    class="fb-arrow-svg-wrapper object-contain transition-transform duration-300 group-hover:-rotate-90 featured-blog-card-title-arrow inline-block align-baseline"
                    alt="Dropdown Icon"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="fb-arrow-svg w-5 h-5 object-contain transition-transform duration-200 ease-in-out group-hover:-rotate-90 mx-1"
                      fill="none"
                      viewBox="0 0 9 9"
                      stroke-width="1"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      aria-hidden="true"
                    >
                      <path d="M1.1875 7.7334H7.6599M7.6599 7.7334V1.261M7.6599 7.7334L1.1875 1.261"/>
                    </svg>
                  </div>
                  {% comment %}
                    <img
                      src="{{ "arrow-down.png" | asset_url }}"
                      alt=""
                      class="w-12 h-6 object-contain transition-transform duration-300 group-hover:-rotate-90 featured-blog-card-title-arrow inline-block align-baseline"
                      width="15px"
                      height="auto"
                      aria-hidden="true"
                      style="margin-bottom:5px; position:relative; left:-5px;"
                    >
                  {% endcomment %}
                  <span class="grid-view-title">{{ article.title }}</span>
                  <span class="list-view-title">{{ article.title | truncate: 40, '...' }}</span>
                </h3>
                <p class="featured-blog-card-desc">
                  {{ article.excerpt | strip_html | truncate: 120 }}
                </p>
              </div>
            </a>
            <!-- Separator after each card (only visible in list view) -->
            <div class="list-separator"></div>
          </article>
        {% endfor %}
      {% endif %}
    </div>
    {% if blogs[blog_handle].articles.size > section.settings.post_limit %}
      <div class="load-more-btn-fb-container">
        <button class="load-more-btn-fb" data-increment="6">LOAD MORE</button>
      </div>
    {% endif %}
  </section>
{% endif %}

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const gridBtn = document.getElementById('gridViewBtn');
    const listBtn = document.getElementById('listViewBtn');
    const sectionEl = document.querySelector('.featured-blog-section');
    const slider = document.querySelector('.toggle-slider');
    const container = document.getElementById('archiveContainer');
    const buttons = [gridBtn, listBtn];
    const loadMoreBtn = document.querySelector('.load-more-btn-fb');

    // Remove scroll animation logic
    // No IntersectionObserver, no fade-in

    // Load more functionality
    if (loadMoreBtn) {
      const increment = parseInt(loadMoreBtn.dataset.increment || '6', 10);
      const postLimit = parseInt(container.dataset.postLimit || '5', 10);
      let currentlyVisible = postLimit;

      loadMoreBtn.addEventListener('click', function () {
        const blogArticles = document.querySelectorAll('#archiveContainer .blog-article-fb');
        const endIndex = Math.min(currentlyVisible + increment, blogArticles.length);
        for (let i = currentlyVisible; i < endIndex; i++) {
          if (blogArticles[i]) {
            blogArticles[i].style.display = '';
          }
        }
        currentlyVisible = endIndex;
        if (currentlyVisible >= blogArticles.length) {
          loadMoreBtn.style.display = 'none';
        }
      });

      const updateVisibilityAfterViewChange = () => {
        const blogArticles = document.querySelectorAll('#archiveContainer .blog-article-fb');
        blogArticles.forEach((article, index) => {
          article.style.display = index < currentlyVisible ? '' : 'none';
        });
      };

      gridBtn.addEventListener('click', updateVisibilityAfterViewChange);
      listBtn.addEventListener('click', updateVisibilityAfterViewChange);
    }

    function updateSliderPos(isList) {
      const activeBtn = isList ? listBtn : gridBtn;
      const rect = activeBtn.getBoundingClientRect();
      const parentRect = activeBtn.parentNode.getBoundingClientRect();
      slider.style.width = `${rect.width}px`;
      slider.style.left = `${rect.left - parentRect.left}px`;
    }

    function switchView(toList) {
      buttons.forEach((btn) => {
        const isActive = btn === (toList ? listBtn : gridBtn);
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-checked', isActive.toString());
      });
      container.style.opacity = 0;
      setTimeout(() => {
        container.classList.toggle('list-view', toList);
        container.classList.toggle('grid-view', !toList);
        sectionEl.classList.toggle('list-view', toList);
        updateSliderPos(toList);
        container.style.opacity = 1;
      }, 300);
    }

    updateSliderPos(false);
    gridBtn.addEventListener('click', () => switchView(false));
    listBtn.addEventListener('click', () => switchView(true));

    buttons.forEach((btn) => {
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
          e.preventDefault();
          const currentIndex = buttons.indexOf(e.target);
          const nextIndex =
            e.key === 'ArrowRight'
              ? (currentIndex + 1) % buttons.length
              : (currentIndex - 1 + buttons.length) % buttons.length;
          buttons[nextIndex].focus();
          switchView(nextIndex === 1);
        }
      });
    });

    window.addEventListener('resize', () => updateSliderPos(sectionEl.classList.contains('list-view')));
  });
</script>

{% schema %}
{
  "name": "Featured Blogs",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "tag": "section",
  "class": "my-custom-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enabled",
      "label": "Enable section",
      "default": true
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Main Heading",
      "default": "Featured Blogs"
    },
    {
      "type": "blog",
      "id": "blog",
      "label": "Select Blog"
    },
    {
      "type": "range",
      "id": "post_limit",
      "label": "Number of Posts to Display",
      "default": 6,
      "min": 3,
      "max": 20,
      "step": 1
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "Featured Blogs",
      "settings": {
        "blog": "news"
      }
    }
  ]
}
{% endschema %}
