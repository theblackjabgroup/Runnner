{% assign side_padding = settings.side_space %}

{% if side_padding == blank or side_padding == 0 %}
  {% assign side_padding = 20 %}
{% endif %}

<style>
    #gridViewBtn {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #listViewBtn {
    display: flex;
    justify-content: center;
    align-items: center;
  }
     .featured-blog-section {
       background-color: rgb(var(--color-background)) !important;
       color: var(--text) !important;
       border-top: 1px solid var(--text);
       padding: var(--sections-spacing-top) {{ side_padding }}px var(--sections-spacing-bottom);
     }

     /* Text selection styling removed - using default browser behavior */
     .featured-blog-section-title {
       font-size: var(--t-h-4-size);
       font-weight: var(--t-h-4-weight);
       line-height: var(--t-h-4-line-height);
       font-family: var(--font-heading-family);
       font-style: var(--font-heading-style);;
       margin: 0;
       padding: 0;
     }

     .featured-blog-section-header {
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin: 0;
     }
     .view-toggle {
       position: relative;
       display: inline-flex;
       border: {{ settings.buttons_border_thickness }}px solid var(--text);
       border-radius: {{ settings.buttons_radius }}px;
       overflow: hidden;
       height: 28px;

       /* min-width: 13.5rem; */
     }
     .view-toggle .toggle-slider {
       position: absolute;
       top: 0;
       left: 0;
       width: 0;
       height: 100%;
       background: var(--text);
       border-radius: {{ settings.buttons_radius }}px;
       transition: left 0.3s ease, width 0.3s ease;
       z-index: 0;
     }
     .view-toggle button {
       position: relative;
       padding: 0rem var(--space-xs);
       border: none;
       background: transparent;
       color: var(--text);
       cursor: pointer;
       z-index: 1;
       transition: color 0.3s ease;
       text-transform: uppercase;
       font-size: var(--t-b-1-size);
       font-weight: var(--t-b-1-weight);
       line-height: var(--t-b-1-line-height);
     }
     .view-toggle button.active {
       color: rgb(var(--color-background));
       background-color: var(--text);
     }

     .featured-blog-grid {
       margin: 0 0 2rem auto;
       transition: opacity 0.3s ease;
       opacity: 1;
       overflow: visible;
     }

     .featured-blog-grid.grid-view {
       margin-top: 35px;
     }

     .featured-blog-grid.list-view {
       margin-top: 50px;
     }

     .featured-blog-grid.list-view {
       /* border-bottom: 1px solid var(--text); */
       width: 85%;
       display: block;
     }

     .featured-blog-grid.list-view .fb-arrow-svg-wrapper {
       padding-right: var(--space-xs);
     }

     .featured-blog-grid.list-view .fb-arrow-svg {
       width: 17.26px;
       height: 16.8px;
       transition: color 0.3s ease;
     }

     @media (max-width: 749px) {
       .featured-blog-grid {
         width: 100% !important;
         margin: 0 0 2rem;
       }
     }
     .featured-blog-grid.grid-view {
       display: grid;
       grid-template-columns: repeat(3, 1fr);
       gap: 40px 20px;
     }

     @media (min-width: 700px) {
       .featured-blog-grid.list-view .featured-blog-card-date {
         min-width: 300px;
       }
     }

     @media (min-width: 900px) {
       .featured-blog-grid.list-view .featured-blog-card-date {
         min-width: 450px;
       }
     }

     @media (max-width: 1025px) {
       .featured-blog-grid.grid-view {
         grid-template-columns: repeat(2, 1fr);
       }
       .featured-blog-grid {
         width: 100% !important;
       }

       .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-image-wrapper {
         left: 5px !important;
         width: 200px !important;
         transform: translate(0, -50%) !important;
       }

       .featured-blog-grid.list-view .featured-blog-card-title {
         font-size: var(--tm-b-1-size);
       }
     }
     @media (max-width: 749px) {
       .featured-blog-grid.grid-view {
         grid-template-columns: 1fr;
       }
     }

     .featured-blog-card {
       position: relative;
       display: flex;
       flex-direction: column;
       background: rgb(var(--color-background));
       text-decoration: none;
       overflow: visible;
       transition: background 0.3s ease, color 0.3s ease;
     }
     .featured-blog-card-image-wrapper {
       width: 100%;
       overflow: hidden;
     }
     .featured-blog-card-image {
       display: block;
       width: 100%;
       height: auto;
       object-fit: cover;
       transform-origin: center center;
       transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
     }
     .featured-blog-card:hover .featured-blog-card-image {
       transform: scale(1.08);
     }
     .featured-blog-card-content {
       display: flex;
       flex-direction: column;
       flex: 1 1 auto;
     }
     .featured-blog-card-date {
       position: relative;
       padding: var(--space-3xl) 0;
       color: var(--text);
       white-space: nowrap;
       margin: 0;
       font-size: var(--t-b-2-size);
       font-weight: var(--t-b-2-weight);
       line-height: var(--t-b-2-line-height);
     }

     .featured-blog-card-title {
       line-height: 1;
       font-size: var(--t-h-4-size);
       font-weight: var(--t-h-4-weight);
       line-height: var(--t-h-4-line-height);
      font-family: var(--font-subheading-family);
      font-style: var(--font-subheading-style);
     }

     .featured-blog-grid.grid-view .featured-blog-card-title{
      padding-bottom: var(--space-3xl);
     }

     /* Show/Hide title spans based on view */
     .featured-blog-grid.grid-view .list-view-title {
       display: none;
     }

     .featured-blog-grid.list-view .grid-view-title {
       display: none;
     }

     /* .featured-blog-card-title {
      font-size: 32px;
      line-height: 1.1;
      margin: 0 0 1rem;
      font-weight: var(--weight-medium);
      color: var(--text);
      letter-spacing: -1px;
      line-height: 85%;
    } */
     .featured-blog-card-desc {
       margin: 0;
       color: var(--text);
       flex-grow: 1;
      font-family: var(--font-body-family);
      font-style: var(--font-body-style);
       font-size: var(--t-b-2-size);
       font-weight: var(--t-b-2-weight);
       line-height: var(--t-b-2-line-height);
     }

     /* List view separators */
     .featured-blog-grid.list-view .list-separator {
       display: block;
       height: 1px;
       background-color: var(--text);
       width: 100%;
       margin: 0;
     }

     .featured-blog-grid.grid-view .list-separator {
       display: none;
     }

     /* List view overrides */
     .featured-blog-grid.list-view .featured-blog-card {
       flex-direction: row;
       align-items: center;
       padding: var(--space-3xl) 0;
       border-top: none;
     }
     .featured-blog-grid.list-view .featured-blog-card:hover {
       background: var(--text);
       color: rgb(var(--color-background));
     }
     .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-title,
     .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-date {
       color: rgb(var(--color-background));
     }

     .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-date {
       z-index: 1002;
     }

     .featured-blog-grid.list-view .featured-blog-card:hover .fb-arrow-svg {
       color: rgb(var(--color-background));
     }

     /* Hide description and image wrapper by default in list view */
     .featured-blog-grid.list-view .featured-blog-card-desc,
     .featured-blog-grid.list-view .featured-blog-card-image-wrapper {
       display: none;
     }

     /* Side-by-side date and title with ellipsis */
     .featured-blog-grid.list-view .featured-blog-card-content {
       flex-direction: row;
       align-items: center;
       padding: 0;
       /* gap: 1rem; */
     }

     /* Preview image on hover in list view */
     .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-image-wrapper {
       display: block;
       position: absolute;
       top: 50%;
       left: -50px;
       width: 300px;
       transform: translate(-50%, -50%);
       z-index: 1000;
       overflow: visible;
     }
     .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-title-arrow {
       color: rgb(var(--color-background));
     }
     .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-date {
       color: rgb(var(--color-background));
     }
     .featured-blog-grid.list-view .featured-blog-card:hover .featured-blog-card-image {
       width: 100%;
       height: auto;
     }
     /* .featured-blog-grid.list-view .featured-blog-card-content,
    .featured-blog-grid.list-view .featured-blog-card-title,
    .featured-blog-grid.list-view .featured-blog-card-date {
      min-width: 0;
    } */

     .featured-blog-grid.list-view .featured-blog-card-content {
       white-space: nowrap; /* Prevent text wrapping */
       text-overflow: ellipsis; /* Add ellipsis for overflowed text */
       max-width: 100%;
     }

     .featured-blog-grid.grid-view .fb-arrow-svg {
       width: 23px;
       height: 22px;
     }

     .featured-blog-grid.list-view .featured-blog-card-title {
       flex-shrink: 1;
       min-width: 0;
       width: 100%;
       white-space: nowrap; /* Prevent text wrapping */
       overflow: hidden; /* Hide overflowing text */
       text-overflow: ellipsis; /* Add ellipsis for overflowed text */
       max-width: 100%;
       /* Ensure the title stays within its container */
       margin: 0;
       line-height: normal;
       display: flex;
       align-items: center;
       color: var(--text);
       font-weight: normal;
     }

     .featured-blog-grid.list-view .featured-blog-card-date {
       padding: 0;
     }

     .load-more-btn-fb-container {
       margin-top: 50px;
       margin-bottom: 40px;
       display: flex;
       justify-content: end;
       cursor: pointer;
     }

     /* Featured blog load more button styles */
     .featured-blog-load-more-btn {
       min-width: auto !important;
       width: auto !important;
       max-width: fit-content !important;

     }

     .featured-blog-load-more-btn,
     .featured-blog-load-more-btn * {
       cursor: pointer !important;
       pointer-events: auto !important;
     }

     .featured-blog-grid.list-view .featured-blog-card-title{
      line-height: 1 !important;
     }

     .load-more-btn-fb {
       position: relative;
       background-color: var(--button);
       color: var(--button_label);
       padding: var(--space-xs) var(--space-lg);
       border: {{ settings.buttons_border_thickness }}px solid var(--button_label);
       border-radius: {{ settings.buttons_radius }}px;
       cursor: pointer;
       font-size: var(--tm-b-1-size);
       line-height: 1;
       overflow: hidden;
       transition: background-color 0.3s ease, color 0.3s ease, border 0.3s ease;
     }
     .load-more-btn-fb:hover {
       background-color: var(--hovered_button_label);
       color: var(--hovered_button_text_color);
       border-color: var(--hovered_button_text_color);;
     }

     .load-more-btn-fb-text-container {
       position: relative;
       width: 100%;
       overflow: hidden;
     }

     .load-more-btn-fb-text {
       display: flex;
       align-items: center;
       line-height: 1;
       text-transform: uppercase;
       letter-spacing: 0.05em;
       transition: transform 0.7s ease;
     }

     .load-more-btn-fb:hover .load-more-btn-fb-text,
     .load-more-btn-fb:focus .load-more-btn-fb-text {
       transform: translateX(-100%);
     }

     .load-more-btn-fb-text-hover {
       position: absolute;
       top: 0;
       left: 0;
       display: flex;
       align-items: center;
       line-height: 1;
       text-transform: uppercase;
       letter-spacing: 0.05em;
       transform: translateX(100%);
       transition: transform 0.7s ease;
     }

     .load-more-btn-fb:hover .load-more-btn-fb-text-hover,
     .load-more-btn-fb:focus .load-more-btn-fb-text-hover {
       transform: translateX(0);
     }

     .load-more-btn-fb:not(:hover):not(:focus) .load-more-btn-fb-text,
     .load-more-btn-fb:not(:hover):not(:focus) .load-more-btn-fb-text-hover {
       transition: none;
     }

    /* Blog Article Fade-Up Animation */
    .blog-article-fb {
      opacity: 0;
      transform: translateY(50px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }

    .blog-article-fb.animate {
      opacity: 1;
      transform: translateY(0);
    }

     @media (max-width: 1025px) {
       .featured-blog-grid.list-view .featured-blog-card-date {
         font-size: var(--tm-b-3-size) !important;
       }
     }

     @media (max-width: 600px) {
       .view-toggle button {
         padding: 0px var(--space-xs);
        font-size: var(--tm-b-2-size);
        line-height: var(--tm-b-2-line-height);
       }

       .featured-blog-grid.grid-view {
         margin-top: 20px;
       }

       .featured-blog-card-content {
         padding: 0;
       }

       .featured-blog-card-date {
         padding: var(--space-lg) 0 var(--space-3xl) 0;
        font-size: var(--tm-b-3-size);
        line-height: var(--tm-b-3-line-height);
       }

       .featured-blog-card-title {
        font-size: var(--tm-h-3-size);
        line-height: var(--tm-h-3-line-height);
       }

       .featured-blog-grid.list-view .featured-blog-card-content {
         flex-direction: column;
         /* gap: 0.5rem; */
         align-items: flex-start;
       }

       .featured-blog-grid.list-view .featured-blog-card-title {
         max-width: calc(100vw - 32px);
         padding-left: var(--space-5xl);
       }
       .featured-blog-section-title {
        font-size: var(--tm-h-3-size);
        line-height: var(--tm-h-3-line-height);
       }

       .featured-blog-grid.list-view .featured-blog-card-title {
         font-size: var(--tm-b-2-size);
         line-height: 16px;
         padding-left: var(--space-3xl);
       }

       .featured-blog-grid.list-view .fb-arrow-svg {
         width: 11px;
         height: 11px;
       }

       .featured-blog-card-date {
         font-size: var(--tm-b-3-size);
       }

       .load-more-btn-fb {
         font-size: var(--tm-b-2-size);
         line-height: 1;
         padding: var(--space-tiny) var(--space-sm);
       }

       .load-more-btn-fb-text,
       .load-more-btn-fb-text-hover {
         font-size: var(--tm-b-2-size);
       }

       .featured-blog-grid.grid-view .fb-arrow-svg{
        width: 17.26px;
        height: 16.8px;
       }

       .featured-blog-grid.grid-view .featured-blog-card-title{
        padding-bottom: var(--space-lg);
       }

       .featured-blog-grid.grid-view .featured-blog-card-desc{
        font-size: var(--tm-b-3-size);
        line-height: var(--tm-b-3-line-height);
       }

       .load-more-btn-fb-container{
        margin-top: 20px;
        margin-bottom: 40px;
       }

       .featured-blog-grid.list-view .featured-blog-card-date{
        margin-bottom: 10px;
       }
     }

     @media (min-width: 1025px) {
       .featured-blog-grid.list-view .featured-blog-card-date {
         font-size: var(--tm-b-1-size);
       }

       .featured-blog-grid.list-view .featured-blog-card-title {
         font-size: var(--t-b-1-size);
       }

       .load-more-btn-fb {
         font-size: var(--t-b-1-size);
         line-height: 1;
       }

       .load-more-btn-fb-text,
       .load-more-btn-fb-text-hover {
         font-size: var(--t-b-1-size);
       }


     }

     /* Ensure the container doesn’t clip anything */
     .featured-blog-grid.list-view {
       overflow: visible !important;
     }

     /* Base stacking context for each card/article */
     .featured-blog-grid.list-view .blog-article-fb {
       position: relative;
       z-index: 1;
     }

     /* On hover, lift the whole card and its preview */
     .featured-blog-grid.list-view .blog-article-fb:hover {
       z-index: 1000; /* high enough to clear siblings */
     }

     /* And make sure the preview wrapper itself is on top */
     .featured-blog-grid.list-view .blog-article-fb:hover .featured-blog-card-image-wrapper {
       z-index: 1001; /* even higher */
     }
</style>

{% if section.settings.enabled %}
  <section
    class="featured-blog-section color-{{ section.settings.color_scheme }}"
    aria-labelledby="featured-blog-section-title"
  >
    <header class="featured-blog-section-header">
      <h2 class="featured-blog-section-title" id="featured-blog-section-title">{{ section.settings.heading }}</h2>
      <div class="view-toggle" role="radiogroup" aria-label="Blog view options">
        <div class="toggle-slider"></div>
        <button
          id="gridViewBtn"
          class="active"
          role="radio"
          aria-checked="true"
          type="button"
          style="border-radius: 0px {{ settings.buttons_radius }}px {{ settings.buttons_radius }}px 0px;"
        >
          Grid
        </button>
        <button
          id="listViewBtn"
          role="radio"
          aria-checked="false"
          type="button"
          style=" border-radius: {{ settings.buttons_radius }}px 0px 0px {{ settings.buttons_radius }}px !important; padding-left: var(--space-lg)"
        >
          List
        </button>
      </div>
    </header>

    {% if section.settings.description != blank %}
      <div class="sr-only" id="featured-blog-section-desc">
        {{ section.settings.description }}
      </div>
    {% endif %}

    <div
      class="featured-blog-grid grid-view"
      id="archiveContainer"
      aria-live="polite"
      aria-label="Blog articles"
      data-post-limit="3"
      data-total-posts="{% assign blog_handle = section.settings.blog %}{% if blog_handle != blank %}{{ blogs[blog_handle].articles.size }}{% else %}0{% endif %}"
    >
      <!-- Separator before container (only visible in list view) -->
      <div class="list-separator"></div>

      {% assign blog_handle = section.settings.blog %}
      {% assign initial_display = 3 %}
      {% if blog_handle != blank and blogs[blog_handle].articles.size > 0 %}
        {% for article in blogs[blog_handle].articles %}
          <article
            aria-labelledby="article-title-{{ forloop.index0 }}"
            class="blog-article-fb"
            {% if forloop.index > initial_display %}
              style="display: none;"
            {% endif %}
          >
            <a
              href="{{ article.url }}"
              class="featured-blog-card"
              aria-describedby="article-date-{{ forloop.index0 }}"
            >
              <div class="featured-blog-card-image-wrapper">
                {% if article.image %}
                  <img
                    class="featured-blog-card-image"
                    srcset="
                      {%- if article.image.width >= 165 -%}{{ article.image | image_url: width: 165 }} 165w,{%- endif -%}
                      {%- if article.image.width >= 360 -%}{{ article.image | image_url: width: 360 }} 360w,{%- endif -%}
                      {%- if article.image.width >= 535 -%}{{ article.image | image_url: width: 535 }} 535w,{%- endif -%}
                      {%- if article.image.width >= 750 -%}{{ article.image | image_url: width: 750 }} 750w,{%- endif -%}
                      {%- if article.image.width >= 1070 -%}{{ article.image | image_url: width: 1070 }} 1070w,{%- endif -%}
                      {%- if article.image.width >= 1500 -%}{{ article.image | image_url: width: 1500 }} 1500w,{%- endif -%}
                      {{ article.image | image_url }} {{ article.image.width }}w
                    "
                    src="{{ article.image | image_url: width: 750 }}"
                    alt="{{ article.title }}"
                    width="auto"
                    height="auto"
                    loading="lazy"
                  >
                {% else %}
                  {% comment %}
                    <div style="width:100%; background:#f3f3f3; display:flex; align-items:center; justify-content:center; padding:4rem 0;">
                      <span style="color:#bbb;" aria-hidden="true">No image</span>
                    </div>
                  {% endcomment %}
                {% endif %}
              </div>
              <div class="featured-blog-card-content">
                <time
                  class="featured-blog-card-date"
                  id="article-date-{{ forloop.index0 }}"
                  datetime="{{ article.published_at | date: '%Y-%m-%d' }}"
                >
                  {{ article.published_at | date: '%m.%d.%y' }}
                </time>
                <h3 class="featured-blog-card-title" id="article-title-{{ forloop.index0 }}">
                  <div
                    class="fb-arrow-svg-wrapper object-contain transition-transform duration-300 group-hover:-rotate-90 featured-blog-card-title-arrow inline-block align-baseline"
                    alt="Dropdown Icon"
                  >
                    <svg
                      class="fb-arrow-svg w-5 h-5 object-contain transition-transform duration-200 ease-in-out group-hover:-rotate-90 mx-1"
                      viewBox="4.5 1.5 8.5 13"
                      fill="currentColor"
                      xmlns="http://www.w3.org/2000/svg"
                      stroke="currentColor"
                      aria-hidden="true"
                    >
                      <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                    </svg>
                  </div>
                  {% comment %}
                    <img
                      src="{{ "arrow-down.png" | asset_url }}"
                      alt=""
                      class="w-12 h-6 object-contain transition-transform duration-300 group-hover:-rotate-90 featured-blog-card-title-arrow inline-block align-baseline"
                      width="15px"
                      height="auto"
                      aria-hidden="true"
                      style="margin-bottom:5px; position:relative; left:-5px;"
                    >
                  {% endcomment %}
                  <span class="grid-view-title">{{ article.title }}</span>
                  <span class="list-view-title">{{ article.title | truncate: 40, '...' }}</span>
                </h3>
                <p class="featured-blog-card-desc">
                  {{ article.excerpt | strip_html | truncate: 120 }}
                </p>
              </div>
            </a>
            <!-- Separator after each card (only visible in list view) -->
            <div class="list-separator"></div>
          </article>
        {% endfor %}
      {% else %}
        {% comment %} Show placeholder blog articles when no blog is selected {% endcomment %}
        {% for i in (1..3) %}
          {%- assign placeholder_image = 'collection-1' -%}
          <article
            aria-labelledby="placeholder-article-title-{{ forloop.index0 }}"
            class="blog-article-fb"
            style="opacity: 1; transform: translateY(0);"
          >
            <a
              href="#"
              class="featured-blog-card"
              aria-describedby="placeholder-article-date-{{ forloop.index0 }}"
            >
              <div class="featured-blog-card-image-wrapper">
                {{ placeholder_image | placeholder_svg_tag: 'featured-blog-card-image' }}
              </div>
              <div class="featured-blog-card-content">
                <time
                  class="featured-blog-card-date"
                  id="placeholder-article-date-{{ forloop.index0 }}"
                  datetime="2024-01-01"
                  style="position: relative; padding: var(--space-3xl) 0; color: var(--text); white-space: nowrap; margin: 0; font-size: var(--t-b-2-size); font-weight: var(--t-b-2-weight); line-height: var(--t-b-2-line-height);"
                >
                  01.01.24
                </time>
                <h3
                  class="featured-blog-card-title"
                  id="placeholder-article-title-{{ forloop.index0 }}"
                  style="line-height: 1; font-size: var(--t-h-4-size); font-weight: var(--t-h-4-weight); line-height: var(--t-h-4-line-height); font-family: var(--font-subheading-family); font-style: var(--font-subheading-style); text-transform: uppercase;"
                >
                  <div
                    class="fb-arrow-svg-wrapper object-contain transition-transform duration-300 group-hover:-rotate-90 featured-blog-card-title-arrow inline-block align-baseline"
                    alt="Dropdown Icon"
                  >
                    <svg
                      class="fb-arrow-svg w-5 h-5 object-contain transition-transform duration-200 ease-in-out group-hover:-rotate-90 mx-1"
                      viewBox="4.5 1.5 8.5 13"
                      fill="currentColor"
                      xmlns="http://www.w3.org/2000/svg"
                      stroke="currentColor"
                      aria-hidden="true"
                    >
                      <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                    </svg>
                  </div>
                  <span class="grid-view-title">SAMPLE BLOG {{ i }}</span>
                  <span class="list-view-title">SAMPLE BLOG {{ i }}</span>
                </h3>
                <p
                  class="featured-blog-card-desc"
                  style="margin: 0; color: var(--text); flex-grow: 1; font-family: var(--font-body-family); font-style: var(--font-body-style); font-size: var(--t-b-2-size); font-weight: var(--t-b-2-weight); line-height: var(--t-b-2-line-height);"
                >
                  This is a sample blog post description that shows how the content will look when you add your own blog
                  articles.
                </p>
              </div>
            </a>
            <!-- Separator after each card (only visible in list view) -->
            <div class="list-separator"></div>
          </article>
        {% endfor %}
      {% endif %}
    </div>
    {% if blog_handle != blank and blogs[blog_handle].articles.size > 3 %}
      <div class="load-more-btn-fb-container">
        {% render 'primary-button',
          button_text: 'LOAD MORE',
          button_url: '',
          button_type: 'button',
          button_id: 'featured-blog-load-more',
          primary_class: 'featured-blog-load-more-btn',
          data_attributes: 'data-articles-per-load="{{ section.settings.post_limit | default: 6 }}"',
          button_font_size: 'var(--t-b-1-size)',
          font_weight: 'var(--t-b-1-weight)',
          button_line_height: 'var(--t-b-1-line-height)',
          mobile_font_size: 'var(--tm-b-2-size)',
          mobile_font_weight: 'var(--t-b-2-weight)',
          mobile_line_height: 'var(--tm-b-2-line-height)'
        %}
        {% comment %}
          <button class="load-more-btn-fb" data-increment="6">
            <div class="load-more-btn-fb-text-container">
              <span class="load-more-btn-fb-text"
                >LOAD MORE
                <svg
                  class="fb-arrow-svg w-5 h-5 object-contain transition-transform duration-200 ease-in-out group-hover:-rotate-90 mx-1"
                  viewBox="4.5 1.5 8.5 13"
                  fill="currentColor"
                  xmlns="http://www.w3.org/2000/svg"
                  stroke="currentColor"
                  aria-hidden="true"
                  width="18"
                  height="16"
                  style="width: 18px; height: 16px; margin-right: -2px;"
                >
                  <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                </svg>
              </span>
              <span class="load-more-btn-fb-text-hover"
                >LOAD MORE
                <svg
                  class="fb-arrow-svg w-5 h-5 object-contain transition-transform duration-200 ease-in-out group-hover:-rotate-90 mx-1"
                  viewBox="4.5 1.5 8.5 13"
                  fill="currentColor"
                  xmlns="http://www.w3.org/2000/svg"
                  stroke="currentColor"
                  aria-hidden="true"
                  width="18"
                  height="16"
                  style="width: 18px; height: 16px; margin-right: -2px;"
                >
                  <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                </svg>
              </span>
            </div>
          </button>
        {% endcomment %}
      </div>
    {% endif %}
  </section>
{% endif %}

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const gridBtn = document.getElementById('gridViewBtn');
    const listBtn = document.getElementById('listViewBtn');
    const sectionEl = document.querySelector('.featured-blog-section');
    const slider = document.querySelector('.toggle-slider');
    const container = document.getElementById('archiveContainer');
    const buttons = [gridBtn, listBtn];
    const loadMoreBtn = document.getElementById('featured-blog-load-more');

    // Featured Blog Fade-Up Animation
    const blogArticles = document.querySelectorAll('.blog-article-fb');

    // Set initial state for all articles
    blogArticles.forEach((article, index) => {
      article.style.opacity = '0';
      article.style.transform = 'translateY(50px)';
      article.style.transition = `opacity 0.8s ease ${index * 0.1}s, transform 0.8s ease ${index * 0.1}s`;
    });

    // Create intersection observer
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            // Trigger fade-up animation
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';

            // Stop observing this element
            observer.unobserve(entry.target);
          }
        });
      },
      {
        rootMargin: '0px 0px -100px 0px',
        threshold: 0.1,
      }
    );

    // Observe all blog articles
    blogArticles.forEach((article) => {
      observer.observe(article);
    });

    // Load more functionality - use specific selector for featured blog section
    const loadMoreContainer = document.querySelector('.featured-blog-section .load-more-btn-fb-container');
    if (loadMoreContainer) {
      const loadMoreBtnInside =
        loadMoreContainer.querySelector('#featured-blog-load-more') ||
        loadMoreContainer.querySelector('button') ||
        loadMoreContainer.querySelector('a');

      const incrementValue = (loadMoreBtnInside && loadMoreBtnInside.dataset.articlesPerLoad) || '6';
      let increment = parseInt(incrementValue, 10);
      // Fallback if increment is NaN
      if (isNaN(increment)) {
        increment = 6;
      }
      const postLimit = parseInt(container.dataset.postLimit || '3', 10);
      let currentlyVisible = postLimit;

      // Add click handler to the parent container to catch all clicks
      loadMoreContainer.addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();

        const blogArticles = document.querySelectorAll('#archiveContainer .blog-article-fb');
        const safeIncrement = isNaN(increment) ? 6 : increment;
        const endIndex = Math.min(currentlyVisible + safeIncrement, blogArticles.length);

        for (let i = currentlyVisible; i < endIndex; i++) {
          if (blogArticles[i]) {
            blogArticles[i].style.display = '';
            // Add fade-up animation for newly shown articles
            blogArticles[i].style.opacity = '0';
            blogArticles[i].style.transform = 'translateY(50px)';
            blogArticles[i].style.transition = `opacity 0.8s ease ${
              (i - currentlyVisible) * 0.1
            }s, transform 0.8s ease ${(i - currentlyVisible) * 0.1}s`;

            // Trigger animation after a short delay
            setTimeout(() => {
              blogArticles[i].style.opacity = '1';
              blogArticles[i].style.transform = 'translateY(0)';
            }, 50);
          }
        }
        currentlyVisible = endIndex;

        if (currentlyVisible >= blogArticles.length) {
          loadMoreContainer.style.display = 'none';
        }
      });

      const updateVisibilityAfterViewChange = () => {
        const blogArticles = document.querySelectorAll('#archiveContainer .blog-article-fb');
        blogArticles.forEach((article, index) => {
          article.style.display = index < currentlyVisible ? '' : 'none';
        });
      };

      if (gridBtn) gridBtn.addEventListener('click', updateVisibilityAfterViewChange);
      if (listBtn) listBtn.addEventListener('click', updateVisibilityAfterViewChange);
    }

    function updateSliderPos(isList) {
      const activeBtn = isList ? listBtn : gridBtn;
      const rect = activeBtn.getBoundingClientRect();
      const parentRect = activeBtn.parentNode.getBoundingClientRect();
      slider.style.width = `${rect.width}px`;
      slider.style.left = `${rect.left - parentRect.left}px`;
    }

    function switchView(toList) {
      buttons.forEach((btn) => {
        const isActive = btn === (toList ? listBtn : gridBtn);
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-checked', isActive.toString());
      });
      container.style.opacity = 0;
      setTimeout(() => {
        container.classList.toggle('list-view', toList);
        container.classList.toggle('grid-view', !toList);
        sectionEl.classList.toggle('list-view', toList);
        updateSliderPos(toList);
        container.style.opacity = 1;
      }, 300);
    }

    updateSliderPos(false);
    gridBtn.addEventListener('click', () => switchView(false));
    listBtn.addEventListener('click', () => switchView(true));

    buttons.forEach((btn) => {
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
          e.preventDefault();
          const currentIndex = buttons.indexOf(e.target);
          const nextIndex =
            e.key === 'ArrowRight'
              ? (currentIndex + 1) % buttons.length
              : (currentIndex - 1 + buttons.length) % buttons.length;
          buttons[nextIndex].focus();
          switchView(nextIndex === 1);
        }
      });
    });

    window.addEventListener('resize', () => updateSliderPos(sectionEl.classList.contains('list-view')));
  });
</script>

{% schema %}
{
  "name": "Featured Blogs",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "tag": "section",
  "class": "my-custom-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enabled",
      "label": "Enable section",
      "default": true
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Main Heading",
      "default": "Featured Blogs"
    },
    {
      "type": "blog",
      "id": "blog",
      "label": "Select Blog"
    },
    {
      "type": "range",
      "id": "post_limit",
      "label": "Posts to Load Per Click",
      "info": "Number of additional posts to show when 'Load More' is clicked. Initial display is always 3 posts.",
      "default": 6,
      "min": 1,
      "max": 20,
      "step": 1
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "Featured Blogs",
      "settings": {
        "enabled": true,
        "heading": "Featured Blogs",
        "post_limit": 6
      }
    }
  ]
}
{% endschema %}
