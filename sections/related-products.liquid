{{ 'section-related-products.css' | asset_url | stylesheet_tag }}

{%- if section.settings.enable_animations -%}
  {{ 'scroll-animations.css' | asset_url | stylesheet_tag }}
  <script src="{{ 'scroll-animations.js' | asset_url }}" defer></script>
{%- endif -%}

{% comment %}
  Related Products Section using Shopify Product Recommendations API
  Must be rendered on a product page template
{% endcomment %}

<product-recommendations
  class="product-recommendations"
  data-url="{{ routes.product_recommendations_url }}?section_id={{ section.id }}&product_id={{ product.id }}&limit={{ section.settings.products_to_show }}&intent=related"
  data-product-id="{{ product.id }}"
>
  {% if recommendations.performed and recommendations.products_count > 0 %}
    {% assign top_padding = section.settings.padding_top %}
    {% assign side_padding = settings.side_space %}

    {% if top_padding == blank or top_padding == 0 %}
      {% assign top_padding = 36 %}
    {% endif %}

    {% if side_padding == blank or side_padding == 0 %}
      {% assign side_padding = 20 %}
    {% endif %}

    <div
      class="related-products-page-width related-products-section overflow-hidden color-{{ section.settings.color_scheme }} gradient"
      role="region"
      aria-labelledby="related-products-heading"
      style="padding: {{ top_padding }}px {{ side_padding }}px {{ section.settings.padding_bottom }}px;"
    >
      {%- if section.settings.heading != blank -%}
        <h2
          id="related-products-heading"
          class="related-products-main-heading mb-[-10px]"
        >
          {{ section.settings.heading }}
        </h2>
      {%- endif -%}

      {%- comment -%} Accessibility: Live region for screen readers {%- endcomment -%}
      <div class="visually-hidden" role="status" aria-live="polite" aria-atomic="true"></div>

      <main
        class="related-products-container w-full mt-10 color-{{ section.settings.color_scheme }}"
        style="margin-top:18px;"
      >
        <div class="slider-container relative">
          <div
            id="related-products-slider"
            class="product-slider related-products-grid {% if section.settings.enable_animations %}scroll-fade-stagger{% endif %} flex gap-2 md:gap-4 custom-scrollbar featured-collection-cursor-grab overflow-x-auto"
            role="list"
            aria-labelledby="related-products-heading"
          >
            {% for recommendation in recommendations.products %}
              <div
                class="flex-none related-products-item {% if section.settings.enable_animations %}scroll-fade-trigger scroll-fade-up{% endif %}"
                {% if section.settings.enable_animations %}
                  data-animation-index="{{ forloop.index0 }}"
                {% endif %}
              >
                {% render 'new-product-card',
                  product: recommendation,
                  card_color_scheme: section.settings.color_scheme
                %}
              </div>
            {% endfor %}
          </div>

          <!-- Horizontal scrollbar using snippet -->
          {% render 'horizontal-scrollbar',
            container_selector: '.slider-container',
            slider_selector: '.product-slider'
          %}
        </div>
      </main>
    </div>
  {% endif %}
</product-recommendations>

{%- comment -%} External scripts - loaded once and cached {%- endcomment -%}
<script src="{{ 'related-products.js' | asset_url }}" defer></script>
<script src="{{ 'featured-collection.js' | asset_url }}" defer></script>
<script src="{{ 'new-product-card.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Related Products",
  "tag": "section",
  "class": "section",
  "enabled_on": {
    "templates": ["product"]
  },
  "settings": [
    {
      "type": "paragraph",
      "content": "t:sections.related-products.settings.paragraph__1.content"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "You may also like",
      "label": "t:sections.related-products.settings.heading.label"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 10,
      "step": 1,
      "default": 4,
      "label": "t:sections.related-products.settings.products_to_show.label"
    },
    {
      "type": "header",
      "content": "Design"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "checkbox",
      "id": "enable_animations",
      "label": "Enable scroll animations",
      "default": true,
      "info": "Animate products as they scroll into view. Respects user's motion preferences."
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ]
}
{% endschema %}
