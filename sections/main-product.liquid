{{ 'main-product.css' | asset_url | stylesheet_tag }}
<script src="{{ 'global.js' | asset_url }}" defer></script>

<style>
  .section-{{ section.id }}-padding {
    padding-top: var(--sections-spacing-top);
    padding-bottom: var(--sections-spacing-bottom);
  }
</style>

<!-- JavaScript data for main-product.js -->
<script>
  window.SHOP_CURRENCY = {{ shop.currency | json }};
  window.MONEY_FORMAT = {{ shop.money_format | json }};
  window.PRODUCT_OPTIONS = {{ product.options | json }};
  window.PRODUCT_VARIANTS = {{ product.variants | json }};
  window.CART_TYPE = {{ settings.cart_type | default: "page" | json }};
</script>
<script src="{{ 'main-product.js' | asset_url }}" defer></script>

<!-- 3D Model Viewer Support - Using Shopify's Official CDN -->
<script
  type="module"
  src="https://cdn.shopify.com/shopifycloud/model-viewer-ui/assets/v1.0/model-viewer-ui.en.js"
></script>
<link
  rel="stylesheet"
  href="https://cdn.shopify.com/shopifycloud/model-viewer-ui/assets/v1.0/model-viewer-ui.css"
>
<style>
  .product-model-viewer {
    width: 100%;
    height: 100%;
  }
  model-viewer {
    width: 100%;
    height: 100%;
    --poster-color: transparent;
  }
  .model-viewer-icon {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 32px;
    height: 32px;
    z-index: 10;
  }

  /* Mobile-specific 3D model styles */
  @media (max-width: 768px) {
    .product-model-viewer {
      min-height: 300px;
      position: relative;
    }
    model-viewer {
      --poster-color: #f5f5f5;
      background-color: #f5f5f5;
      touch-action: manipulation;
      width: 100% !important;
      height: 100% !important;
      min-height: 300px;
    }
    .model-viewer-icon {
      width: 24px;
      height: 24px;
      top: 8px;
      right: 8px;
    }

    /* Ensure mobile gallery items with 3D models display properly */
    .mobile-gallery-item {
      position: relative;
    }

    .mobile-gallery-item model-viewer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
  }

  /* Ensure model viewer loads on mobile */
  model-viewer {
    --poster-color: transparent;
    --progress-bar-color: #000;
    --progress-mask: #fff;
  }

  /* Preserve 3D model state during scroll transitions */
  .gallery-item model-viewer {
    transition: none !important;
    transform: none !important;
  }

  /* Prevent 3D model zoom reset on scroll */
  .gallery-item.is-active model-viewer {
    will-change: auto;
  }
</style>

<!-- Mobile 3D Model Initialization Script -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Initialize model viewers on mobile
    const modelViewers = document.querySelectorAll('model-viewer');

    modelViewers.forEach(function (viewer) {
      // Add mobile-specific attributes
      viewer.setAttribute('touch-action', 'manipulation');
      viewer.setAttribute('interaction-prompt-threshold', '0');
    });
  });
</script>

<!-- Desktop Product Section -->
{% render 'product-section-desktop', product: product, section: section %}

<!-- Mobile Product Section -->
{% render 'product-section-mobile', product: product, section: section %}

{%- comment -%} Sticky Add-to-Cart Bar Block {%- endcomment -%}
{%- for block in section.blocks -%}
  {%- case block.type -%}
    {%- when 'sticky_atc_bar' -%}
      {% render 'sticky-atc-bar',
        product: product,
        selected_variant: product.selected_or_first_available_variant,
        block: block
      %}
  {%- endcase -%}
{%- endfor -%}

{% schema %}
{
  "name": "Product Details",
  "tag": "section",
  "class": "section",
  "enabled_on": {
    "templates": ["product"]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1"
    },
    {
      "type": "select",
      "id": "product_name_font_weight",
      "label": "Product Name",
      "info": "Font Weight",
      "options": [
        {
          "value": "300",
          "label": "Light"
        },
        {
          "value": "400",
          "label": "Normal"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semi Bold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ],
      "default": "400"
    },
    {
      "type": "select",
      "id": "product_price_font_weight",
      "label": "Product Price",
      "info": "Font Weight",
      "options": [
        {
          "value": "300",
          "label": "Light"
        },
        {
          "value": "400",
          "label": "Normal"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semi Bold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ],
      "default": "400"
    }
  ],
  "blocks": [
    {
      "type": "tab_description",
      "name": "Tab: Description",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Tab Title",
          "default": "DESCRIPTION"
        }
      ]
    },
    {
      "type": "tab_details",
      "name": "Tab: Details",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Tab Title",
          "default": "DETAILS"
        },
        {
          "type": "richtext",
          "id": "metafield_namespace_key",
          "label": "Product Details",
          "info": "Add rich text content or connect to a dynamic source for product details."
        }
      ]
    },
    {
      "type": "tab_sizing",
      "name": "Tab: Sizing",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Tab Title",
          "default": "SIZING"
        },
        {
          "type": "header",
          "content": "Sizing Item 1"
        },
        {
          "type": "image_picker",
          "id": "item1_icon",
          "label": "Icon 1",
          "info": "Upload an icon (40x40px recommended)"
        },
        {
          "type": "text",
          "id": "item1_title",
          "label": "Title 1",
          "default": "Size Guide",
          "info": "Text displayed below the icon"
        },
        {
          "type": "page",
          "id": "item1_content_page",
          "label": "Content Page 1",
          "info": "Select a page to display when this item is clicked"
        },
        {
          "type": "header",
          "content": "Sizing Item 2"
        },
        {
          "type": "image_picker",
          "id": "item2_icon",
          "label": "Icon 2",
          "info": "Upload an icon (40x40px recommended)"
        },
        {
          "type": "text",
          "id": "item2_title",
          "label": "Title 2",
          "default": "Fit Guide",
          "info": "Text displayed below the icon"
        },
        {
          "type": "page",
          "id": "item2_content_page",
          "label": "Content Page 2",
          "info": "Select a page to display when this item is clicked"
        },
        {
          "type": "header",
          "content": "Sizing Item 3"
        },
        {
          "type": "image_picker",
          "id": "item3_icon",
          "label": "Icon 3",
          "info": "Upload an icon (40x40px recommended)"
        },
        {
          "type": "text",
          "id": "item3_title",
          "label": "Title 3",
          "default": "Care Guide",
          "info": "Text displayed below the icon"
        },
        {
          "type": "page",
          "id": "item3_content_page",
          "label": "Content Page 3",
          "info": "Select a page to display when this item is clicked"
        }
      ]
    },
    {
      "type": "delivery_address",
      "name": "Delivery Address",
      "limit": 1,
      "settings": []
    },
    {
      "type": "quantity_selector",
      "name": "Quantity Selector",
      "limit": 1,
      "settings": []
    },
    {
      "type": "pickup_availability",
      "name": "Pickup Availability",
      "limit": 1,
      "settings": []
    },
    {
      "type": "sticky_atc_bar",
      "name": "Sticky Add to Cart Bar",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "Display a sticky add-to-cart bar at the bottom of the screen when the main add-to-cart button scrolls out of view."
        },
        {
          "type": "checkbox",
          "id": "enable_sticky_bar",
          "label": "Enable Sticky Add to Cart Bar",
          "default": true
        },
        {
          "type": "color_scheme",
          "id": "sticky_bar_color_scheme",
          "label": "Color Scheme",
          "default": "scheme-1",
          "info": "Choose color scheme for the sticky bar"
        }
      ]
    }
  ]
}
{% endschema %}

<script src="{{ 'pickup-availability.js' | asset_url }}" defer></script>
