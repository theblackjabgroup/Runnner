{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .media-section-{{ section.id }} {
    height: {{ section.settings.height }}px;
  }

  .heading-size-small {
    font-size: 1.5rem; /* 24px */
    line-height: 2rem; /* 32px */
    font-weight: 700;
  }
  
  @media (min-width: 768px) {
    .heading-size-small {
      font-size: 1.875rem; /* 30px */
      line-height: 2.25rem; /* 36px */
    }
  }
  
  .heading-size-medium {
    font-size: 1.875rem; /* 30px */
    line-height: 2.25rem; /* 36px */
    font-weight: 700;
  }
  
  @media (min-width: 768px) {
    .heading-size-medium {
      font-size: 2.25rem; /* 36px */
      line-height: 2.5rem; /* 40px */
    }
  }
  
  .heading-size-large {
    font-size: 2.25rem; /* 36px */
    line-height: 2.5rem; /* 40px */
    font-weight: 700;
  }
  
  @media (min-width: 768px) {
    .heading-size-large {
      font-size: 3rem; /* 48px */
      line-height: 1;
    }
  }
{%- endstyle -%}

<div class="media-section-{{ section.id }} relative w-full overflow-hidden" style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;">
  <!-- Media Container (Background) -->
  {% if section.settings.use_video and section.settings.video_url != blank %}
    <div class="absolute inset-0 w-full h-full">
      {% if section.settings.video_url.type == "youtube" %}
        <iframe 
          class="w-full h-full object-cover"
          src="https://www.youtube.com/embed/{{ section.settings.video_url.id }}?autoplay=1&controls=0&mute=1&loop=1&playlist={{ section.settings.video_url.id }}&playsinline=1&rel=0&enablejsapi=1"
          frameborder="0"
          allow="autoplay; encrypted-media"
          allowfullscreen
        ></iframe>
      {% elsif section.settings.video_url.type == "vimeo" %}
        <iframe 
          class="w-full h-full object-cover"
          src="https://player.vimeo.com/video/{{ section.settings.video_url.id }}?background=1&autoplay=1&loop=1&byline=0&title=0"
          frameborder="0"
          allow="autoplay; encrypted-media"
          allowfullscreen
        ></iframe>
      {% endif %}
    </div>
  {% elsif section.settings.image != blank %}
    <div class="absolute inset-0 w-full h-full">
      {%- assign img_url = section.settings.image | img_url: 'master' -%}
      <img
        src="{{ img_url }}"
        alt="{{ section.settings.image.alt | escape }}"
        class="w-full h-full object-cover"
        loading="lazy"
      >
    </div>
  {% else %}
    <div class="absolute inset-0 w-full h-full bg-gray-200 flex items-center justify-center">
      {{ 'image' | placeholder_svg_tag: 'w-1/2 h-auto opacity-30' }}
    </div>
  {% endif %}
  
  <!-- Overlay -->
  {% if section.settings.overlay_opacity > 0 %}
    <div class="absolute inset-0 bg-black" style="opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }};"></div>
  {% endif %}

  <!-- Content Container -->
  <div class="absolute inset-0 flex flex-col items-center justify-between p-4 md:p-8 z-10">
    <div class="text-content text-center max-w-xl mt-8 md:mt-16">
      {% if section.settings.show_caption and section.settings.caption != blank %}
        <p class="caption mb-2 {{ section.settings.caption_style }}" style="color: {{ section.settings.text_color }};">
          {{ section.settings.caption | escape }}
        </p>
      {% endif %}
      
      {% if section.settings.show_heading and section.settings.heading != blank %}
        {% assign heading_class = '' %}
        {% if section.settings.heading_size == 'text-2xl md:text-3xl font-bold' %}
          {% assign heading_class = 'heading-size-small' %}
        {% elsif section.settings.heading_size == 'text-3xl md:text-4xl font-bold' %}
          {% assign heading_class = 'heading-size-medium' %}
        {% elsif section.settings.heading_size == 'text-4xl md:text-5xl font-bold' %}
          {% assign heading_class = 'heading-size-large' %}
        {% endif %}
        
        <h2 class="heading mb-4 {{ heading_class }}" style="color: {{ section.settings.text_color }};">
          {{ section.settings.heading }}
        </h2>
      {% endif %}
      
      {% if section.settings.show_text and section.settings.text != blank %}
        <div class="text-content" style="color: {{ section.settings.text_color }};">
          {{ section.settings.text }}
        </div>
      {% endif %}
    </div>
    
    <div class="button-container text-center mb-8 md:mb-16">
      {% if section.settings.show_button and section.settings.button_label != blank %}
        <a 
          href="{{ section.settings.button_link | default: '#' }}"
          class="button inline-block px-6 py-3 transition-colors duration-300 rounded"
          style="background-color: {{ section.settings.button_bg_color }}; color: {{ section.settings.button_text_color }};"
          onmouseover="this.style.backgroundColor='{{ section.settings.button_bg_hover_color }}'"
          onmouseout="this.style.backgroundColor='{{ section.settings.button_bg_color }}'"
        >
          {{ section.settings.button_label | escape }}
        </a>
      {% endif %}
    </div>
  </div>
</div>

{% javascript %}
document.addEventListener('DOMContentLoaded', function() {
  // Ensure the container height matches the settings
  const container = document.querySelector('.media-section-{{ section.id }}');
  if (container) {
    container.style.height = '{{ section.settings.height }}px';
  }
  
  // Lazy load images
  if (window.lazyLoadInstance) {
    window.lazyLoadInstance.update();
  }
});
{% endjavascript %}

{% schema %}
{
  "name": "Image with Text",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Media Settings"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "checkbox",
      "id": "use_video",
      "label": "Use video instead of image",
      "default": false
    },
    {
      "type": "video_url",
      "id": "video_url",
      "label": "Video URL",
      "accept": ["youtube", "vimeo"],
      "info": "YouTube or Vimeo URL"
    },
    {
      "type": "header",
      "content": "Text Content"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#FFFFFF"
    },
    {
      "type": "checkbox",
      "id": "show_caption",
      "label": "Show caption",
      "default": true
    },
    {
      "type": "text",
      "id": "caption",
      "label": "Caption text",
      "default": "Caption"
    },
    {
      "type": "select",
      "id": "caption_style",
      "label": "Caption style",
      "options": [
        {
          "value": "uppercase tracking-widest text-sm",
          "label": "Small with letter spacing"
        },
        {
          "value": "italic text-base",
          "label": "Italic"
        },
        {
          "value": "font-bold text-base",
          "label": "Bold"
        }
      ],
      "default": "uppercase tracking-widest text-sm"
    },
    {
      "type": "checkbox",
      "id": "show_heading",
      "label": "Show heading",
      "default": true
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Section Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "options": [
        {
          "value": "text-2xl md:text-3xl font-bold",
          "label": "Small"
        },
        {
          "value": "text-3xl md:text-4xl font-bold",
          "label": "Medium"
        },
        {
          "value": "text-4xl md:text-5xl font-bold",
          "label": "Large"
        }
      ],
      "default": "text-3xl md:text-4xl font-bold"
    },
    {
      "type": "checkbox",
      "id": "show_text",
      "label": "Show text",
      "default": true
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Text",
      "default": "<p>Add your description or promotional text here to accompany your featured image or video.</p>"
    },
    {
      "type": "header",
      "content": "Button Settings"
    },
    {
      "type": "checkbox",
      "id": "show_button",
      "label": "Show button",
      "default": true
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label",
      "default": "Explore Now"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Button Background Color",
      "default": "#4F46E5"
    },
    {
      "type": "color",
      "id": "button_bg_hover_color",
      "label": "Button Hover Background Color",
      "default": "#4338CA"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#FFFFFF"
    },
    {
      "type": "header",
      "content": "Section Size"
    },
    {
      "type": "range",
      "id": "height",
      "min": 300,
      "max": 800,
      "step": 50,
      "unit": "px",
      "label": "Section height",
      "default": 500
    }
  ],
  "presets": [
    {
      "name": "Image with Text",
      "category": "Image",
      "settings": {
        "heading": "Section Heading",
        "text": "<p>Add your description or promotional text here.</p>",
        "button_label": "Explore Now",
        "text_color": "#FFFFFF",
        "button_bg_color": "#4F46E5",
        "button_text_color": "#FFFFFF"
      }
    }
  ]
}
{% endschema %}
