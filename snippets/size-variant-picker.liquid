{% comment %}
  Unified Size Variant Picker Snippet
  Works for both mobile and desktop with responsive styling
  Usage: {% render 'size-variant-picker', product: product, mobile: true/false, show_label: true/false %}
{% endcomment %}

{%- liquid
  assign variant_option = null
  assign variant_option_index = null

  for option in product.options_with_values
    if option.name == 'Size' or option.name == 'size'
      assign variant_option = option
      assign variant_option_index = forloop.index0
      break
    endif
  endfor
-%}

{% if variant_option %}
  {% if mobile %}
    <!-- Mobile Version -->
    <fieldset class="flex justify-between items-center gap-2" style="padding: 10px 0;" role="group">
      <legend style="font-size: var(--tm-b-4-size); line-height: var(--tm-b-4-line-height);">
        SELECT {{ variant_option.name | upcase }}
      </legend>
      <div class="flex gap-2 flex-wrap" role="radiogroup" aria-labelledby="mobile-size-legend">
        <span id="mobile-size-legend" class="sr-only">{{ variant_option.name }} options</span>
        {% for value in variant_option.values %}
          {% assign variant_available = false %}
          {% assign variant_id = null %}
          {% for variant in product.variants %}
            {% assign option_key = 'option' | append: variant_option_index | plus: 1 %}
            {% if variant[option_key] == value %}
              {% if variant.available %}
                {% assign variant_available = true %}
                {% assign variant_id = variant.id %}
                {% break %}
              {% endif %}
            {% endif %}
          {% endfor %}
          <button
            type="button"
            class="
              size-btn relative px-3 h-10 min-w-[2.5rem] flex items-center justify-center border-transparent rounded border
              focus:outline-none focus:ring-2 focus:ring-blue-500
              {% if forloop.first and variant_available %}bg-black text-white{% endif %}
              {% unless variant_available %} cursor-not-allowed unavailable-size{% endunless %}
            "
            data-option-index="{{ variant_option_index }}"
            data-value="{{ value | escape }}"
            role="radio"
            aria-checked="{% if forloop.first and variant_available %}true{% else %}false{% endif %}"
            {% if variant_available %}
              data-variant-id="{{ variant_id }}"
              tabindex="{% if forloop.first %}0{% else %}-1{% endif %}"
            {% else %}
              disabled aria-disabled="true"
              tabindex="-1"
            {% endif %}
            aria-label="{{ variant_option.name }} {{ value }}{% unless variant_available %} - Sold out{% endunless %}"
          >
            <span class="label">{{ value }}</span>
            {% unless variant_available %}
              <span class="slash-unavailable" aria-hidden="true"></span>
            {% endunless %}
          </button>
        {% endfor %}
      </div>
    </fieldset>
  {% else %}
    <!-- Desktop Version -->
    <div class="flex justify-between items-center gap-2">
      {% if show_label != false %}
        <span class="uppercase">SELECT {{ variant_option.name | upcase }}</span>
      {% endif %}
      <div class="flex gap-2 flex-wrap">
        {% for value in variant_option.values %}
          {% assign variant_available = false %}
          {% assign variant_id = null %}
          {% for variant in product.variants %}
            {% assign option_key = 'option' | append: variant_option_index | plus: 1 %}
            {% if variant[option_key] == value %}
              {% if variant.available %}
                {% assign variant_available = true %}
                {% assign variant_id = variant.id %}
                {% break %}
              {% endif %}
            {% endif %}
          {% endfor %}
          <button
            type="button"
            class="
              size-btn relative px-3 h-10 min-w-[2.5rem] flex items-center justify-center border-transparent border
              {% if forloop.first and variant_available %}bg-black text-white{% endif %}
              {% unless variant_available %}cursor-not-allowed unavailable-size{% endunless %}
            "
            data-option-index="{{ variant_option_index }}"
            data-value="{{ value | escape }}"
            {% if variant_available %}
              data-variant-id="{{ variant_id }}"
            {% else %}
              disabled aria-disabled="true"
            {% endif %}
            aria-label="{{ variant_option.name }} {{ value }}{% unless variant_available %} - Sold out{% endunless %}"
          >
            <span class="label">{{ value }}</span>
            {% unless variant_available %}
              <span class="slash-unavailable"></span>
            {% endunless %}
          </button>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% else %}
  <!-- Default title when no size option exists -->
  {% if mobile %}
    <div class="flex justify-between items-center gap-2" style="padding: 10px 0;">
      <span style="font-size: var(--tm-b-4-size); line-height: var(--tm-b-4-line-height);"> SELECT OPTION </span>
    </div>
  {% else %}
    <div class="flex justify-between items-center gap-2">
      <span class="uppercase">SELECT OPTION</span>
    </div>
  {% endif %}
{% endif %}

<style>
  .size-btn {
    border-radius: 5px;
    transition: all 0.3s ease;
    background-color: var(--button);
    color: var(--button_label);
    border: 1px solid var(--disabled_text);
  }

  .size-btn:not(:disabled):hover,
  .size-btn.bg-black {
    background-color: var(--hovered_button_label);
    color: var(--hovered_button_text_color);
  }

  .size-btn:disabled {
    opacity: 0.8;
    cursor: not-allowed;
    border: 1px solid var(--disabled_text);
  }

  .size-btn.unavailable-size {
    opacity: 1;
    visibility: visible;
    position: relative;
    cursor: not-allowed;
    color: var(--text) !important;
    border-color: var(--disabled_text) !important;
    background-color: var(--disabled_text) !important;
    overflow: hidden;
    transform: translateY(0);
  }

  .size-btn.unavailable-size:hover {
    background-color: var(--disabled_text) !important;
    transform: translateY(0);
  }

  .size-btn.unavailable-size::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background-color: var(--text);
    transform: rotate(-42deg) translateY(-50%);
    transform-origin: center;
    pointer-events: none;
    width: 125%;
  }

  .slash-unavailable {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background-color: var(--text);
    transform: rotate(-42deg) translateY(-50%);
    transform-origin: center;
    pointer-events: none;
    z-index: 10;
    width: 125%;
  }

  .size-btn.unavailable-size:hover .slash-unavailable {
    background-color: var(--text) !important;
    opacity: 1 !important;
    visibility: visible !important;
  }
</style>
