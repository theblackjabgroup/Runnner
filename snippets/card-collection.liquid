{% comment %}
  Renders a collection card

  Accepts:
  - card_collection: {Object} Collection Liquid object
  - media_aspect_ratio: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
  - columns: {Number}
  - extend_height: {Boolean} Card height extends to available container space. Default: false (optional)
  - wrapper_class: {String} Wrapper class for card (optional)
  - placeholder_image: {String} Placeholder image when collection is empty (optional)

  Usage:
  {% render 'card-collection' %}
{% endcomment %}

{%- liquid
  assign ratio = 1
  if card_collection.featured_image and media_aspect_ratio == 'portrait'
    assign ratio = 1
  elsif card_collection.featured_image and media_aspect_ratio == 'adapt'
    assign ratio = card_collection.featured_image.aspect_ratio
  endif
  if ratio == 0 or ratio == null
    assign ratio = 1
  endif
  assign card_color_scheme = settings.card_color_scheme
  assign card_style = settings.card_style
  if wrapper_class == null or wrapper_class == 'none'
    assign card_color_scheme = settings.collection_card_color_scheme
    assign card_style = settings.collection_card_style
  endif
-%}

{%- if card_collection != blank -%}
  <div class="card-wrapper product-card-wrapper group">
    <a href="{{ card_collection.url }}" class="block w-full" style="text-decoration: none; color: inherit;">
      <div
        class="relative w-full product-card-height transition-all duration-300 overflow-hidden"
        style="background-color: var(--background);"
      >
        {%- if card_collection.featured_image -%}
          <img
            srcset="
              {%- if card_collection.featured_image.width >= 360 -%}{{ card_collection.featured_image | image_url: width: 360 }} 360w,{%- endif -%}
              {%- if card_collection.featured_image.width >= 533 -%}{{ card_collection.featured_image | image_url: width: 533 }} 533w,{%- endif -%}
              {%- if card_collection.featured_image.width >= 720 -%}{{ card_collection.featured_image | image_url: width: 720 }} 720w,{%- endif -%}
              {%- if card_collection.featured_image.width >= 940 -%}{{ card_collection.featured_image | image_url: width: 940 }} 940w,{%- endif -%}
              {%- if card_collection.featured_image.width >= 1066 -%}{{ card_collection.featured_image | image_url: width: 1066 }} 1066w,{%- endif -%}
              {%- if card_collection.featured_image.width >= 1200 -%}{{ card_collection.featured_image | image_url: width: 1200 }} 1200w,{%- endif -%}
              {%- if card_collection.featured_image.width >= 1500 -%}{{ card_collection.featured_image | image_url: width: 1500 }} 1500w,{%- endif -%}
              {%- if card_collection.featured_image.width >= 1800 -%}{{ card_collection.featured_image | image_url: width: 1800 }} 1800w,{%- endif -%}
              {{ card_collection.featured_image | image_url }} {{ card_collection.featured_image.width }}w
            "
            src="{{ card_collection.featured_image | image_url: width: 1200 }}"
            sizes="
              (min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 100 | divided_by: columns }}px,
              (min-width: 750px) {% if columns > 1 %}calc((100vw - 10rem) / 2){% else %}calc(100vw - 10rem){% endif %},
              calc(100vw - 3rem)
            "
            alt="{{ card_collection.featured_image.alt | escape }}"
            height="{{ card_collection.featured_image.height }}"
            width="{{ card_collection.featured_image.width }}"
            loading="lazy"
            style=" width: 100%; height: 100%; position: absolute; top: 0; left: 0;"
          >
        {%- else -%}
          <div
            class="w-full h-full flex items-center justify-center"
            style="height: 100%; background-color: var(--background);"
          >
            {{ placeholder_image | placeholder_svg_tag: 'placeholder-svg' }}
          </div>
        {%- endif -%}
      </div>
      <div class="mt-3 space-y-1">
        <h3
          class="card-product-typegraphy product-card-text uppercase font-medium leading-tight"
          style="color: var(--text);"
        >
          {{ card_collection.title | escape | default: 'Collection Title' }}
        </h3>
        {%- if card_collection.description != blank -%}
          <div class="gap-2 items-baseline leading-tight">
            <span
              class="card-product-typegraphy product-card-text"
              style="color: var(--text);"
            >
              {{ card_collection.description | strip_html | truncatewords: 12 }}
            </span>
          </div>
        {%- endif -%}
      </div>
    </a>
  </div>
{%- else -%}
  <div class="card-wrapper product-card-wrapper group">
    <div class="block w-full">
      <div
        class="relative w-full product-card-height transition-all duration-300 overflow-hidden"
        style="background-color: var(--background);"
      >
        <div
          class="w-full h-full flex items-center justify-center"
          style="height: 100%; background-color: var(--background);"
        >
          {{ placeholder_image | placeholder_svg_tag: 'placeholder-svg' }}
        </div>
      </div>
      <div class="mt-3 space-y-1">
        <h3
          class="card-product-typegraphy product-card-text uppercase font-medium leading-tight"
          style="color: var(--text);"
        >
          {{ 'onboarding.collection_title' | t }}
        </h3>
      </div>
    </div>
  </div>
{%- endif -%}

<style>
  .card-product-typegraphy {
    font-size: 14px !important;
  }
  .product-card-height {
    height: 410px;
    transition: height 0.3s;
    width: 100%;
    max-width: 100%;
    background: var(--background);
    position: relative;
    overflow: hidden;
  }

  @media screen and (max-width: 1300px) and (min-width: 750px) {
    .product-card-height {
      height: 540px;
      transition: height 0.3s;
    }
  }

  @media only screen and (max-width: 600px) {
    .product-card-height {
      height: 400px;
      transition: height 0.3s;
    }
    .product-card-text {
      font-size: 12px;
    }
  }

  .product-card-height img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    transition: opacity 0.3s;
    background: transparent;
    display: block;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    min-width: 100%;
    min-height: 100%;
  }
</style>
