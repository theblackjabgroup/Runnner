{% comment %}
  Renders cart drawer

  Usage:
  {% render 'cart-drawer' %}
{% endcomment %}

{{ 'quantity-popover.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'cart-drawer.css' | asset_url | stylesheet_tag }}

<script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'quantity-popover.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'cart-drawer-custom.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'cart-drawer-color-swatch.js' | asset_url }}" defer="defer"></script>

<style>
  :root {
    --scroll-speed: {{ settings.scroll_speed | default: 10 }}s;
  }

  .vertical-text-cart-drawer .separator-image {
    transform: rotate({{ settings.vertical_scroll_image_rotation | default: 0 | plus: 90 }}deg);
    -webkit-transform: rotate({{ settings.vertical_scroll_image_rotation | default: 0 | plus: 90 }}deg);
    -moz-transform: rotate({{ settings.vertical_scroll_image_rotation | default: 0 | plus: 90 }}deg);
    -ms-transform: rotate({{ settings.vertical_scroll_image_rotation | default: 0 | plus: 90 }}deg);
  }

  @media only screen and (max-width: 600px) {
    .vertical-text-cart-drawer .separator-image {
      transform: rotate({{ settings.vertical_scroll_image_rotation | default: 0 | plus: 90 }}deg);
      -webkit-transform: rotate({{ settings.vertical_scroll_image_rotation | default: 0 | plus: 90 }}deg);
      -moz-transform: rotate({{ settings.vertical_scroll_image_rotation | default: 0 | plus: 90 }}deg);
      -ms-transform: rotate({{ settings.vertical_scroll_image_rotation | default: 0 | plus: 90 }}deg);
    }
  }
</style>

<script>
  // Make cart items data available to external scripts
  window.cartItemsData = {{ cart.items | json }};
</script>

<cart-drawer class="drawer {% if cart == empty %} is-empty{% endif %}">
  <div id="CartDrawer" class="cart-drawer">
    <div id="CartDrawer-Overlay" class="cart-drawer__overlay"></div>
    <div
      class="drawer__inner !h-[100vh] !pl-[30px] md:!pl-[50px] md:!w-[52vw] !w-[90vw] gradient color-{{ settings.cart_color_scheme }}"
      style="padding-inline-start: var(--space-6xl);"
      role="dialog"
      aria-modal="true"
      aria-label="{{ 'sections.cart.title' | t }}"
      tabindex="-1"
    >
      <div class="vertical-text-cart-drawer-container">
        <div class="vertical-text-cart-drawer">
          {% if settings.vertical_scroll_image %}
            {% assign text_parts = settings.vertical_scroll_text | split: '→' %}
            {% for i in (1..10) %}
              {% for part in text_parts %}
                {{ part | strip }}
                {% unless forloop.last %}
                  <img
                    src="{{ settings.vertical_scroll_image | image_url: width: 40 }}"
                    alt="Separator"
                    class="separator-image"
                    width="100"
                    height="100"
                  >
                {% endunless %}
              {% endfor %}
            {% endfor %}
          {% else %}
            {% assign text_parts = settings.vertical_scroll_text | split: '→' %}
            {% for i in (1..10) %}
              {% for part in text_parts %}
                {{ part | strip }}
                {% unless forloop.last %}
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    fill="var(--text)"
                    viewBox="0 0 256 256"
                    class="separator-image"
                  >
                    <path d="M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.65a16,16,0,0,1-16.2.3A15.86,15.86,0,0,1,64,216.13V39.87a15.86,15.86,0,0,1,8.12-13.82,16,16,0,0,1,16.2.3L232.4,114.49A15.74,15.74,0,0,1,240,128Z"></path>
                  </svg>
                {% endunless %}
              {% endfor %}
            {% endfor %}
          {% endif %}
        </div>
        <div class="vertical-text-cart-drawer">
          {% if settings.vertical_scroll_image %}
            {% assign text_parts = settings.vertical_scroll_text | split: '→' %}
            {% for i in (1..10) %}
              {% for part in text_parts %}
                {{ part | strip }}
                {% unless forloop.last %}
                  <img
                    src="{{ settings.vertical_scroll_image | image_url: width: 40 }}"
                    alt="Separator"
                    class="separator-image"
                    width="100"
                    height="100"
                    style="transform: rotate({{ settings.vertical_scroll_image_rotation | default: 0 | plus: 90 }}deg);"
                  >
                {% endunless %}
              {% endfor %}
            {% endfor %}
          {% else %}
            {% assign text_parts = settings.vertical_scroll_text | split: '→' %}
            {% for i in (1..10) %}
              {% for part in text_parts %}
                {{ part | strip }}
                {% unless forloop.last %}
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    fill="var(--text)"
                    viewBox="0 0 256 256"
                    class="separator-image"
                    style="transform: rotate({{ settings.vertical_scroll_image_rotation | default: 0 | plus: 90 }}deg);"
                  >
                    <path d="M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.65a16,16,0,0,1-16.2.3A15.86,15.86,0,0,1,64,216.13V39.87a15.86,15.86,0,0,1,8.12-13.82,16,16,0,0,1,16.2.3L232.4,114.49A15.74,15.74,0,0,1,240,128Z"></path>
                  </svg>
                {% endunless %}
              {% endfor %}
            {% endfor %}
          {% endif %}
        </div>
      </div>

      {%- if cart == empty -%}
        <div class="drawer__inner-empty">
          <h2
            class="empty-cart-number drawer__header2 uppercase  !font-medium !mb-0"
            style="color: var(--text);"
          >
            {{ 'sections.cart.title' | t }} [{{ cart.item_count }}]
          </h2>
          <div class="cart-drawer__warnings center{% if settings.cart_drawer_collection != blank %} cart-drawer__warnings--has-collection{% endif %}">
            <div class="cart-drawer__empty-content">
              <h2 class="cart__empty-text" style="color: var(--text);">Your Cart is sad :(</h2>
              <button
                class="drawer__close2"
                type="button"
                onclick="this.closest('cart-drawer').close()"
                aria-label="{{ 'accessibility.close' | t }}"
              >
                <span
                  class="svg-wrapper2 drawer__header2 uppercase !translate-x-[-100px]"
                  style="color: var(--text); transform: translateX(calc(-1 * var(--space-8xl)));"
                >
                  close
                </span>
              </button>
            </div>
          </div>
          {%- if settings.cart_drawer_collection != blank -%}
            <div class="cart-drawer__collection">
              {% render 'card-collection', card_collection: settings.cart_drawer_collection, columns: 1 %}
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}
      <div class="drawer__header2 drawer__header border-b !py-[16px]" style="padding-block: var(--space-xl);">
        <h2 class="drawer__header2  uppercase  !font-medium !mb-0" style="color: var(--text); ">
          {{ 'sections.cart.title' | t }} [{{ cart.item_count }}]
        </h2>
        <button
          class="drawer__close  !text-[16px]"
          type="button"
          onclick="this.closest('cart-drawer').close()"
          aria-label="{{ 'accessibility.close' | t }}"
        >
          <span
            class="drawer__header2 uppercase !mr-[25px]  md:mb-3 mb-6 font-medium "
            style="margin-inline-end: var(--space-4xl);"
            style="color: var(--text);"
          >
            close
          </span>
        </button>
      </div>
      <cart-drawer-items
        {% if cart == empty %}
          class=" is-empty "
        {% endif %}
      >
        <form
          action="{{ routes.cart_url }}"
          id="CartDrawer-Form"
          class="cart__contents cart-drawer__form md:!hidden !block"
          method="post"
        >
          <div id="CartDrawer-CartItems" class="drawer__contents js-contents">
            {%- if cart != empty -%}
              <div class="drawer__cart-items-wrapper">
                <table class="cart-items" role="table">
                  <tbody role="rowgroup">
                    {%- for item in cart.items -%}
                      <tr
                        id="CartDrawer-Item-{{ item.index | plus: 1 }}"
                        class="!flex !items-start cart-item-padding !border-b cart-drawer-item"
                        role="row"
                      >
                        <!-- Product Image -->
                        <td
                          class="md:!w-[184px] md:!h-[216px] !w-[85px] !h-[82px] "
                          role="cell"
                          headers="CartDrawer-ColumnProductImage"
                        >
                          {% if item.image %}
                            <img
                              class="  item-image-cart-drawer"
                              height="100"
                              width="100"
                              srcset="
                                {{ item.image | image_url: width: 200 }} 200w,
                                {{ item.image | image_url: width: 300 }} 300w,
                                {{ item.image | image_url: width: 400 }} 400w,
                                {{ item.image | image_url: width: 500 }} 500w,
                                {{ item.image | image_url: width: 600 }} 600w
                              "
                              sizes="(max-width: 600px) 85px, 200px"
                              src="{{ item.image | image_url: width: 500 }}"
                              alt="{{ item.image.alt | escape }}"
                              loading="lazy"
                            >
                          {% endif %}
                        </td>

                        <!-- Product Info Column -->
                        <td class="!flex-1 !flex !flex-col !h-full " role="cell">
                          <!-- Top Row: Title and Price -->
                          <div class="!flex !justify-between !items-start !mb-[auto]">
                            <div class="!flex !flex-col ml-4">
                              <div
                                class=" "
                                style="color: var(--text);"
                              >
                                {{ item.final_price | money }}
                              </div>
                              <div class="!flex-col !gap-2 ">
                                <a
                                  href="{{ item.url }}"
                                  class="item-title-cart-drawer !uppercase  !font-medium !mb-2"
                                  style="color: var(--text);"
                                >
                                  {{- item.product.title | escape -}}
                                </a>
                                {%- for option in item.options_with_values -%}
                                  {%- if option.name == 'Size' -%}
                                    <div class=" !uppercase" style="color: var(--text); size-selector ">
                                      SIZE:
                                      <span style="background-color: var(--button); padding: var(--space-mini) var(--space-xs); border-radius: var(--space-sm);">
                                        {{- option.value -}}
                                      </span>
                                    </div>
                                    <div class="size-selector !flex !gap-2">
                                      {%- for size in item.product.options.Size -%}
                                        <button
                                          class="size-option {% if size == option.value %} active {% endif %}"
                                          type="button"
                                          data-size="{{ size }}"
                                        >
                                          {{ size }}
                                        </button>
                                      {%- endfor -%}
                                    </div>
                                  {%- endif -%}
                                {%- endfor -%}

                                {%- comment -%} Color Swatch Section {%- endcomment -%}
                                {%- assign current_color = '' -%}
                                {%- for option in item.options_with_values -%}
                                  {%- assign option_name_lower = option.name | downcase -%}
                                  {%- if option_name_lower contains 'color' or option_name_lower contains 'colour' -%}
                                    {%- assign current_color = option.value -%}
                                    <div
                                      class="option-row !uppercase !mt-2 !flex !items-center"
                                      style="color: var(--text);"
                                    >
                                      <span class="option-label">COLOR:</span>
                                      <div class="color-options !ml-1">
                                        {%- assign available_colors = '' -%}
                                        {%- assign current_size = '' -%}
                                        {%- for option in item.options_with_values -%}
                                          {%- if option.name == 'Size' -%}
                                            {%- assign current_size = option.value -%}
                                          {%- endif -%}
                                        {%- endfor -%}

                                        {%- for variant in item.product.variants -%}
                                          {%- for i in (0..2) -%}
                                            {%- assign option_name = item.product.options[i] | downcase -%}
                                            {%- if option_name contains 'color' or option_name contains 'colour' -%}
                                              {%- assign color_value = variant.options[i] -%}
                                              {%- assign color_key = color_value | downcase | replace: ' ', '_' -%}
                                              {%- assign color_delimiter = '|' | append: color_key | append: '|' -%}
                                              {%- unless available_colors contains color_delimiter -%}
                                                {%- assign available_colors = available_colors
                                                  | append: color_delimiter
                                                -%}

                                                {%- comment -%} Find variant that matches this color and current size {%- endcomment -%}
                                                {%- assign target_variant_id = variant.id -%}
                                                {%- if current_size != blank -%}
                                                  {%- for size_variant in item.product.variants -%}
                                                    {%- assign variant_matches = true -%}
                                                    {%- for j in (0..2) -%}
                                                      {%- assign check_option_name = item.product.options[j]
                                                        | downcase
                                                      -%}
                                                      {%- if check_option_name contains 'color'
                                                        or check_option_name contains 'colour'
                                                      -%}
                                                        {%- if size_variant.options[j] != color_value -%}
                                                          {%- assign variant_matches = false -%}
                                                        {%- endif -%}
                                                      {%- elsif check_option_name contains 'size' -%}
                                                        {%- if size_variant.options[j] != current_size -%}
                                                          {%- assign variant_matches = false -%}
                                                        {%- endif -%}
                                                      {%- endif -%}
                                                    {%- endfor -%}
                                                    {%- if variant_matches -%}
                                                      {%- assign target_variant_id = size_variant.id -%}
                                                      {%- break -%}
                                                    {%- endif -%}
                                                  {%- endfor -%}
                                                {%- endif -%}

                                                <button
                                                  class="color-picker {{ color_key }} {% if color_value == current_color %}selected{% endif %}"
                                                  type="button"
                                                  data-color="{{ color_value }}"
                                                  data-variant-id="{{ target_variant_id }}"
                                                  data-item-key="{{ item.key }}"
                                                  data-current-size="{{ current_size }}"
                                                  aria-label="Select {{ color_value }} color"
                                                  style="width: var(--space-3xl); height: var(--space-3xl);"
                                                ></button>
                                              {%- endunless -%}
                                            {%- endif -%}
                                          {%- endfor -%}
                                        {%- endfor -%}
                                      </div>
                                    </div>
                                    {%- break -%}
                                  {%- endif -%}
                                {%- endfor -%}
                              </div>
                            </div>
                          </div>

                          <!-- Bottom Row: Size Options, Color Picker, and Remove -->
                          <div class="!flex !justify-between !items-end ">
                            <!-- Quantity Controls -->
                            <div
                              class="cart-item__quantity scale-[70%] -translate-x-[20px] {% if has_qty_rules or has_vol_pricing %} cart-item__quantity--info{% endif %}"
                              style="transform: translateX(calc(-1 * var(--space-3xl)));"
                              role="cell"
                              headers="CartDrawer-ColumnQuantity"
                              data-item-key="{{ item.key }}"
                              data-item-quantity="{{ item.quantity }}"
                            >
                              <quantity-popover>
                                <div class="cart-item__quantity-wrapper quantity-popover-wrapper ">
                                  <div class="quantity-popover-container{% if has_qty_rules or has_vol_pricing %} quantity-popover-container--hover{% endif %}">
                                    {% render 'quantity-input',
                                      item: item,
                                      variant: item.variant,
                                      mobile: true,
                                      for_cart: true
                                    %}
                                  </div>
                                </div>
                                {%- if has_qty_rules or has_vol_pricing -%}
                                  <button
                                    type="button"
                                    class="quantity-popover__info-button quantity-popover__info-button--icon-with-label button button--tertiary"
                                    aria-expanded="false"
                                  >
                                    <span class="svg-wrapper">
                                      {{- 'icon-info.svg' | inline_asset_content -}}
                                    </span>
                                    <span>
                                      {%- if has_vol_pricing -%}
                                        {{ 'products.product.volume_pricing.note' | t }}
                                      {%- elsif has_qty_rules -%}
                                        {{ 'products.product.quantity.note' | t }}
                                      {%- endif -%}
                                    </span>
                                  </button>
                                {%- endif -%}
                                {%- if has_vol_pricing or has_qty_rules -%}
                                  <div
                                    class="cart-items__info global-settings-popup quantity-popover__info"
                                    tabindex="-1"
                                    hidden
                                  >
                                    {%- if has_qty_rules == false -%}
                                      <span class="volume-pricing-label caption">
                                        {{- 'products.product.volume_pricing.title' | t -}}
                                      </span>
                                    {%- endif -%}
                                    <div class="quantity__rules caption">
                                      {%- if item.variant.quantity_rule.increment > 1 -%}
                                        <span class="divider">
                                          {{-
                                            'products.product.quantity.multiples_of'
                                            | t: quantity: item.variant.quantity_rule.increment
                                          -}}
                                        </span>
                                      {%- endif -%}
                                      {%- if item.variant.quantity_rule.min > 1 -%}
                                        <span class="divider">
                                          {{-
                                            'products.product.quantity.min_of'
                                            | t: quantity: item.variant.quantity_rule.min
                                          -}}
                                        </span>
                                      {%- endif -%}
                                      {%- if item.variant.quantity_rule.max != null -%}
                                        <span class="divider">
                                          {{-
                                            'products.product.quantity.max_of'
                                            | t: quantity: item.variant.quantity_rule.max
                                          -}}
                                        </span>
                                      {%- endif -%}
                                    </div>
                                    <button
                                      class="button-close button button--tertiary"
                                      type="button"
                                      aria-label="{{ 'accessibility.close' | t }}"
                                    >
                                      <span class="svg-wrapper"> close </span>
                                    </button>
                                    {%- if item.variant.quantity_price_breaks.size > 0 -%}
                                      <volume-pricing class="parent-display">
                                        <ul class="list-unstyled">
                                          <li>
                                            <span>{{ item.variant.quantity_rule.min }}+</span>
                                            <span>{{ item.variant.price | money_with_currency }}/ea</span>
                                          </li>
                                          {%- for price_break in item.variant.quantity_price_breaks -%}
                                            <li>
                                              <span>
                                                {{- price_break.minimum_quantity -}}
                                                <span aria-hidden="true">+</span></span
                                              >
                                              <span>{{ price_break.price | money_with_currency }}/ea</span>
                                            </li>
                                          {%- endfor -%}
                                        </ul>
                                      </volume-pricing>
                                    {%- endif -%}
                                  </div>
                                {%- endif -%}
                                <div
                                  id="CartDrawer-LineItemError-{{ item.index | plus: 1 }}"
                                  class="cart-item__error"
                                  role="alert"
                                >
                                  <small class="cart-item__error-text"></small>
                                  <span class="svg-wrapper">
                                    {{- 'icon-error.svg' | inline_asset_content -}}
                                  </span>
                                </div>
                              </quantity-popover>
                            </div>
                            <cart-remove-button
                              id="CartDrawer-Remove-{{ item.index | plus: 1 }}"
                              data-index="{{ item.index | plus: 1 }}"
                            >
                              <button
                                type="button"
                                class="item-price-cart-drawer -translate-x-[10px] mb-6"
                                style="transform: translateX(calc(-1 * var(--space-lg))); margin-bottom: var(--space-sm);"
                                style="color: var(--text);"
                                aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                              >
                                REMOVE
                              </button>
                            </cart-remove-button>
                          </div>
                        </td>
                      </tr>
                    {%- endfor -%}
                  </tbody>
                </table>
              </div>
            {%- endif -%}
            <p id="CartDrawer-LiveRegionText" class="visually-hidden" role="status"></p>
            <p id="CartDrawer-LineItemStatus" class="visually-hidden" aria-hidden="true" role="status">
              {{ 'accessibility.loading' | t }}
            </p>
          </div>
          <div id="CartDrawer-CartErrors" role="alert"></div>
        </form>
        <form
          action="{{ routes.cart_url }}"
          id="CartDrawer-Form"
          class="cart__contents cart-drawer__form md:!block !hidden"
          method="post"
        >
          <div id="CartDrawer-CartItems" class="drawer__contents js-contents">
            {%- if cart != empty -%}
              <div class="drawer__cart-items-wrapper">
                <table class="cart-items" role="table">
                  <tbody role="rowgroup">
                    {%- for item in cart.items -%}
                      <tr
                        id="CartDrawer-Item-{{ item.index | plus: 1 }}"
                        class="!flex !items-start cart-item-padding !border-b cart-item"
                        role="row"
                      >
                        <!-- Product Image -->
                        <td
                          class="md:!w-[184px] md:!h-[216px] !w-[85px] !h-[82px] "
                          role="cell"
                          headers="CartDrawer-ColumnProductImage"
                        >
                          {% if item.image %}
                            <img
                              class=" item-image-cart-drawer"
                              height="100"
                              width="100"
                              srcset="
                                {{ item.image | image_url: width: 200 }} 200w,
                                {{ item.image | image_url: width: 300 }} 300w,
                                {{ item.image | image_url: width: 400 }} 400w,
                                {{ item.image | image_url: width: 500 }} 500w,
                                {{ item.image | image_url: width: 600 }} 600w
                              "
                              sizes="(max-width: 600px) 85px, 200px"
                              src="{{ item.image | image_url: width: 500 }}"
                              alt="{{ item.image.alt | escape }}"
                              loading="lazy"
                            >
                          {% endif %}
                        </td>

                        <!-- Product Info Column -->
                        <td class="!flex-1 !flex !flex-col !h-[220px] " role="cell">
                          <!-- Top Row: Title and Price -->
                          <div class="!flex !justify-between !items-start !mb-[auto]">
                            <div class="!flex !flex-col">
                              <div class=" item-price-cart-drawer" style="color: var(--text);">
                                {{ item.final_price | money }}
                              </div>
                            </div>
                            <!-- Quantity Controls -->
                            <div
                              class="cart-item__quantity {% if has_qty_rules or has_vol_pricing %} cart-item__quantity--info{% endif %}"
                              role="cell"
                              headers="CartDrawer-ColumnQuantity"
                              data-item-key="{{ item.key }}"
                              data-item-quantity="{{ item.quantity }}"
                            >
                              <quantity-popover>
                                <div class="cart-item__quantity-wrapper quantity-popover-wrapper ">
                                  <div class="quantity-popover-container{% if has_qty_rules or has_vol_pricing %} quantity-popover-container--hover{% endif %}">
                                    {% render 'quantity-input',
                                      item: item,
                                      variant: item.variant,
                                      mobile: false,
                                      for_cart: true
                                    %}
                                  </div>
                                </div>
                                {%- if has_qty_rules or has_vol_pricing -%}
                                  <button
                                    type="button"
                                    class="quantity-popover__info-button quantity-popover__info-button--icon-with-label button button--tertiary"
                                    aria-expanded="false"
                                  >
                                    <span class="svg-wrapper">
                                      {{- 'icon-info.svg' | inline_asset_content -}}
                                    </span>
                                    <span>
                                      {%- if has_vol_pricing -%}
                                        {{ 'products.product.volume_pricing.note' | t }}
                                      {%- elsif has_qty_rules -%}
                                        {{ 'products.product.quantity.note' | t }}
                                      {%- endif -%}
                                    </span>
                                  </button>
                                {%- endif -%}
                                {%- if has_vol_pricing or has_qty_rules -%}
                                  <div
                                    class="cart-items__info global-settings-popup quantity-popover__info"
                                    tabindex="-1"
                                    hidden
                                  >
                                    {%- if has_qty_rules == false -%}
                                      <span class="volume-pricing-label caption">
                                        {{- 'products.product.volume_pricing.title' | t -}}
                                      </span>
                                    {%- endif -%}
                                    <div class="quantity__rules caption">
                                      {%- if item.variant.quantity_rule.increment > 1 -%}
                                        <span class="divider">
                                          {{-
                                            'products.product.quantity.multiples_of'
                                            | t: quantity: item.variant.quantity_rule.increment
                                          -}}
                                        </span>
                                      {%- endif -%}
                                      {%- if item.variant.quantity_rule.min > 1 -%}
                                        <span class="divider">
                                          {{-
                                            'products.product.quantity.min_of'
                                            | t: quantity: item.variant.quantity_rule.min
                                          -}}
                                        </span>
                                      {%- endif -%}
                                      {%- if item.variant.quantity_rule.max != null -%}
                                        <span class="divider">
                                          {{-
                                            'products.product.quantity.max_of'
                                            | t: quantity: item.variant.quantity_rule.max
                                          -}}
                                        </span>
                                      {%- endif -%}
                                    </div>
                                    <button
                                      class="button-close button button--tertiary"
                                      type="button"
                                      aria-label="{{ 'accessibility.close' | t }}"
                                    >
                                      <span class="svg-wrapper"> close </span>
                                    </button>
                                    {%- if item.variant.quantity_price_breaks.size > 0 -%}
                                      <volume-pricing class="parent-display">
                                        <ul class="list-unstyled">
                                          <li>
                                            <span>{{ item.variant.quantity_rule.min }}+</span>
                                            <span>{{ item.variant.price | money_with_currency }}/ea</span>
                                          </li>
                                          {%- for price_break in item.variant.quantity_price_breaks -%}
                                            <li>
                                              <span>
                                                {{- price_break.minimum_quantity -}}
                                                <span aria-hidden="true">+</span></span
                                              >
                                              <span>{{ price_break.price | money_with_currency }}/ea</span>
                                            </li>
                                          {%- endfor -%}
                                        </ul>
                                      </volume-pricing>
                                    {%- endif -%}
                                  </div>
                                {%- endif -%}
                                <div
                                  id="CartDrawer-LineItemError-{{ item.index | plus: 1 }}"
                                  class="cart-item__error"
                                  role="alert"
                                >
                                  <small class="cart-item__error-text"></small>
                                  <span class="svg-wrapper">
                                    {{- 'icon-error.svg' | inline_asset_content -}}
                                  </span>
                                </div>
                              </quantity-popover>
                            </div>
                          </div>

                          <!-- Bottom Row: Size Options, Color Picker, and Remove -->
                          <div class="!flex !justify-between !items-end ">
                            <div class="!flex-col !gap-2">
                              <a
                                href="{{ item.url }}"
                                class="!uppercase  !font-medium !mb-2 item-title-cart-drawer"
                                style="color: var(--text);"
                              >
                                {{- item.product.title | escape -}}
                              </a>
                              {%- for option in item.options_with_values -%}
                                {%- if option.name == 'Size' -%}
                                  <div class=" !uppercase size-variant" style="color: var(--text);">
                                    SIZE: {{ option.value }}
                                  </div>
                                  <div class="size-selector !flex !gap-2">
                                    {%- for size in item.product.options.Size -%}
                                      <button
                                        class="size-option {% if size == option.value %} active {% endif %}"
                                        type="button"
                                        data-size="{{ size }}"
                                      >
                                        {{ size }}
                                      </button>
                                    {%- endfor -%}
                                  </div>
                                {%- endif -%}
                              {%- endfor -%}

                              {%- comment -%} Color Swatch Section {%- endcomment -%}
                              {%- assign current_color = '' -%}
                              {%- for option in item.options_with_values -%}
                                {%- assign option_name_lower = option.name | downcase -%}
                                {%- if option_name_lower contains 'color' or option_name_lower contains 'colour' -%}
                                  {%- assign current_color = option.value -%}
                                  <div class="option-row !uppercase size-variant !mt-2">
                                    <span class="option-label">COLOR:</span>
                                    <div class="color-options">
                                      {%- assign available_colors = '' -%}
                                      {%- assign current_size = '' -%}
                                      {%- for option in item.options_with_values -%}
                                        {%- if option.name == 'Size' -%}
                                          {%- assign current_size = option.value -%}
                                        {%- endif -%}
                                      {%- endfor -%}

                                      {%- for variant in item.product.variants -%}
                                        {%- for i in (0..2) -%}
                                          {%- assign option_name = item.product.options[i] | downcase -%}
                                          {%- if option_name contains 'color' or option_name contains 'colour' -%}
                                            {%- assign color_value = variant.options[i] -%}
                                            {%- assign color_key = color_value | downcase | replace: ' ', '_' -%}
                                            {%- assign color_delimiter = '|' | append: color_key | append: '|' -%}
                                            {%- unless available_colors contains color_delimiter -%}
                                              {%- assign available_colors = available_colors
                                                | append: color_delimiter
                                              -%}

                                              {%- comment -%} Find variant that matches this color and current size {%- endcomment -%}
                                              {%- assign target_variant_id = variant.id -%}
                                              {%- if current_size != blank -%}
                                                {%- for size_variant in item.product.variants -%}
                                                  {%- assign variant_matches = true -%}
                                                  {%- for j in (0..2) -%}
                                                    {%- assign check_option_name = item.product.options[j]
                                                      | downcase
                                                    -%}
                                                    {%- if check_option_name contains 'color'
                                                      or check_option_name contains 'colour'
                                                    -%}
                                                      {%- if size_variant.options[j] != color_value -%}
                                                        {%- assign variant_matches = false -%}
                                                      {%- endif -%}
                                                    {%- elsif check_option_name contains 'size' -%}
                                                      {%- if size_variant.options[j] != current_size -%}
                                                        {%- assign variant_matches = false -%}
                                                      {%- endif -%}
                                                    {%- endif -%}
                                                  {%- endfor -%}
                                                  {%- if variant_matches -%}
                                                    {%- assign target_variant_id = size_variant.id -%}
                                                    {%- break -%}
                                                  {%- endif -%}
                                                {%- endfor -%}
                                              {%- endif -%}

                                              <button
                                                class="color-picker {{ color_key }} {% if color_value == current_color %}selected{% endif %}"
                                                type="button"
                                                data-color="{{ color_value }}"
                                                data-variant-id="{{ target_variant_id }}"
                                                data-item-key="{{ item.key }}"
                                                data-current-size="{{ current_size }}"
                                                aria-label="Select {{ color_value }} color"
                                              ></button>
                                            {%- endunless -%}
                                          {%- endif -%}
                                        {%- endfor -%}
                                      {%- endfor -%}
                                    </div>
                                  </div>
                                  {%- break -%}
                                {%- endif -%}
                              {%- endfor -%}
                            </div>
                            <cart-remove-button
                              id="CartDrawer-Remove-{{ item.index | plus: 1 }}"
                              data-index="{{ item.index | plus: 1 }}"
                            >
                              <button
                                type="button"
                                class="cursor-pointer"
                                style="color: var(--text);"
                                aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                              >
                                REMOVE
                              </button>
                            </cart-remove-button>
                          </div>
                        </td>
                      </tr>
                    {%- endfor -%}
                  </tbody>
                </table>
              </div>
            {%- endif -%}
            <p id="CartDrawer-LiveRegionText" class="visually-hidden" role="status"></p>
            <p id="CartDrawer-LineItemStatus" class="visually-hidden" aria-hidden="true" role="status">
              {{ 'accessibility.loading' | t }}
            </p>
          </div>
          <div id="CartDrawer-CartErrors" role="alert"></div>
        </form>
      </cart-drawer-items>
      <div class="drawer__footer ">
        <!-- Start blocks -->
        <!-- Subtotals -->

        <div class="cart-drawer__footer" {{ block.shopify_attributes }}>
          <div
            class="totals  flex justify-between items-center"
            role="status"
            style=" padding: 0px 0;"
          >
            <h2 class="totals__total !text-normal" style="color: var(--text);">SUBTOTAL</h2>
            <span class="!font-medium" style="color: var(--text);">{{ cart.total_price | money -}}</span>
          </div>

          <details class="border-t border-b" style="border-color: var(--border);">
            <summary class="!font-medium cursor-pointer py-3" style="color: var(--text);">ORDER NOTE</summary>
            <div class="pb-3">
              <textarea
                name="note"
                id="CartDrawer-Note"
                class="w-full p-2 border rounded"
                style="border-color: var(--border); background: var(--background); color: var(--text); min-height: 80px; resize: vertical;"
                placeholder="Add a note to your order..."
                data-cart-note
              >{{ cart.note }}</textarea>
              <button
                type="button"
                id="CartDrawer-SaveNote"
                class="mt-2 px-4 py-2 text-sm border rounded cursor-pointer"
                style="border-color: var(--border); background: var(--background); color: var(--text);"
              >
                Save Note
              </button>
            </div>
          </details>
        </div>

        <div class="cart__ctas !ml-auto mt-5" {{ block.shopify_attributes }}>
          {%- if cart == empty -%}
            {%- assign checkout_disabled = 'disabled' -%}
            {%- assign wrapper_class = 'checkout-button-wrapper cart-empty' -%}
          {%- else -%}
            {%- assign checkout_disabled = '' -%}
            {%- assign wrapper_class = 'checkout-button-wrapper' -%}
          {%- endif -%}

          <div class="{{ wrapper_class }}" id="cart-drawer-checkout-wrapper">
            {% render 'tertiary-button',
              button_text: 'CHECKOUT',
              button_font_size: 'var(--t-b-1-size)',
              font_weight: 'var(--t-b-1-weight)',
              button_line_height: 'var(--t-b-1-line-height)',
              mobile_font_size: 'var(--tm-b-2-size)',
              mobile_font_weight: 'var(--tm-b-2-weight)',
              mobile_line_height: 'var(--tm-b-2-line-height)',
              tertiary_class: 'add-to-cart-tertiary-btn cart-drawer-checkout-btn',
              button_type: 'button',
              button_width: '370px',
              button_height: '50px',
              mobile_button_width: '80vw',
              data_attributes: 'aria-describedby="add-to-cart-description"'
            %}
          </div>
        </div>
      </div>
    </div>
  </div>
</cart-drawer>
